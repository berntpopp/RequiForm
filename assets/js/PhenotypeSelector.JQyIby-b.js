import{_ as e,l as t,t as a,b as n}from"./index.BE0Dzre2.js";import{ab as o,Z as l,c as p,b as d,H as i,x as r,d as s,o as u,a8 as c,$ as y,_ as h,R as v,j as g,a0 as f,N as m,u as b,a2 as S,F as P,ac as I,a1 as $}from"./vendor-vue.C6UamJnv.js";import{e as w,G as k,m as D,H as j,I as E}from"./vendor-vuetify-core.9-jGBs2L.js";import"./vendor-pdf.CZcEIuwn.js";/* empty css                     */const _={class:"phenotype-selector"},L={key:0,class:"phenotype-panel"},O={key:0},C={class:"phenotype-info"},V={class:"hpo"},x={class:"description"},B={key:1},U=e({__name:"PhenotypeSelector",props:{groupedPanelDetails:{type:Array,required:!0},modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue","panel-state-change"],setup(e,{emit:U}){o((e=>({f6a39b5a:b(n).styles.phenotypeSelectorBackgroundColor})));const{t:z}=l(),F=l(),H=p((()=>F.locale.value)),q=d(0),A=()=>{q.value++,t.debug("PhenotypeSelector: Language updated, refreshing component")};i((()=>{window.addEventListener("i18n-updated",A),window.addEventListener("i18n-locale-changed",A)})),r((()=>{window.removeEventListener("i18n-updated",A),window.removeEventListener("i18n-locale-changed",A)}));const G=e,M=U,N=s("patientData",null),R=s("updatePhenotypeData",null),T=d(!1),Z=d({}),J=p((()=>{if(!Z.value||0===Object.keys(Z.value).length)return!0;for(const e in Z.value){const t=Z.value[e];for(const e in t)if("present"===t[e]||"absent"===t[e])return!1}return!0}));function K(){const e=T.value;T.value=!T.value,e&&(t.debug("PhenotypeSelector: Clearing phenotype data as panel is being hidden"),R&&R([]),Z.value={},Y()),M("panel-state-change",T.value)}function Q(e){const t=a.categories.find((t=>t.id===e));return(null==t?void 0:t.phenotypes)||[]}function W(e){return e.names&&e.names[H.value]?e.names[H.value]:e.name}function X(e){return e.descriptions&&e.descriptions[H.value]?e.descriptions[H.value]:e.description}function Y(){if(M("update:modelValue",Z.value),R){const e=[];Object.entries(Z.value).forEach((([t,a])=>{Object.entries(a).forEach((([a,n])=>{e.push({categoryId:t,phenotypeId:a,status:n})}))})),R(e),M("panel-state-change",T.value)}}N&&N.phenotypeData&&N.phenotypeData.length>0&&(t.debug("PhenotypeSelector: initializing from unified data model with",N.phenotypeData.length,"phenotype items"),t.debug("PhenotypeSelector: phenotype data items:",N.phenotypeData),N.phenotypeData.forEach((e=>{t.debug("PhenotypeSelector: processing phenotype item:",e),Z.value[e.categoryId]||(t.debug("PhenotypeSelector: creating new category map for",e.categoryId),Z.value[e.categoryId]={}),Z.value[e.categoryId][e.phenotypeId]=e.status,t.debug(`PhenotypeSelector: set ${e.phenotypeId} to ${e.status} in category ${e.categoryId}`)})),t.debug("PhenotypeSelector: finished initialization, localPhenotypeData =",Z.value)),u((()=>G.groupedPanelDetails),(e=>{e.forEach((e=>{if(!Z.value[e.id]){const t=a.categories.find((t=>t.id===e.id));if(t&&t.phenotypes&&t.phenotypes.length){const a={};t.phenotypes.forEach((e=>{a[e.id]="no input"})),Z.value[e.id]=a}}})),Y()}),{immediate:!0,deep:!0}),u((()=>null==N?void 0:N.phenotypeData),(e=>{if(t.debug("PhenotypeSelector: watching unified phenotype data -",(null==e?void 0:e.length)||0,"items"),e&&e.length>0){if(t.debug("PhenotypeSelector: Found phenotype data in unified model:",e),1!==e.length||e[0].categoryId||e[0].phenotypeId)e.forEach((e=>{e.categoryId&&e.phenotypeId&&e.status?(Z.value[e.categoryId]||(t.debug(`PhenotypeSelector: Creating category ${e.categoryId}`),Z.value[e.categoryId]={}),Z.value[e.categoryId][e.phenotypeId]=e.status,t.debug(`PhenotypeSelector: Set ${e.phenotypeId} = ${e.status} in ${e.categoryId}`)):t.warn("PhenotypeSelector: Invalid phenotype item:",e)}));else{t.debug("PhenotypeSelector: Detected direct format phenotype data");const a=(null==N?void 0:N.category)||"nephrology";Z.value[a]||(t.debug(`PhenotypeSelector: Creating category ${a} for direct format data`),Z.value[a]={}),Object.entries(e[0]).forEach((([e,n])=>{Z.value[a][e]=n,t.debug(`PhenotypeSelector: Set direct format ${e} = ${n} in ${a}`)}))}Z.value={...Z.value},t.debug("PhenotypeSelector: Updated phenotype data:",Z.value),T.value=!0,t.debug("PhenotypeSelector: Opening panel to show phenotype data")}}),{immediate:!0,deep:!0});const ee=p((()=>G.groupedPanelDetails));return(e,t)=>(y(),c("div",_,[(y(),h(w,{color:"primary",small:"",onClick:K,key:`toggle-btn-${q.value}`},{default:f((()=>[v(m(b(z)(T.value?"phenotypeSelector.toggleButton.hide":"phenotypeSelector.toggleButton.add")),1)])),_:1})),t[7]||(t[7]=v()),g(D,null,{default:f((()=>[T.value?(y(),c("div",L,[J.value?(y(),h(k,{type:"warning",density:"compact",variant:"tonal",class:"warning-alert",key:`warning-alert-${q.value}`},{default:f((()=>[v(m(b(z)("phenotypeSelector.warnings.noneSelected")),1)])),_:1})):S("",!0),t[6]||(t[6]=v()),(y(!0),c(P,null,I(ee.value,(e=>{var a;return y(),c("div",{key:e.id,class:"category-section"},[$("h3",null,m(e.categoryTitle),1),t[5]||(t[5]=v()),(null==(a=Q(e.id))?void 0:a.length)?(y(),c("div",O,[(y(!0),c(P,null,I(Q(e.id),(a=>{return y(),c("div",{key:a.id,class:"phenotype-item"},[$("div",C,[$("strong",null,m(W(a)),1),t[0]||(t[0]=v()),$("span",V,"("+m(a.hpo)+")",1),t[1]||(t[1]=v()),$("p",x,m(X(a)),1)]),t[4]||(t[4]=v()),(y(),h(E,{"model-value":(n=e.id,o=a.id,Z.value[n]||(Z.value[n]={}),Z.value[n][o]||"no input"),"onUpdate:modelValue":t=>function(e,t,a){Z.value[e]||(Z.value[e]={}),Z.value[e][t]=a,Y()}(e.id,a.id,t),inline:"",density:"compact",class:"radio-group",key:`radio-group-${e.id}-${a.id}-${q.value}`},{default:f((()=>[(y(),h(j,{label:b(z)("phenotypeSelector.radioLabels.noInput"),value:"no input",density:"compact",key:`radio-no-input-${q.value}`},null,8,["label"])),t[2]||(t[2]=v()),(y(),h(j,{label:b(z)("phenotypeSelector.radioLabels.present"),value:"present",density:"compact",key:`radio-present-${q.value}`},null,8,["label"])),t[3]||(t[3]=v()),(y(),h(j,{label:b(z)("phenotypeSelector.radioLabels.absent"),value:"absent",density:"compact",key:`radio-absent-${q.value}`},null,8,["label"]))])),_:2},1032,["model-value","onUpdate:modelValue"]))]);var n,o})),128))])):(y(),c("div",B,[(y(),c("p",{key:`no-phenotypes-${e.id}-${q.value}`},m(b(z)("phenotypeSelector.noPhenotypesMessage")),1))]))])})),128))])):S("",!0)])),_:1})]))}},[["__scopeId","data-v-ac2fe6c0"]]);export{U as default};
