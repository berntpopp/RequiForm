import{_ as O,C as q,d as f,r as S,x as L,D as Q,E as N,v as I,R as s,S as D,T as $,G as U,A as g,H as d,z as T,i as v,U as h,B as i,J as r,W as B,X as ee,Y as _,I as te,M as j,Z as M,m as W,$ as le,a0 as ae}from"./index._YLKWksp.js";const oe={key:0,class:"mb-4"},se={__name:"TestSelector",setup(ne){const{t:m}=q(),z=q(),C=f(()=>z.locale.value),y=S(0),w=()=>{y.value++,$(()=>{K(c.selectedPanels)})};L(()=>{window.addEventListener("i18n-updated",w),window.addEventListener("i18n-locale-changed",w)}),Q(()=>{window.removeEventListener("i18n-updated",w),window.removeEventListener("i18n-locale-changed",w)});const G=(l,e,t)=>e?(t&&(t.searchText||t.raw&&t.raw.searchText)||l).toLowerCase().includes(e.toLowerCase()):!0;function V(l){return l.names&&l.names[C.value]?l.names[C.value]:l.name}function H(l){return l.titles&&l.titles[C.value]?l.titles[C.value]:l.title}const c=N("patientData",{selectedPanels:S([])}),x=N("updateCategory",null),n=S([]),o=S(""),k=S(!1);I(o,()=>{k.value=!0,s.debug("TestSelector: User selected category:",o.value)});const P=f(()=>c?.category||""),b=f(()=>c?.selectedPanels||[]),p=S("Category Selection");L(()=>{if(n.value=D.categories,window.requiFormData?.directPanels?.length>0){s.debug("TestSelector: Setting panels from directPanels:",window.requiFormData.directPanels);const l=window.requiFormData.directPanels[0];for(const e of n.value)if(e.tests.some(a=>a.id===l)){s.debug("TestSelector: Auto-selecting category from panel:",e.id),o.value=e.id;break}}else if(window.requiFormData?.selectedPanels?.length>0){s.debug("TestSelector: Setting panels from window.requiFormData.selectedPanels:",window.requiFormData.selectedPanels);const l=window.requiFormData.selectedPanels[0];for(const e of n.value)if(e.tests.some(a=>a.id===l)){s.debug("TestSelector: Auto-selecting category from panel:",e.id),o.value=e.id;break}}else if(b.value.length>0){s.debug("TestSelector: Setting panels from unifiedPatientData:",b.value);const l=b.value[0];for(const e of n.value)if(e.tests.some(a=>a.id===l)){s.debug("TestSelector: Auto-selecting category from panel:",e.id),o.value=e.id;break}}else P.value&&(s.debug("TestSelector: Setting initial category from unified model:",P.value),o.value=P.value);$(()=>{b.value.length>0&&(s.debug("TestSelector: Forcing Category Selection tab to show selected panels"),p.value="Category Selection")})}),I(b,l=>{if(!k.value&&l&&l.includes("nephronophthise")&&(!o.value||o.value!=="nephrology")){s.debug("TestSelector: Auto-setting category to nephrology based on nephronophthise panel");const e="nephrology";o.value=e,x&&x(e)}},{immediate:!0}),I([b,n],([l,e])=>{if(!k.value&&l&&l.length>0&&!o.value&&e.length>0){const t=l[0];let a=null;for(const u of e)if(u.tests.some(Z=>Z.id===t)){a=u.id;break}a&&(s.debug("TestSelector: Auto-selecting category based on selected test:",a),o.value=a)}},{immediate:!0});const J=f(()=>{const l=n.value.find(e=>e.id===o.value);return l?l.tests:[]}),R=f(()=>{const l=[];return n.value.forEach(e=>{e.tests.forEach(t=>{const a=V(t);let u=a;t.genes&&Array.isArray(t.genes)&&(u+=" "+t.genes.join(" ")),l.push({label:a,value:t.id,searchText:u})})}),l}),A=["primary","secondary","success","info","warning","error"],X=f(()=>D.categories.reduce((l,e,t)=>(l[e.id]=A[t%A.length],l),{})),Y=f(()=>D.categories.reduce((l,e)=>(e.tests.forEach(t=>{l[t.id]=e.id}),l),{}));function F(l){const e=l.id||l.value,t=Y.value[e];return X.value[t]||"default"}function E(l){const e=l.id||l.value;for(const t of n.value){const a=t.tests.find(u=>u.id===e);if(a)return V(a)}return l.title||l.label||e}function K(l){if(s.debug("Panel selection changed in UI:",l),l&&l.length>0&&(p.value="Category Selection",!k.value&&!o.value&&n.value.length>0)){const e=l[0];for(const t of n.value)if(t.tests.some(u=>u.id===e)){s.debug("TestSelector: Auto-selecting category from panel:",t.id),o.value=t.id;break}}}return(l,e)=>(g(),U("div",null,[(g(),U("h2",{class:"text-h5 mb-4",key:`test-title-${y.value}`},h(i(m)("testSelector.title")),1)),e[8]||(e[8]=d()),(g(),T(ee,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),"bg-color":"primary",key:`tabs-${y.value}`},{default:r(()=>[v(B,{value:"Category Selection"},{default:r(()=>[d(h(i(m)("testSelector.tabs.categorySelection")),1)]),_:1}),e[5]||(e[5]=d()),v(B,{value:"Search"},{default:r(()=>[d(h(i(m)("testSelector.tabs.search")),1)]),_:1})]),_:1},8,["modelValue"])),e[9]||(e[9]=d()),v(ae,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=t=>p.value=t)},{default:r(()=>[v(_,{value:"Category Selection"},{default:r(()=>[(g(),T(j,{dense:"",outlined:"",label:i(m)("testSelector.labels.category"),key:`category-select-${y.value}`,items:n.value,"item-title":t=>H(t),"item-value":"id",modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=t=>o.value=t),class:"mt-2"},null,8,["label","items","item-title","modelValue"])),e[6]||(e[6]=d()),o.value?(g(),U("div",oe,[(g(),T(j,{dense:"",outlined:"",label:i(m)("testSelector.labels.selectPanels"),key:`panels-select-${y.value}`,items:J.value,"item-title":t=>V(t),"item-value":"id",modelValue:i(c).selectedPanels,"onUpdate:modelValue":[e[2]||(e[2]=t=>i(c).selectedPanels=t),K],"return-object":!1,multiple:"",chips:"","closable-chips":""},{chip:r(({props:t,item:a})=>[v(M,W({variant:"flat"},{...t,color:F(a)},{onClick:t.onClick,onKeydown:t.onKeydown,close:"","onClick:close":t.onClose}),{default:r(()=>[d(h(E(a)),1)]),_:2},1040,["onClick","onKeydown","onClick:close"])]),_:1},8,["label","items","item-title","modelValue"]))])):te("",!0)]),_:1}),e[7]||(e[7]=d()),v(_,{value:"Search"},{default:r(()=>[(g(),T(le,{dense:"",outlined:"",label:i(m)("testSelector.labels.searchPlaceholder"),key:`search-input-${y.value}`,items:R.value,"item-title":"label","item-value":"value",modelValue:i(c).selectedPanels,"onUpdate:modelValue":e[3]||(e[3]=t=>i(c).selectedPanels=t),"custom-filter":G,multiple:"",chips:"","closable-chips":"","hide-selected":"",class:"mt-2"},{chip:r(({props:t,item:a})=>[v(M,W({variant:"flat"},{...t,color:F(a)},{onClick:t.onClick,onKeydown:t.onKeydown,close:"","onClick:close":t.onClose}),{default:r(()=>[d(h(E(a)),1)]),_:2},1040,["onClick","onKeydown","onClick:close"])]),_:1},8,["label","items","modelValue"]))]),_:1})]),_:1},8,["modelValue"])]))}},ue=O(se,[["__scopeId","data-v-10f5c7b5"]]);export{ue as default};
