import{_ as x,x as y,G as D,A as E,a7 as u,H as P,aa as f,ab as m,ac as I,R as c,ad as z}from"./index._YLKWksp.js";const B={__name:"PedigreeDrawer",setup(F,{expose:h}){function p(){if(!f||!m||!I){c.error("pedigreejs libraries are not loaded.");return}let i=document.getElementById("pedigreejs");const a=document.getElementById("pedigree");!i&&a&&(i=document.createElement("div"),i.id="pedigreejs",a.appendChild(i));let t={targetDiv:"pedigree",btn_target:"pedigree_history",width:650,height:400,symbol_size:35,store_type:"session",diseases:[{type:"affected",colour:"#F68F35"}],labels:[],font_size:".75em",font_family:"Helvetica",font_weight:700,edit:!0,DEBUG:!1};const s=[{name:"father",sex:"M",top_level:!0},{name:"mother",sex:"F",top_level:!0},{name:"child",sex:"F",father:"father",mother:"mother",proband:!0,affected:!0}],n=m.current(t);t.dataset=n!=null&&n.length>0?n:s;try{let r=f.build(t);z.scale_to_fit(r)}catch(r){let e="";typeof r=="string"?e=r.toUpperCase():r instanceof Error&&(e=r.message),c.error("PedigreeJS initialization error: "+e,r)}}function _(){return new Promise((i,a)=>{try{const t=document.querySelector("#pedigree svg");if(!t){i("");return}const n=new XMLSerializer().serializeToString(t),r=document.createElement("canvas"),e=t.getAttribute("width")||450,o=t.getAttribute("height")||320;r.width=e,r.height=o;const l=r.getContext("2d"),d=new Image;d.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(n))),d.onload=()=>{l.drawImage(d,0,0);const g=r.toDataURL("image/png");i(g)},d.onerror=g=>a(g)}catch(t){a(t)}})}function w(){try{const i={targetDiv:"pedigree",btn_target:"pedigree_history"},a=m.current(i);if(c.debug("[PedigreeDrawer] Raw pedigree dataset fetched from cache:",a),!a||a.length===0)return c.warn("[PedigreeDrawer] No pedigree data found in cache"),null;const t={};let s=1;a.forEach(e=>{const o=e.name||e.id||`p${s}`;t[o]||(t[o]=s++)});const n=[];a.forEach(e=>{const o=e.name||e.id||`p${s}`,l=t[o],d=e.sex==="M"?1:e.sex==="F"?2:0,g=e.father&&t[e.father]||0,b=e.mother&&t[e.mother]||0,v=e.affected?2:1;n.push([1,l,g,b,d,v])}),n.sort((e,o)=>e[1]-o[1]);const r=[2,n];return c.debug("[PedigreeDrawer] Final compact pedigree data prepared:",r),r}catch(i){return c.error("[PedigreeDrawer] Error getting pedigree data:",i),null}}return y(()=>{p()}),h({getPedigreeDataUrl:_,getPedigreeData:w,initPedigree:p}),(i,a)=>(E(),D("div",null,a[0]||(a[0]=[u("div",{id:"pedigree",class:"pedigree-container"},null,-1),P(),u("div",{id:"pedigree_history"},null,-1)])))}},S=x(B,[["__scopeId","data-v-76f2cb8d"]]);export{S as default};
