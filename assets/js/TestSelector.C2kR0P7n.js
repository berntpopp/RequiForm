import{_ as e,t as l,l as t}from"./index.jaPPfWtk.js";import{Z as a,c as o,b as s,H as n,x as i,d as r,v as u,o as c,a8 as d,$ as v,R as m,_ as g,j as f,N as p,u as h,a0 as b,a2 as y,m as w}from"./vendor-vue.MuR-ak5S.js";import{y as S,z as C,A as k,v as P,B as _,C as T,D as V}from"./vendor-vuetify-core.BS_X3kim.js";import"./vendor-pdf.CZcEIuwn.js";/* empty css                     */const D={key:0,class:"mb-4"},A=e({__name:"TestSelector",setup(e){const{t:A}=a(),j=a(),F=o((()=>j.locale.value)),q=s(0),E=()=>{q.value++,u((()=>{O(L.selectedPanels)}))};n((()=>{window.addEventListener("i18n-updated",E),window.addEventListener("i18n-locale-changed",E)})),i((()=>{window.removeEventListener("i18n-updated",E),window.removeEventListener("i18n-locale-changed",E)}));const x=(e,l,t)=>!l||(t&&(t.searchText||t.raw&&t.raw.searchText)||e).toLowerCase().includes(l.toLowerCase());function K(e){return e.names&&e.names[F.value]?e.names[F.value]:e.name}const L=r("patientData",{selectedPanels:s([])}),U=r("updateCategory",null),$=s([]),I=s(""),z=o((()=>(null==L?void 0:L.category)||"")),B=o((()=>(null==L?void 0:L.selectedPanels)||[])),H=s("Category Selection");n((()=>{var e,a,o,s;if($.value=l.categories,(null==(a=null==(e=window.requiFormData)?void 0:e.directPanels)?void 0:a.length)>0){t.debug("TestSelector: Setting panels from directPanels:",window.requiFormData.directPanels);const e=window.requiFormData.directPanels[0];for(const l of $.value)if(l.tests.some((l=>l.id===e))){t.debug("TestSelector: Auto-selecting category from panel:",l.id),I.value=l.id;break}}else if((null==(s=null==(o=window.requiFormData)?void 0:o.selectedPanels)?void 0:s.length)>0){t.debug("TestSelector: Setting panels from window.requiFormData.selectedPanels:",window.requiFormData.selectedPanels);const e=window.requiFormData.selectedPanels[0];for(const l of $.value)if(l.tests.some((l=>l.id===e))){t.debug("TestSelector: Auto-selecting category from panel:",l.id),I.value=l.id;break}}else if(B.value.length>0){t.debug("TestSelector: Setting panels from unifiedPatientData:",B.value);const e=B.value[0];for(const l of $.value)if(l.tests.some((l=>l.id===e))){t.debug("TestSelector: Auto-selecting category from panel:",l.id),I.value=l.id;break}}else z.value&&(t.debug("TestSelector: Setting initial category from unified model:",z.value),I.value=z.value);u((()=>{B.value.length>0&&(t.debug("TestSelector: Forcing Category Selection tab to show selected panels"),H.value="Category Selection")}))})),c(B,(e=>{if(e&&e.includes("nephronophthise")&&(!I.value||"nephrology"!==I.value)){t.debug("TestSelector: Auto-setting category to nephrology based on nephronophthise panel");const e="nephrology";I.value=e,U&&U(e)}}),{immediate:!0}),c([B,$],(([e,l])=>{if(e&&e.length>0&&!I.value&&l.length>0){const a=e[0];let o=null;for(const e of l)if(e.tests.some((e=>e.id===a))){o=e.id;break}o&&(t.debug("TestSelector: Auto-selecting category based on selected test:",o),I.value=o)}}),{immediate:!0});const N=o((()=>{const e=$.value.find((e=>e.id===I.value));return e?e.tests:[]})),R=o((()=>{const e=[];return $.value.forEach((l=>{l.tests.forEach((l=>{const t=K(l);let a=t;l.genes&&Array.isArray(l.genes)&&(a+=" "+l.genes.join(" ")),e.push({label:t,value:l.id,searchText:a})}))})),e})),Z=["primary","secondary","success","info","warning","error"],G=o((()=>l.categories.reduce(((e,l,t)=>(e[l.id]=Z[t%Z.length],e)),{}))),J=o((()=>l.categories.reduce(((e,l)=>(l.tests.forEach((t=>{e[t.id]=l.id})),e)),{})));function M(e){const l=e.id||e.value,t=J.value[l];return G.value[t]||"default"}function O(e){if(t.debug("Panel selection changed in UI:",e),e&&e.length>0&&(H.value="Category Selection",!I.value&&$.value.length>0)){const l=e[0];for(const e of $.value)if(e.tests.some((e=>e.id===l))){t.debug("TestSelector: Auto-selecting category from panel:",e.id),I.value=e.id;break}}}return(e,l)=>(v(),d("div",null,[(v(),d("h2",{key:`test-title-${q.value}`},p(h(A)("testSelector.title")),1)),l[8]||(l[8]=m()),(v(),g(C,{modelValue:H.value,"onUpdate:modelValue":l[0]||(l[0]=e=>H.value=e),"bg-color":"primary",key:`tabs-${q.value}`},{default:b((()=>[f(S,{value:"Category Selection"},{default:b((()=>[m(p(h(A)("testSelector.tabs.categorySelection")),1)])),_:1}),l[5]||(l[5]=m()),f(S,{value:"Search"},{default:b((()=>[m(p(h(A)("testSelector.tabs.search")),1)])),_:1})])),_:1},8,["modelValue"])),l[9]||(l[9]=m()),f(V,{modelValue:H.value,"onUpdate:modelValue":l[4]||(l[4]=e=>H.value=e)},{default:b((()=>[f(k,{value:"Category Selection"},{default:b((()=>[(v(),g(P,{dense:"",outlined:"",label:h(A)("testSelector.labels.category"),key:`category-select-${q.value}`,items:$.value,"item-title":e=>{return(l=e).titles&&l.titles[F.value]?l.titles[F.value]:l.title;var l},"item-value":"id",modelValue:I.value,"onUpdate:modelValue":l[1]||(l[1]=e=>I.value=e),class:"mt-2"},null,8,["label","items","item-title","modelValue"])),l[6]||(l[6]=m()),I.value?(v(),d("div",D,[(v(),g(P,{dense:"",outlined:"",label:h(A)("testSelector.labels.selectPanels"),key:`panels-select-${q.value}`,items:N.value,"item-title":e=>K(e),"item-value":"id",modelValue:h(L).selectedPanels,"onUpdate:modelValue":[l[2]||(l[2]=e=>h(L).selectedPanels=e),O],"return-object":!1,multiple:"",chips:"","closable-chips":""},{chip:b((({props:e,item:l})=>[f(_,w({variant:"flat"},{...e,color:M(l)},{onClick:e.onClick,onKeydown:e.onKeydown,close:"","onClick:close":e.onClose}),{default:b((()=>[m(p(l.title),1)])),_:2},1040,["onClick","onKeydown","onClick:close"])])),_:1},8,["label","items","item-title","modelValue"]))])):y("",!0)])),_:1}),l[7]||(l[7]=m()),f(k,{value:"Search"},{default:b((()=>[(v(),g(T,{dense:"",outlined:"",label:h(A)("testSelector.labels.searchPlaceholder"),key:`search-input-${q.value}`,items:R.value,"item-title":"label","item-value":"value",modelValue:h(L).selectedPanels,"onUpdate:modelValue":l[3]||(l[3]=e=>h(L).selectedPanels=e),"custom-filter":x,multiple:"",chips:"","closable-chips":"","hide-selected":"",class:"mt-2"},{chip:b((({props:e,item:l})=>[f(_,w({variant:"flat"},{...e,color:M(l)},{onClick:e.onClick,onKeydown:e.onKeydown,close:"","onClick:close":e.onClose}),{default:b((()=>[m(p(l.title),1)])),_:2},1040,["onClick","onKeydown","onClick:close"])])),_:1},8,["label","items","modelValue"]))])),_:1})])),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-cd1bd0a2"]]);export{A as default};
