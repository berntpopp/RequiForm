import{_ as e,l,t}from"./index.BE0Dzre2.js";import{Z as a,c as o,b as s,H as n,x as i,d as u,o as r,v as c,a8 as d,$ as v,R as m,_ as g,j as f,N as p,u as b,a0 as h,a2 as y,m as w}from"./vendor-vue.C6UamJnv.js";import{A as S,B as C,C as k,w as P,D as T,E as _,F as V}from"./vendor-vuetify-core.9-jGBs2L.js";import"./vendor-pdf.CZcEIuwn.js";/* empty css                     */const D={key:0,class:"mb-4"},A=e({__name:"TestSelector",setup(e){const{t:A}=a(),F=a(),j=o((()=>F.locale.value)),E=s(0),q=()=>{E.value++,c((()=>{W(K.selectedPanels)}))};n((()=>{window.addEventListener("i18n-updated",q),window.addEventListener("i18n-locale-changed",q)})),i((()=>{window.removeEventListener("i18n-updated",q),window.removeEventListener("i18n-locale-changed",q)}));const x=(e,l,t)=>!l||(t&&(t.searchText||t.raw&&t.raw.searchText)||e).toLowerCase().includes(l.toLowerCase());function U(e){return e.names&&e.names[j.value]?e.names[j.value]:e.name}const K=u("patientData",{selectedPanels:s([])}),L=u("updateCategory",null),$=s([]),I=s(""),B=s(!1);r(I,(()=>{B.value=!0,l.debug("TestSelector: User selected category:",I.value)}));const H=o((()=>(null==K?void 0:K.category)||"")),N=o((()=>(null==K?void 0:K.selectedPanels)||[])),R=s("Category Selection");n((()=>{var e,a,o,s;if($.value=t.categories,(null==(a=null==(e=window.requiFormData)?void 0:e.directPanels)?void 0:a.length)>0){l.debug("TestSelector: Setting panels from directPanels:",window.requiFormData.directPanels);const e=window.requiFormData.directPanels[0];for(const t of $.value)if(t.tests.some((l=>l.id===e))){l.debug("TestSelector: Auto-selecting category from panel:",t.id),I.value=t.id;break}}else if((null==(s=null==(o=window.requiFormData)?void 0:o.selectedPanels)?void 0:s.length)>0){l.debug("TestSelector: Setting panels from window.requiFormData.selectedPanels:",window.requiFormData.selectedPanels);const e=window.requiFormData.selectedPanels[0];for(const t of $.value)if(t.tests.some((l=>l.id===e))){l.debug("TestSelector: Auto-selecting category from panel:",t.id),I.value=t.id;break}}else if(N.value.length>0){l.debug("TestSelector: Setting panels from unifiedPatientData:",N.value);const e=N.value[0];for(const t of $.value)if(t.tests.some((l=>l.id===e))){l.debug("TestSelector: Auto-selecting category from panel:",t.id),I.value=t.id;break}}else H.value&&(l.debug("TestSelector: Setting initial category from unified model:",H.value),I.value=H.value);c((()=>{N.value.length>0&&(l.debug("TestSelector: Forcing Category Selection tab to show selected panels"),R.value="Category Selection")}))})),r(N,(e=>{if(!B.value&&e&&e.includes("nephronophthise")&&(!I.value||"nephrology"!==I.value)){l.debug("TestSelector: Auto-setting category to nephrology based on nephronophthise panel");const e="nephrology";I.value=e,L&&L(e)}}),{immediate:!0}),r([N,$],(([e,t])=>{if(!B.value&&e&&e.length>0&&!I.value&&t.length>0){const a=e[0];let o=null;for(const e of t)if(e.tests.some((e=>e.id===a))){o=e.id;break}o&&(l.debug("TestSelector: Auto-selecting category based on selected test:",o),I.value=o)}}),{immediate:!0});const Z=o((()=>{const e=$.value.find((e=>e.id===I.value));return e?e.tests:[]})),z=o((()=>{const e=[];return $.value.forEach((l=>{l.tests.forEach((l=>{const t=U(l);let a=t;l.genes&&Array.isArray(l.genes)&&(a+=" "+l.genes.join(" ")),e.push({label:t,value:l.id,searchText:a})}))})),e})),G=["primary","secondary","success","info","warning","error"],J=o((()=>t.categories.reduce(((e,l,t)=>(e[l.id]=G[t%G.length],e)),{}))),M=o((()=>t.categories.reduce(((e,l)=>(l.tests.forEach((t=>{e[t.id]=l.id})),e)),{})));function O(e){const l=e.id||e.value,t=M.value[l];return J.value[t]||"default"}function Q(e){const l=e.id||e.value;for(const t of $.value){const e=t.tests.find((e=>e.id===l));if(e)return U(e)}return e.title||e.label||l}function W(e){if(l.debug("Panel selection changed in UI:",e),e&&e.length>0&&(R.value="Category Selection",!B.value&&!I.value&&$.value.length>0)){const t=e[0];for(const e of $.value)if(e.tests.some((e=>e.id===t))){l.debug("TestSelector: Auto-selecting category from panel:",e.id),I.value=e.id;break}}}return(e,l)=>(v(),d("div",null,[(v(),d("h2",{class:"text-h5 mb-4",key:`test-title-${E.value}`},p(b(A)("testSelector.title")),1)),l[8]||(l[8]=m()),(v(),g(C,{modelValue:R.value,"onUpdate:modelValue":l[0]||(l[0]=e=>R.value=e),"bg-color":"primary",key:`tabs-${E.value}`},{default:h((()=>[f(S,{value:"Category Selection"},{default:h((()=>[m(p(b(A)("testSelector.tabs.categorySelection")),1)])),_:1}),l[5]||(l[5]=m()),f(S,{value:"Search"},{default:h((()=>[m(p(b(A)("testSelector.tabs.search")),1)])),_:1})])),_:1},8,["modelValue"])),l[9]||(l[9]=m()),f(V,{modelValue:R.value,"onUpdate:modelValue":l[4]||(l[4]=e=>R.value=e)},{default:h((()=>[f(k,{value:"Category Selection"},{default:h((()=>[(v(),g(P,{dense:"",outlined:"",label:b(A)("testSelector.labels.category"),key:`category-select-${E.value}`,items:$.value,"item-title":e=>{return(l=e).titles&&l.titles[j.value]?l.titles[j.value]:l.title;var l},"item-value":"id",modelValue:I.value,"onUpdate:modelValue":l[1]||(l[1]=e=>I.value=e),class:"mt-2"},null,8,["label","items","item-title","modelValue"])),l[6]||(l[6]=m()),I.value?(v(),d("div",D,[(v(),g(P,{dense:"",outlined:"",label:b(A)("testSelector.labels.selectPanels"),key:`panels-select-${E.value}`,items:Z.value,"item-title":e=>U(e),"item-value":"id",modelValue:b(K).selectedPanels,"onUpdate:modelValue":[l[2]||(l[2]=e=>b(K).selectedPanels=e),W],"return-object":!1,multiple:"",chips:"","closable-chips":""},{chip:h((({props:e,item:l})=>[f(T,w({variant:"flat"},{...e,color:O(l)},{onClick:e.onClick,onKeydown:e.onKeydown,close:"","onClick:close":e.onClose}),{default:h((()=>[m(p(Q(l)),1)])),_:2},1040,["onClick","onKeydown","onClick:close"])])),_:1},8,["label","items","item-title","modelValue"]))])):y("",!0)])),_:1}),l[7]||(l[7]=m()),f(k,{value:"Search"},{default:h((()=>[(v(),g(_,{dense:"",outlined:"",label:b(A)("testSelector.labels.searchPlaceholder"),key:`search-input-${E.value}`,items:z.value,"item-title":"label","item-value":"value",modelValue:b(K).selectedPanels,"onUpdate:modelValue":l[3]||(l[3]=e=>b(K).selectedPanels=e),"custom-filter":x,multiple:"",chips:"","closable-chips":"","hide-selected":"",class:"mt-2"},{chip:h((({props:e,item:l})=>[f(T,w({variant:"flat"},{...e,color:O(l)},{onClick:e.onClick,onKeydown:e.onKeydown,close:"","onClick:close":e.onClose}),{default:h((()=>[m(p(Q(l)),1)])),_:2},1040,["onClick","onKeydown","onClick:close"])])),_:1},8,["label","items","modelValue"]))])),_:1})])),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-10f5c7b5"]]);export{A as default};
