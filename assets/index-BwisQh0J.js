import{r as e,G as t,Z as n,c as a,_ as r,$ as o,a0 as i,a1 as l,j as s,P as d,N as c,u,m as p,a2 as f,b as h,o as m,d as g,a3 as y,l as b,H as v,v as w,a4 as D,F as x,a5 as S,e as P,D as k,Q as _,a6 as C,E as A,a7 as I,B as F,t as E,a8 as N,a9 as L,aa as O,ab as V,p as T,ac as R}from"./vendor-vue-Fl_QoeoT.js";import{V as z,a as M,b as U,c as q,d as H,e as B,f as j,g as G,h as J,i as K,j as W,k as Q,l as Z,m as Y,n as X,o as ee,p as te,q as ne,r as ae,s as re,t as oe,u as ie,v as le,w as se,x as de,y as ce,z as ue,A as pe,B as fe,C as he,D as me,E as ge,F as ye,G as be,H as ve,I as we,J as De,K as xe,L as Se,M as Pe,N as ke,O as _e,P as Ce,Q as Ae,R as Ie,S as Fe,T as Ee}from"./vendor-vuetify-DOSUDjSu.js";import{E as Ne}from"./vendor-pdf-Ba5jYzjK.js";import{Q as Le}from"./vendor-utils-DUBrZhtk.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const Oe={styles:{topBarColor:"#a09588",footerBackgroundColor:"#E5AA94",phenotypeSelectorBackgroundColor:"#FFFFFF"},appTitle:"RequiForm",themeColors:{primary:"#a09588",secondary:"#424242"},darkThemeColors:{primary:"#BDBDBD",secondary:"#757575"},logoUrl:null},Ve={DEBUG:0,INFO:1,WARN:2,ERROR:3},Te="requiform_logLevel",Re=e({logEntries:[],currentLogLevel:(()=>{const e=localStorage.getItem(Te);return null!==e&&void 0!==Ve[e.toUpperCase()]?Ve[e.toUpperCase()]:Ve.INFO})()}),ze=(e,...t)=>{if(e<Re.currentLogLevel||0===t.length)return;const n=(new Date).toISOString(),a=Object.keys(Ve).find((t=>Ve[t]===e));let r="",o=null;if("string"==typeof t[0])r=t[0];else{try{r=`Object logged: ${JSON.stringify(t[0]).substring(0,100)}...`}catch(i){r=`Object logged: [Serialization Error: ${i.message}]`}1===t.length&&(o=t[0])}t.length>1&&(o=2===t.length?t[1]:t.slice(1)),Re.logEntries.push({timestamp:n,level:a,displayMessage:r,rawData:o}),Re.logEntries.length>500&&Re.logEntries.shift()},Me={debug:(...e)=>ze(Ve.DEBUG,...e),info:(...e)=>ze(Ve.INFO,...e),warn:(...e)=>ze(Ve.WARN,...e),error:(...e)=>ze(Ve.ERROR,...e),setLevel:e=>{if(Object.values(Ve).includes(e)){Re.currentLogLevel=e;const t=Object.keys(Ve).find((t=>Ve[t]===e));t&&(localStorage.setItem(Te,t),Me.info(`Log level set to ${t}`))}else Me.warn(`Invalid log level attempted: ${e}`)},get entries(){return t(Re.logEntries)},get currentLogLevel(){return Re.currentLogLevel},get level(){return Re.currentLogLevel},clear:()=>{Re.logEntries.length=0,Me.info("Logs cleared.")}};function Ue(e){const t=["__proto__","constructor","prototype"];if(null===e||"object"!=typeof e)return e;if(Array.isArray(e))e.forEach((e=>Ue(e)));else{for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t.includes(n)?(Me.warn(`[Sanitizer] Detected and removed potentially harmful key: "${n}"`),delete e[n]):e[n]=Ue(e[n]));Object.getPrototypeOf(e),Object.prototype}return e}const qe=e(JSON.parse(JSON.stringify(Oe)));const He=t(qe),Be=async function(){Me.info("[Branding] No external config path specified (VITE_BRANDING_CONFIG_PATH). Using defaults.")},$e=(e,t)=>{const n=e.__vccOpts||e;for(const[a,r]of t)n[a]=r;return n},je={class:"content-wrapper"},Ge={class:"ml-1"},Je={id:"top-bar-actions",class:"d-none d-sm-inline-flex"},Ke={class:"d-inline-flex d-sm-none"},We=$e({__name:"TopBar",props:{isDark:{type:Boolean,required:!0}},setup(e){const{t:t,locale:h}=n(),m=a((()=>"en"===h.value?"mdi-alpha-e-box-outline":"mdi-alpha-d-box-outline"));return(n,a)=>(o(),r(W,{app:"",color:u(He).styles.topBarColor,dark:"",class:"main-app-bar"},{default:i((()=>[l("div",je,[s(z,{class:"flex-shrink-0"},{default:i((()=>[s(M,{location:"bottom"},{activator:i((({props:e})=>[l("h1",p({class:"text-h5 font-weight-bold d-flex align-center"},e),[u(He).logoUrl?(o(),r(U,{key:0,src:u(He).logoUrl,alt:"App Logo",class:"header-logo mr-2","max-height":"32",contain:""},null,8,["src"])):f("",!0),a[23]||(a[23]=d()),u(He).logoUrl?f("",!0):(o(),r(q,{key:1,start:"",class:"logo-icon"},{default:i((()=>a[22]||(a[22]=[d("mdi-file-document-outline")]))),_:1})),a[24]||(a[24]=d()),l("span",Ge,c(u(He).appTitle),1)],16)])),default:i((()=>[a[25]||(a[25]=d()),l("span",null,c(u(He).appTitle)+": "+c(u(t)("topbar.appSubtitle")),1)])),_:1})])),_:1}),a[88]||(a[88]=d()),s(H),a[89]||(a[89]=d()),l("span",Je,[s(B,{icon:"",onClick:a[0]||(a[0]=e=>n.$emit("toggle-theme")),"aria-label":e.isDark?u(t)("topbar.aria.themeToggleLight"):u(t)("topbar.aria.themeToggleDark")},{default:i((()=>[s(q,null,{default:i((()=>[d(c(e.isDark?"mdi-weather-night":"mdi-white-balance-sunny"),1)])),_:1}),a[26]||(a[26]=d()),s(M,{activator:"parent",location:"bottom"},{default:i((()=>[d(c(e.isDark?u(t)("topbar.tooltips.themeToggleLight"):u(t)("topbar.tooltips.themeToggleDark")),1)])),_:1})])),_:1},8,["aria-label"]),a[46]||(a[46]=d()),s(B,{icon:"",onClick:a[1]||(a[1]=e=>n.$emit("toggle-language")),"aria-label":u(t)("topbar.aria.toggleLanguage")},{default:i((()=>[s(q,null,{default:i((()=>[d(c(m.value),1)])),_:1}),a[27]||(a[27]=d()),s(M,{activator:"parent",location:"bottom"},{default:i((()=>[d(c(u(t)("topbar.tooltips.toggleLanguage")),1)])),_:1})])),_:1},8,["aria-label"]),a[47]||(a[47]=d()),s(B,{icon:"",onClick:a[2]||(a[2]=e=>n.$emit("reset-form")),"aria-label":u(t)("topbar.aria.reset")},{default:i((()=>[s(q,null,{default:i((()=>a[28]||(a[28]=[d("mdi-restart")]))),_:1}),a[29]||(a[29]=d()),s(M,{activator:"parent",location:"bottom"},{default:i((()=>[d(c(u(t)("topbar.tooltips.reset")),1)])),_:1})])),_:1},8,["aria-label"]),a[48]||(a[48]=d()),s(B,{icon:"",onClick:a[3]||(a[3]=e=>n.$emit("open-faq")),"aria-label":u(t)("topbar.aria.faq")},{default:i((()=>[s(q,null,{default:i((()=>a[30]||(a[30]=[d("mdi-help-circle")]))),_:1}),a[31]||(a[31]=d()),s(M,{activator:"parent",location:"bottom"},{default:i((()=>[d(c(u(t)("topbar.tooltips.faq")),1)])),_:1})])),_:1},8,["aria-label"]),a[49]||(a[49]=d()),s(B,{icon:"",onClick:a[4]||(a[4]=e=>n.$emit("start-tour")),"aria-label":u(t)("topbar.aria.tour")},{default:i((()=>[s(q,null,{default:i((()=>a[32]||(a[32]=[d("mdi-compass-outline")]))),_:1}),a[33]||(a[33]=d()),s(M,{activator:"parent",location:"bottom"},{default:i((()=>[d(c(u(t)("topbar.tooltips.tour")),1)])),_:1})])),_:1},8,["aria-label"]),a[50]||(a[50]=d()),s(B,{icon:"",onClick:a[5]||(a[5]=e=>n.$emit("copy-url")),"aria-label":u(t)("topbar.aria.copyUrl")},{default:i((()=>[s(q,null,{default:i((()=>a[34]||(a[34]=[d("mdi-link-variant")]))),_:1}),a[35]||(a[35]=d()),s(M,{activator:"parent",location:"bottom"},{default:i((()=>[d(c(u(t)("topbar.tooltips.copyUrl")),1)])),_:1})])),_:1},8,["aria-label"]),a[51]||(a[51]=d()),s(B,{icon:"",onClick:a[6]||(a[6]=e=>n.$emit("copy-encrypted-url")),"aria-label":u(t)("topbar.aria.copyEncryptedUrl")},{default:i((()=>[s(q,null,{default:i((()=>a[36]||(a[36]=[d("mdi-lock")]))),_:1}),a[37]||(a[37]=d()),s(M,{activator:"parent",location:"bottom"},{default:i((()=>[d(c(u(t)("topbar.tooltips.copyEncryptedUrl")),1)])),_:1})])),_:1},8,["aria-label"]),a[52]||(a[52]=d()),s(B,{icon:"",onClick:a[7]||(a[7]=e=>n.$emit("open-paste-data")),"aria-label":u(t)("topbar.aria.pasteData"),id:"paste-data-btn"},{default:i((()=>[s(q,null,{default:i((()=>a[38]||(a[38]=[d("mdi-clipboard-text")]))),_:1}),a[39]||(a[39]=d()),s(M,{activator:"parent",location:"bottom"},{default:i((()=>[d(c(u(t)("topbar.tooltips.pasteData")),1)])),_:1})])),_:1},8,["aria-label"]),a[53]||(a[53]=d()),s(B,{icon:"",onClick:a[8]||(a[8]=e=>n.$emit("save-data")),"aria-label":u(t)("topbar.aria.saveData"),id:"save-data-btn"},{default:i((()=>[s(q,null,{default:i((()=>a[40]||(a[40]=[d("mdi-content-save")]))),_:1}),a[41]||(a[41]=d()),s(M,{activator:"parent",location:"bottom"},{default:i((()=>[d(c(u(t)("topbar.tooltips.saveData")),1)])),_:1})])),_:1},8,["aria-label"]),a[54]||(a[54]=d()),s(B,{icon:"",onClick:a[9]||(a[9]=e=>n.$emit("load-data")),"aria-label":u(t)("topbar.aria.loadData"),id:"load-data-btn"},{default:i((()=>[s(q,null,{default:i((()=>a[42]||(a[42]=[d("mdi-folder-open")]))),_:1}),a[43]||(a[43]=d()),s(M,{activator:"parent",location:"bottom"},{default:i((()=>[d(c(u(t)("topbar.tooltips.loadData")),1)])),_:1})])),_:1},8,["aria-label"]),a[55]||(a[55]=d()),s(B,{icon:"",onClick:a[10]||(a[10]=e=>n.$emit("generate-pdf")),"aria-label":u(t)("topbar.aria.generatePdf"),id:"generate-pdf-btn"},{default:i((()=>[s(q,null,{default:i((()=>a[44]||(a[44]=[d("mdi-file-pdf-box")]))),_:1}),a[45]||(a[45]=d()),s(M,{activator:"parent",location:"bottom"},{default:i((()=>[d(c(u(t)("topbar.tooltips.generatePdf")),1)])),_:1})])),_:1},8,["aria-label"])]),a[90]||(a[90]=d()),l("div",Ke,[s(j,{"offset-y":""},{activator:i((({props:e})=>[s(B,p({icon:""},e,{"aria-label":u(t)("topbar.aria.moreActions")}),{default:i((()=>[s(q,null,{default:i((()=>a[56]||(a[56]=[d("mdi-dots-vertical")]))),_:1})])),_:2},1040,["aria-label"])])),default:i((()=>[a[87]||(a[87]=d()),s(G,{density:"compact"},{default:i((()=>[s(J,{onClick:a[11]||(a[11]=e=>n.$emit("toggle-theme"))},{prepend:i((()=>[s(q,null,{default:i((()=>[d(c(e.isDark?"mdi-weather-night":"mdi-white-balance-sunny"),1)])),_:1})])),default:i((()=>[a[57]||(a[57]=d()),s(K,null,{default:i((()=>[d(c(e.isDark?u(t)("topbar.tooltips.themeToggleLight"):u(t)("topbar.tooltips.themeToggleDark")),1)])),_:1})])),_:1}),a[77]||(a[77]=d()),s(J,{onClick:a[12]||(a[12]=e=>n.$emit("toggle-language"))},{prepend:i((()=>[s(q,null,{default:i((()=>[d(c(m.value),1)])),_:1})])),default:i((()=>[a[58]||(a[58]=d()),s(K,null,{default:i((()=>[d(c(u(t)("topbar.menu.toggleLanguage")),1)])),_:1})])),_:1}),a[78]||(a[78]=d()),s(J,{onClick:a[13]||(a[13]=e=>n.$emit("reset-form"))},{prepend:i((()=>[s(q,null,{default:i((()=>a[59]||(a[59]=[d("mdi-restart")]))),_:1})])),default:i((()=>[a[60]||(a[60]=d()),s(K,null,{default:i((()=>[d(c(u(t)("topbar.menu.reset")),1)])),_:1})])),_:1}),a[79]||(a[79]=d()),s(J,{onClick:a[14]||(a[14]=e=>n.$emit("open-faq"))},{prepend:i((()=>[s(q,null,{default:i((()=>a[61]||(a[61]=[d("mdi-help-circle")]))),_:1})])),default:i((()=>[a[62]||(a[62]=d()),s(K,null,{default:i((()=>[d(c(u(t)("topbar.menu.faq")),1)])),_:1})])),_:1}),a[80]||(a[80]=d()),s(J,{onClick:a[15]||(a[15]=e=>n.$emit("start-tour"))},{prepend:i((()=>[s(q,null,{default:i((()=>a[63]||(a[63]=[d("mdi-compass-outline")]))),_:1})])),default:i((()=>[a[64]||(a[64]=d()),s(K,null,{default:i((()=>[d(c(u(t)("topbar.menu.tour")),1)])),_:1})])),_:1}),a[81]||(a[81]=d()),s(J,{onClick:a[16]||(a[16]=e=>n.$emit("copy-url"))},{prepend:i((()=>[s(q,null,{default:i((()=>a[65]||(a[65]=[d("mdi-link-variant")]))),_:1})])),default:i((()=>[a[66]||(a[66]=d()),s(K,null,{default:i((()=>[d(c(u(t)("topbar.menu.copyUrl")),1)])),_:1})])),_:1}),a[82]||(a[82]=d()),s(J,{onClick:a[17]||(a[17]=e=>n.$emit("copy-encrypted-url"))},{prepend:i((()=>[s(q,null,{default:i((()=>a[67]||(a[67]=[d("mdi-lock")]))),_:1})])),default:i((()=>[a[68]||(a[68]=d()),s(K,null,{default:i((()=>[d(c(u(t)("topbar.menu.copyEncryptedUrl")),1)])),_:1})])),_:1}),a[83]||(a[83]=d()),s(J,{onClick:a[18]||(a[18]=e=>n.$emit("open-paste-data"))},{prepend:i((()=>[s(q,null,{default:i((()=>a[69]||(a[69]=[d("mdi-clipboard-text")]))),_:1})])),default:i((()=>[a[70]||(a[70]=d()),s(K,null,{default:i((()=>[d(c(u(t)("topbar.menu.pasteData")),1)])),_:1})])),_:1}),a[84]||(a[84]=d()),s(J,{onClick:a[19]||(a[19]=e=>n.$emit("save-data"))},{prepend:i((()=>[s(q,null,{default:i((()=>a[71]||(a[71]=[d("mdi-content-save")]))),_:1})])),default:i((()=>[a[72]||(a[72]=d()),s(K,null,{default:i((()=>[d(c(u(t)("topbar.menu.saveData")),1)])),_:1})])),_:1}),a[85]||(a[85]=d()),s(J,{onClick:a[20]||(a[20]=e=>n.$emit("load-data"))},{prepend:i((()=>[s(q,null,{default:i((()=>a[73]||(a[73]=[d("mdi-folder-open")]))),_:1})])),default:i((()=>[a[74]||(a[74]=d()),s(K,null,{default:i((()=>[d(c(u(t)("topbar.menu.loadData")),1)])),_:1})])),_:1}),a[86]||(a[86]=d()),s(J,{onClick:a[21]||(a[21]=e=>n.$emit("generate-pdf"))},{prepend:i((()=>[s(q,null,{default:i((()=>a[75]||(a[75]=[d("mdi-file-pdf-box")]))),_:1})])),default:i((()=>[a[76]||(a[76]=d()),s(K,null,{default:i((()=>[d(c(u(t)("topbar.menu.generatePdf")),1)])),_:1})])),_:1})])),_:1})])),_:1})])])])),_:1},8,["color"]))}},[["__scopeId","data-v-088f0004"]]),Qe=$e({__name:"LocaleDatePicker",props:{modelValue:{type:String,default:""},label:{type:String,default:"Birthdate"}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,a=t,i=navigator.language;function l(e){if(!e)return null;const t=new Date(e);return isNaN(t.getTime())?null:t}const s=h(l(n.modelValue));return m((()=>n.modelValue),(e=>{s.value=l(e)})),m(s,(e=>{const t=(n=e)?n.toISOString().split("T")[0]:"";var n;a("update:modelValue",t)})),(t,n)=>(o(),r(u(Q),{density:"compact","prepend-icon":"","prepend-inner-icon":"$calendar",modelValue:s.value,"onUpdate:modelValue":n[0]||(n[0]=e=>s.value=e),label:e.label,locale:u(i),dense:"",outlined:""},null,8,["modelValue","label","locale"]))}},[["__scopeId","data-v-f84af8b8"]]),Ze={class:"text-h5 mb-4"},Ye=$e({__name:"PatientForm",props:{patientData:{type:Object,required:!0}},emits:["update:patientData"],setup(e,{emit:t}){const{t:p}=n(),h=e,m=t,v=g("patientData"),w=g("updatePersonalInfo"),D=g("getFieldErrors",(()=>({}))),x=a((()=>{const e=D("personalInfo");return e&&e.firstName?p(e.firstName):""})),S=a((()=>{const e=D("personalInfo");return e&&e.lastName?p(e.lastName):""})),P=a((()=>{const e=D("personalInfo");return e&&e.birthdate?p(e.birthdate):""})),k=a((()=>{const e=D("personalInfo");return e&&e.sex?p(e.sex):""})),_=a((()=>{const e=D("personalInfo");return e&&e.insurance?p(e.insurance):""})),C=a((()=>{const e=D("personalInfo");return e&&e.referrer?p(e.referrer):""})),A=a((()=>{const e=D("personalInfo");return e&&e.diagnosis?p(e.diagnosis):""}));function I(e,t,...n){return a({get(){if(v&&t&&v.personalInfo){const e=v.personalInfo[t];if(void 0!==e)return e}let a=h.patientData;const r=[e,...n];for(const e of r){if(null===a||"object"!=typeof a||!(e in a))return(1!==r.length||"variantSegregationRequested"!==r[0])&&"";a=a[e]}return 1===r.length&&"variantSegregationRequested"===r[0]?"boolean"==typeof a&&a:a??""},set(a){w&&t&&w({[t]:a});const r=JSON.parse(JSON.stringify(h.patientData));let o=r;const i=[e,...n];for(let e=0;e<i.length-1;e++){const t=i[e];null!==o[t]&&"object"==typeof o[t]||(o[t]={}),o=o[t]}o[i[i.length-1]]=a,m("update:patientData",r)}})}function F(...e){return a({get(){let t=h.patientData;for(const n of e){if(null===t||"object"!=typeof t||!(n in t))return(1!==e.length||"variantSegregationRequested"!==e[0])&&"";t=t[n]}return 1===e.length&&"variantSegregationRequested"===e[0]?"boolean"==typeof t&&t:t??""},set(t){const n=JSON.parse(JSON.stringify(h.patientData));let a=n;for(let r=0;r<e.length-1;r++){const t=e[r];null!==a[t]&&"object"==typeof a[t]||(a[t]={}),a=a[t]}a[e[e.length-1]]=t,m("update:patientData",n)}})}const E=I("givenName","firstName"),N=I("familyName","lastName"),L=I("birthdate","birthdate"),O=I("sex","sex"),V=I("insurance","insurance"),T=I("physicianName","referrer"),R=F("familyHistory"),z=F("parentalConsanguinity"),M=I("diagnosis","diagnosis"),U=F("orderingDate"),q=F("variantSegregationRequested"),H=F("variantDetails"),B=F("genDGConsentData","provided"),$=F("genDGConsentData","form","consentName"),j=F("genDGConsentData","form","consentDate"),G=F("genDGConsentData","form","questionSecondaryFindings"),J=F("genDGConsentData","form","questionMaterial"),K=F("genDGConsentData","form","questionExtended"),W=F("genDGConsentData","form","questionResearch"),Q=a((()=>[{text:p("patientForm.options.sex.male"),value:"male"},{text:p("patientForm.options.sex.female"),value:"female"},{text:p("patientForm.options.sex.undetermined"),value:"undetermined"}])),ae=a((()=>[{text:p("patientForm.options.familyHistory.conspicuous"),value:"conspicuous"},{text:p("patientForm.options.familyHistory.inconspicuous"),value:"inconspicuous"},{text:p("patientForm.options.familyHistory.unknown"),value:"unknown"}])),re=a((()=>[{text:p("patientForm.options.consanguinity.yes"),value:"yes"},{text:p("patientForm.options.consanguinity.no"),value:"no"}])),oe=a((()=>[{text:p("patientForm.options.consent.provided"),value:"provided"},{text:p("patientForm.options.consent.fill"),value:"fill"}])),ie=a((()=>[{text:p("patientForm.options.yesNo.yes"),value:"yes"},{text:p("patientForm.options.yesNo.no"),value:"no"}]));return(e,t)=>(o(),y("div",null,[l("h2",Ze,c(u(p)("patientForm.title")),1),t[32]||(t[32]=d()),s(ee,{dense:""},{default:i((()=>[s(Z,{cols:"12",sm:"6"},{default:i((()=>[s(Y,{density:"compact",outlined:"",label:u(p)("patientForm.labels.givenName"),modelValue:u(E),"onUpdate:modelValue":t[0]||(t[0]=e=>b(E)?E.value=e:null),"prepend-inner-icon":"mdi-account",error:!!x.value,"error-messages":x.value},null,8,["label","modelValue","error","error-messages"])])),_:1}),t[19]||(t[19]=d()),s(Z,{cols:"12",sm:"6"},{default:i((()=>[s(Y,{density:"compact",outlined:"",label:u(p)("patientForm.labels.familyName"),modelValue:u(N),"onUpdate:modelValue":t[1]||(t[1]=e=>b(N)?N.value=e:null),"prepend-inner-icon":"mdi-account-group",error:!!S.value,"error-messages":S.value},null,8,["label","modelValue","error","error-messages"])])),_:1}),t[20]||(t[20]=d()),s(Z,{cols:"12",sm:"6"},{default:i((()=>[s(Qe,{modelValue:u(L),"onUpdate:modelValue":t[2]||(t[2]=e=>b(L)?L.value=e:null),label:u(p)("patientForm.labels.birthdate"),error:!!P.value,"error-messages":P.value},null,8,["modelValue","label","error","error-messages"])])),_:1}),t[21]||(t[21]=d()),s(Z,{cols:"12",sm:"6"},{default:i((()=>[s(X,{density:"compact",outlined:"",label:u(p)("patientForm.labels.sex"),items:Q.value,"item-title":"text","item-value":"value",modelValue:u(O),"onUpdate:modelValue":t[3]||(t[3]=e=>b(O)?O.value=e:null),"prepend-inner-icon":"mdi-gender-male-female",error:!!k.value,"error-messages":k.value},null,8,["label","items","modelValue","error","error-messages"])])),_:1})])),_:1}),t[33]||(t[33]=d()),s(te,{class:"my-1"}),t[34]||(t[34]=d()),s(ee,{dense:""},{default:i((()=>[s(Z,{cols:"12",sm:"6"},{default:i((()=>[s(Y,{density:"compact",outlined:"",label:u(p)("patientForm.labels.insurance"),modelValue:u(V),"onUpdate:modelValue":t[4]||(t[4]=e=>b(V)?V.value=e:null),"prepend-inner-icon":"mdi-card-account-details-outline",error:!!_.value,"error-messages":_.value},null,8,["label","modelValue","error","error-messages"])])),_:1}),t[22]||(t[22]=d()),s(Z,{cols:"12",sm:"6"},{default:i((()=>[s(Y,{density:"compact",outlined:"",label:u(p)("patientForm.labels.physicianName"),modelValue:u(T),"onUpdate:modelValue":t[5]||(t[5]=e=>b(T)?T.value=e:null),"prepend-inner-icon":"mdi-stethoscope",error:!!C.value,"error-messages":C.value},null,8,["label","modelValue","error","error-messages"])])),_:1})])),_:1}),t[35]||(t[35]=d()),s(te,{class:"my-1"}),t[36]||(t[36]=d()),s(ee,{dense:""},{default:i((()=>[s(Z,{cols:"12",sm:"4"},{default:i((()=>[s(X,{density:"compact",outlined:"",label:u(p)("patientForm.labels.familyHistory"),items:ae.value,modelValue:u(R),"onUpdate:modelValue":t[6]||(t[6]=e=>b(R)?R.value=e:null),"prepend-inner-icon":"mdi-history"},null,8,["label","items","modelValue"])])),_:1}),t[23]||(t[23]=d()),s(Z,{cols:"12",sm:"4"},{default:i((()=>[s(X,{density:"compact",outlined:"",label:u(p)("patientForm.labels.parentalConsanguinity"),items:re.value,modelValue:u(z),"onUpdate:modelValue":t[7]||(t[7]=e=>b(z)?z.value=e:null),"prepend-inner-icon":"mdi-human-male-female"},null,8,["label","items","modelValue"])])),_:1}),t[24]||(t[24]=d()),s(Z,{cols:"12",sm:"4"},{default:i((()=>[s(Y,{density:"compact",outlined:"",label:u(p)("patientForm.labels.diagnosis"),modelValue:u(M),"onUpdate:modelValue":t[8]||(t[8]=e=>b(M)?M.value=e:null),rows:"2","prepend-inner-icon":"mdi-file-document-edit-outline","persistent-hint":"",error:!!A.value,"error-messages":A.value},null,8,["label","modelValue","error","error-messages"])])),_:1})])),_:1}),t[37]||(t[37]=d()),s(te,{class:"my-1"}),t[38]||(t[38]=d()),s(ee,{dense:""},{default:i((()=>[s(Z,{cols:"12",sm:"6"},{default:i((()=>[s(Qe,{modelValue:u(U),"onUpdate:modelValue":t[9]||(t[9]=e=>b(U)?U.value=e:null),label:u(p)("patientForm.labels.orderingDate")},null,8,["modelValue","label"])])),_:1}),t[25]||(t[25]=d()),s(Z,{cols:"12",sm:"6"},{default:i((()=>[s(X,{density:"compact",outlined:"",label:u(p)("patientForm.labels.consent"),items:oe.value,"item-title":"text","item-value":"value",modelValue:u(B),"onUpdate:modelValue":t[10]||(t[10]=e=>b(B)?B.value=e:null)},null,8,["label","items","modelValue"])])),_:1})])),_:1}),t[39]||(t[39]=d()),"fill"===u(B)?(o(),r(ee,{key:0,dense:"",class:"mt-2"},{default:i((()=>[s(Z,{cols:"12",sm:"6"},{default:i((()=>[s(Y,{density:"compact",outlined:"",label:u(p)("patientForm.labels.consentGivenBy"),modelValue:u($),"onUpdate:modelValue":t[11]||(t[11]=e=>b($)?$.value=e:null)},null,8,["label","modelValue"])])),_:1}),t[26]||(t[26]=d()),s(Z,{cols:"12",sm:"6"},{default:i((()=>[s(Qe,{modelValue:u(j),"onUpdate:modelValue":t[12]||(t[12]=e=>b(j)?j.value=e:null),label:u(p)("patientForm.labels.consentDate")},null,8,["modelValue","label"])])),_:1}),t[27]||(t[27]=d()),s(Z,{cols:"12",sm:"6"},{default:i((()=>[s(X,{density:"compact",outlined:"",label:u(p)("patientForm.labels.consentSecondaryFindings"),items:ie.value,"item-title":"text","item-value":"value",modelValue:u(G),"onUpdate:modelValue":t[13]||(t[13]=e=>b(G)?G.value=e:null)},null,8,["label","items","modelValue"])])),_:1}),t[28]||(t[28]=d()),s(Z,{cols:"12",sm:"6"},{default:i((()=>[s(X,{density:"compact",outlined:"",label:u(p)("patientForm.labels.consentMaterial"),items:ie.value,"item-title":"text","item-value":"value",modelValue:u(J),"onUpdate:modelValue":t[14]||(t[14]=e=>b(J)?J.value=e:null)},null,8,["label","items","modelValue"])])),_:1}),t[29]||(t[29]=d()),s(Z,{cols:"12",sm:"6"},{default:i((()=>[s(X,{density:"compact",outlined:"",label:u(p)("patientForm.labels.consentExtendedStorage"),items:ie.value,"item-title":"text","item-value":"value",modelValue:u(K),"onUpdate:modelValue":t[15]||(t[15]=e=>b(K)?K.value=e:null)},null,8,["label","items","modelValue"])])),_:1}),t[30]||(t[30]=d()),s(Z,{cols:"12",sm:"6"},{default:i((()=>[s(X,{density:"compact",outlined:"",label:u(p)("patientForm.labels.consentResearch"),items:ie.value,"item-title":"text","item-value":"value",modelValue:u(W),"onUpdate:modelValue":t[16]||(t[16]=e=>b(W)?W.value=e:null)},null,8,["label","items","modelValue"])])),_:1})])),_:1})):f("",!0),t[40]||(t[40]=d()),s(te,{class:"my-1"}),t[41]||(t[41]=d()),s(ee,{dense:""},{default:i((()=>[s(Z,{cols:"12"},{default:i((()=>[s(ne,{modelValue:u(q),"onUpdate:modelValue":t[17]||(t[17]=e=>b(q)?q.value=e:null),label:u(p)("patientForm.labels.requestVariantSegregation")},null,8,["modelValue","label"])])),_:1}),t[31]||(t[31]=d()),u(q)?(o(),r(Z,{key:0,cols:"12"},{default:i((()=>[s(Y,{density:"compact",outlined:"",label:u(p)("patientForm.labels.variantDetails"),modelValue:u(H),"onUpdate:modelValue":t[18]||(t[18]=e=>b(H)?H.value=e:null),hint:u(p)("patientForm.hints.variantDetails"),"persistent-hint":""},null,8,["label","modelValue","hint"])])),_:1})):f("",!0)])),_:1})]))}},[["__scopeId","data-v-2a1c32ae"]]),Xe={schema:{name:"RequiForm Test Schema",version:"0.1.0"},categories:[{id:"nephrology",title:"Nephrology",titles:{en:"Nephrology",de:"Nephrologie"},tests:[{id:"nephronophthise",name:"Nephronophthise",names:{en:"Nephronophthisis",de:"Nephronophthise"},genes:["INVS","NPHP1 (Inkl. MLPA)","NPHP3","NPHP4","IQCB1","CEP290","GLIS2","TMEM67","RPGRIP1L","NEK8","SDCCAG8","TTC21B","WDR19","ZNF423","CEP164","IFT172","CEP83","DCDC2","MAPKBP1","ANKS6","PAX2","XPNPEP3","ADAMTS9","FAN1","SLC41A1"]},{id:"nephrotisches_syndrom_fsgs_alport",name:"Nephrotisches Syndrom, fokal segmentale Glomerulosklerose (FSGS), Alport Syndrome",names:{en:"Nephrotic Syndrome, Focal Segmental Glomerulosclerosis (FSGS), Alport Syndrome",de:"Nephrotisches Syndrom, fokal segmentale Glomerulosklerose (FSGS), Alport Syndrom"},genes:["AVIL","ACTN4","ANLN","ARHGDIA","CD2AP","COL4A3","COL4A4","COL4A5","COQ2","COQ6","COQ8B","CRB2","CUBN","DGKE","EMP2","FN1","GLA","INF2","ITGA3","KANK2","LAMB2","LMX1B","MAGI2","MYH9","MYO1E","NPHS1","NPHS2","NUP107","NUP205","NUP93","NUP160","NUP85","NUP133","PAX2","PDSS2","PLCE1","PTPRO","SCARB2","SMARCAL1","SGPL1","TBC1D8B","TRPC6","WDR73","WT1","APOL1","CLCN5","LMNA","ALG1","CD151","XPO5","DAAM2","TRIM8","NOS1AP","PRDM15","RCAN1","FAT1","KIRREL1"]},{id:"alport_thin_basement",name:"Alport Syndrom und Nephropathien vom Typ der dünnen Basalmembran",genes:["COL4A3","COL4A4","COL4A5","FN1","CD151","MYH9"]},{id:"senior_loken_syndrome",name:"Senior Løken Syndrom, Nephronophthise mit einer Retinadegeneration",genes:["NPHP1 (Inkl. MLPA)","NPHP3","NPHP4","IQCB1","WDR19","CEP290","SDCCAG8","TRAF3IP1","CEP164","ZNF423","INVS"]},{id:"joubert_syndrome",name:"Joubert Syndrom",genes:["NPHP1 (Inkl. MLPA)","CEP104","TMEM237","ARMC9","PDE6D","ARL13B","CC2D2A","CPLANE1","CEP120","AHI1","CEP41","CSPP1","TMEM67","INPP5E","TCTN3","SUFU","ARL3","TMEM138","TMEM216","CEP290","TCTN1","TCTN2","PIBF1","KIAA0586","KIF7","KIAA0556","ZNF423","RPGRIP1L","TMEM231","TMEM107","B9D1","MKS1","B9D2","OFD1","TTC21B","HYLS1"]},{id:"meckel_gruber_syndrome",name:"Meckel Gruber Syndrom",genes:["B9D1","B9D2","CC2D2A","CEP290","CEP41","CSPP1","KIF14","MKS1","NPHP3","RPGRIP1L","TCTN2","TCTN3","TMEM67","TMEM107","TMEM138","TMEM216","TMEM231","TMEM237","TTC21B","TXNDC15"]},{id:"autosomal_dominant_tubular",name:"Autosomal dominante tubuläre Nierenerkrankung",genes:["UMOD","MUC1 (ohne VNTR)","HNF1B","REN","SEC61A1","PARN"]},{id:"bartter_gitelman",name:"Bartter Syndrom und Gitelman Syndrom",genes:["BSND","CASR","CLCN5","CLCNKA","CLCNKB","CTNS","GNA11","KCNJ10","KCNJ1","MAGED2","SLC12A1","SLC12A3","KCNJ16","EHD1","CLDN10","RRAGD"]},{id:"kidney_stones",name:"Nierensteine (inkl. FHHNC familiäre Hypomagnesiämie mit Hypercalciurie und Nephrocalcinose)",genes:["ADCY10","AGXT","APRT","ATP6V0A4","ATP6V1B1","CA2","CASR","CLCN5","CLCNKB","CLDN2","CLDN16","CLDN19","CNNM2","CYP24A1","FAM20A","GRHPR","HNF4A","HOGA1","HPRT1","ATP1A1","FXYD2","TRPM6","KCNJ1","MAGED2","OCRL","SLC12A1","SLC26A1","SLC22A12","SLC2A9","SLC34A1","SLC34A3","SLC3A1","SLC4A1","SLC7A9","SLC26A6","SLC9A3R1","XDH","EGF"]},{id:"distal_rta",name:"Distale renal-tubuläre Azidose",genes:["SLC4A1","ATP6V1B1","ATP6V0A4","ATP6V1C2","WDR72","FOXI1","SLC4A4","CA2","VPS33B","VIPAS39"]},{id:"complement_diseases",name:"Komplementerkrankungen",genes:["CFH (inkl. MLPA)","CFHR1 (inkl. MLPA)","CFHR3 (inkl. MLPA)","CFI","CD46","CFB","CFD","KCNT2 (inkl. MLPA)","CFHR5 (inkl. MLPA)","C3","THBD","MMACHC","DGKE"]},{id:"kidney_cancer",name:"Nierenkarzinom",genes:["BAP1","CHEK2","DICER1","DIS3L2","FH","FLCN","GPC3","MET","PTEN","SDHB","SDHC","SDHD","SMARCB1","TP53","TSC1","TSC2","VHL","WT1"]},{id:"cakut",name:"CAKUT (Kongenitale Anomalien der Nieren und der ableitenden Harnwege)",genes:["ACE","ACTG2","AGT","BNC2","AGTR1","ANOS1","BMP4","CEP55","CHRM3","CTU2","DSTYK","EYA1","CCNQ","FAT4","FRAS1","FREM1","FREM2","GATA3","GPC3","CHRNA3","GLI3","GRIP1","HNF1B","HPSE2","KIF14","ITGA8","LRIG2","PAX2","PBX1","REN","RET","ROBO1","ROBO2","SALL1","SIX5","UMOD","ZIC3","TBX18","NRIP1","SOX11","SOX17","ZMYM2","NPNT","GFRA1","WNT9B","GREB1L","COL4A1"]},{id:"hypertension",name:"Hypertonie",genes:["ABCC6","CACNA1D","CACNA1H","CLCN2","CUL3","CYP11B1","CYP17A1","ENPP1","HSD11B2","KCNJ5","KLHL3","NF1","NR3C1","NR3C2","PDE3A","PPARG","SCNN1B","SCNN1G","SDHA","SDHAF2","SDHB","SDHC","SDHD","TMEM127","WNK1","WNK4","YY1AP1","CYP11B1","CYP11B2"]},{id:"polycystic_kidney_disease",name:"Polyzystische Nierenerkrankung",genes:["PKD1","PKD2","GANAB","PKHD1","DZIP1L","DNAJB11","ANKS6","UMOD","MUC1 (ohne VNTR)","HNF1B","REN","SEC61A1","BICC1","NPHP3","NEK8","TULP3","ALG8","ALG9","IFT140","FLCN","PRKCSH","SEC63","LRP5"]}],phenotypes:[{id:"vesikoureteraler_reflux",name:"Vesikoureteraler Reflux",hpo:"HP:0012002",description:"Retrograde flow of urine from the bladder into the ureters.",names:{en:"Vesicoureteral reflux",de:"Vesikoureteraler Reflux"},descriptions:{en:"Retrograde flow of urine from the bladder into the ureters.",de:"Rückfluss von Urin aus der Blase in die Harnleiter."}},{id:"megaureter",name:"Megaureter",hpo:"HP:0000078",description:"Abnormally dilated ureter."},{id:"nierenagenesie",name:"Nierenagenesie",hpo:"HP:0000119",description:"Absence of one or both kidneys."},{id:"nierenhypoplasie",name:"Nierenhypoplasie",hpo:"HP:0012563",description:"Underdeveloped kidneys."},{id:"polyzystische_nieren",name:"(Poly-)zystische Nieren",hpo:"HP:0000107",description:"Multiple cysts in the kidneys."},{id:"nierendysplasie",name:"Nierendysplasie",hpo:"HP:0000001",description:"Abnormal kidney shape due to dysplasia."},{id:"nephrocalcinose",name:"Nephrocalcinose",hpo:"HP:0000002",description:"Calcium deposits in the kidneys."},{id:"nephrolithiasis",name:"Nephrolithiasis",hpo:"HP:0000079",description:"Kidney stones."},{id:"nephrotisches_syndrom_fsgs",name:"Nephrotisches Syndrom / FSGS",hpo:"HP:0000093",description:"Nephrotic syndrome with focal segmental glomerulosclerosis."},{id:"schrumpfniere",name:"Schrumpfniere",hpo:"HP:0000095",description:"Shrinkage of the kidneys."},{id:"interstitielle_nephritis",name:"Interstitielle Nephritis",hpo:"HP:0000003",description:"Inflammation of the kidney interstitium."}]},{id:"cardiology",title:"Cardiology",tests:[{id:"lqts",name:"Long QT-Syndrom (LQTS)",genes:["CACNA1C","CALM1","CALM2","CALM3","CAV3","KCNE1","KCNE2","KCNH2","KCNJ2","KCNQ1","SCN5A","TRDN"]},{id:"sqts",name:"Short QT-Syndrom (SQTS)",genes:["CACNA1C","CACNA2D1","CACNB2","KCNH2","KCNJ2","KCNQ1","SCN5A","SLC4A3","SLC22A5"]},{id:"brugada",name:"Brugada-Syndrom (BrS)",genes:["CACNA1C","CACNB2","GPD1L","HCN4","KCND3","KCNE3","SCN1B","SCN3B","SCN5A"]},{id:"arvc",name:"Arrhythmogene rechtsventrikuläre Kardiomyopathie (ARVC)",genes:["CDH2","DES","DSC2","DSG2","DSP","FLNC","JUP","LMNA","PLN","PKP2","TMEM43"]},{id:"cpvt",name:"Catecholaminerge polymorphe ventrikuläre Tachykardie (CPVT)",genes:["CALM1","CALM2","CALM3","CASQ2","KCNJ2","RYR2","TECRL","TRDN"]},{id:"rcm",name:"Restriktive Kardiomyopathie (RCM)",genes:["ACTC1","DES","FLNC","GLA","MYBPC3","MYH7","MYPN","TNNI3","TNNT2","TTN"]},{id:"hcm",name:"Hypertrophe Kardiomyopathie (HCM)",genes:["ACTC1","ACTN2","ALPK3","CAV3","CSRP3","FHOD3","FLNC","GLA","JPH2","KLHL24","LAMP2","MT-TI","MYBPC3","MYH7","MYL2","MYL3","PLN","PRKAG2","TRIM63","TNNC1","TNNI3","TNNT2","TPM1","TTR"]},{id:"dcm",name:"Dilatative Kardiomyopathie (DCM)",genes:["ACTC1","ACTN2","BAG3","CAP2","DES","DMD","DSG2","DSP","EYA4","FLII","FLNC","JPH2","LMNA","MYBPC3","MYH7","NEXN","PLN","PPP1R13L","PRDM16","RAF1","RBM20","RPL3L","SCN5A","TAZ","TNNC1","TNNI3","TNNI3K","TNNT2","TPM1","TTN*","VCL"]}],phenotypes:[{id:"synkopen",name:"Synkopen",hpo:"HP:0001262",description:"Episodes of fainting."},{id:"plotzlicher_herztod",name:"Plötzlicher Herztod / Herzstillstand",hpo:"HP:0001644",description:"Sudden cardiac arrest."}]}]},et={key:0,class:"mb-4"},tt=$e({__name:"TestSelector",setup(e){const{t:t}=n(),r=n(),b=a((()=>r.locale.value)),D=(e,t,n)=>{if(!t)return!0;return(n&&(n.searchText||n.raw&&n.raw.searchText)||e).toLowerCase().includes(t.toLowerCase())};function x(e){return e.names&&e.names[b.value]?e.names[b.value]:e.name}const S=g("patientData",{selectedPanels:h([])}),P=g("updateCategory",null),k=h([]),_=h(""),C=a((()=>(null==S?void 0:S.category)||"")),A=a((()=>(null==S?void 0:S.selectedPanels)||[])),I=h("Category Selection");v((()=>{var e,t,n,a;if(k.value=Xe.categories,(null==(t=null==(e=window.requiFormData)?void 0:e.directPanels)?void 0:t.length)>0){Me.debug("TestSelector: Setting panels from directPanels:",window.requiFormData.directPanels);const e=window.requiFormData.directPanels[0];for(const t of k.value){if(t.tests.some((t=>t.id===e))){Me.debug("TestSelector: Auto-selecting category from panel:",t.id),_.value=t.id;break}}}else if((null==(a=null==(n=window.requiFormData)?void 0:n.selectedPanels)?void 0:a.length)>0){Me.debug("TestSelector: Setting panels from window.requiFormData.selectedPanels:",window.requiFormData.selectedPanels);const e=window.requiFormData.selectedPanels[0];for(const t of k.value){if(t.tests.some((t=>t.id===e))){Me.debug("TestSelector: Auto-selecting category from panel:",t.id),_.value=t.id;break}}}else if(A.value.length>0){Me.debug("TestSelector: Setting panels from unifiedPatientData:",A.value);const e=A.value[0];for(const t of k.value){if(t.tests.some((t=>t.id===e))){Me.debug("TestSelector: Auto-selecting category from panel:",t.id),_.value=t.id;break}}}else C.value&&(Me.debug("TestSelector: Setting initial category from unified model:",C.value),_.value=C.value);w((()=>{A.value.length>0&&(Me.debug("TestSelector: Forcing Category Selection tab to show selected panels"),I.value="Category Selection")}))})),m(A,(e=>{if(e&&e.includes("nephronophthise")&&(!_.value||"nephrology"!==_.value)){Me.debug("TestSelector: Auto-setting category to nephrology based on nephronophthise panel");const e="nephrology";_.value=e,P&&P(e)}}),{immediate:!0}),m([A,k],(([e,t])=>{if(e&&e.length>0&&!_.value&&t.length>0){const n=e[0];let a=null;for(const e of t){if(e.tests.some((e=>e.id===n))){a=e.id;break}}a&&(Me.debug("TestSelector: Auto-selecting category based on selected test:",a),_.value=a)}}),{immediate:!0});const F=a((()=>{const e=k.value.find((e=>e.id===_.value));return e?e.tests:[]})),E=a((()=>{const e=[];return k.value.forEach((t=>{t.tests.forEach((t=>{const n=x(t);let a=n;t.genes&&Array.isArray(t.genes)&&(a+=" "+t.genes.join(" ")),e.push({label:n,value:t.id,searchText:a})}))})),e})),N=["primary","secondary","success","info","warning","error"],L=a((()=>Xe.categories.reduce(((e,t,n)=>(e[t.id]=N[n%N.length],e)),{}))),O=a((()=>Xe.categories.reduce(((e,t)=>(t.tests.forEach((n=>{e[n.id]=t.id})),e)),{})));function V(e){const t=e.id||e.value,n=O.value[t];return L.value[n]||"default"}function T(e){if(Me.debug("Panel selection changed in UI:",e),e&&e.length>0&&(I.value="Category Selection",!_.value&&k.value.length>0)){const t=e[0];for(const e of k.value){if(e.tests.some((e=>e.id===t))){Me.debug("TestSelector: Auto-selecting category from panel:",e.id),_.value=e.id;break}}}}return(e,n)=>(o(),y("div",null,[l("h2",null,c(u(t)("testSelector.title")),1),n[8]||(n[8]=d()),s(re,{modelValue:I.value,"onUpdate:modelValue":n[0]||(n[0]=e=>I.value=e),"bg-color":"primary"},{default:i((()=>[s(ae,{value:"Category Selection"},{default:i((()=>[d(c(u(t)("testSelector.tabs.categorySelection")),1)])),_:1}),n[5]||(n[5]=d()),s(ae,{value:"Search"},{default:i((()=>[d(c(u(t)("testSelector.tabs.search")),1)])),_:1})])),_:1},8,["modelValue"]),n[9]||(n[9]=d()),s(se,{modelValue:I.value,"onUpdate:modelValue":n[4]||(n[4]=e=>I.value=e)},{default:i((()=>[s(oe,{value:"Category Selection"},{default:i((()=>[s(X,{dense:"",outlined:"",label:u(t)("testSelector.labels.category"),items:k.value,"item-title":e=>{return(t=e).titles&&t.titles[b.value]?t.titles[b.value]:t.title;var t},"item-value":"id",modelValue:_.value,"onUpdate:modelValue":n[1]||(n[1]=e=>_.value=e),class:"mt-2"},null,8,["label","items","item-title","modelValue"]),n[6]||(n[6]=d()),_.value?(o(),y("div",et,[s(X,{dense:"",outlined:"",label:u(t)("testSelector.labels.selectPanels"),items:F.value,"item-title":e=>x(e),"item-value":"id",modelValue:u(S).selectedPanels,"onUpdate:modelValue":[n[2]||(n[2]=e=>u(S).selectedPanels=e),T],"return-object":!1,multiple:"",chips:"","closable-chips":""},{chip:i((({props:e,item:t})=>[s(ie,p({variant:"flat"},{...e,color:V(t)},{onClick:e.onClick,onKeydown:e.onKeydown,close:"","onClick:close":e.onClose}),{default:i((()=>[d(c(t.title),1)])),_:2},1040,["onClick","onKeydown","onClick:close"])])),_:1},8,["label","items","item-title","modelValue"])])):f("",!0)])),_:1}),n[7]||(n[7]=d()),s(oe,{value:"Search"},{default:i((()=>[s(le,{dense:"",outlined:"",label:u(t)("testSelector.labels.searchPlaceholder"),items:E.value,"item-title":"label","item-value":"value",modelValue:u(S).selectedPanels,"onUpdate:modelValue":n[3]||(n[3]=e=>u(S).selectedPanels=e),"custom-filter":D,multiple:"",chips:"","closable-chips":"","hide-selected":"",class:"mt-2"},{chip:i((({props:e,item:t})=>[s(ie,p({variant:"flat"},{...e,color:V(t)},{onClick:e.onClick,onKeydown:e.onKeydown,close:"","onClick:close":e.onClose}),{default:i((()=>[d(c(t.title),1)])),_:2},1040,["onClick","onKeydown","onClick:close"])])),_:1},8,["label","items","modelValue"])])),_:1})])),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-2079cc4e"]]),nt={class:"phenotype-selector"},at={key:0,class:"phenotype-panel"},rt={class:"title"},ot={key:0},it={class:"phenotype-info"},lt={class:"hpo"},st={class:"description"},dt={key:1},ct=$e({__name:"PhenotypeSelector",props:{groupedPanelDetails:{type:Array,required:!0},modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(e,{emit:t}){D((e=>({"68204b8c":u(He).styles.phenotypeSelectorBackgroundColor})));const{t:r}=n(),p=n(),b=a((()=>p.locale.value)),v=e,w=t,P=g("patientData",null),k=g("updatePhenotypeData",null),_=h(!1),C=h({});function A(){_.value=!_.value}function I(e){const t=Xe.categories.find((t=>t.id===e));return(null==t?void 0:t.phenotypes)||[]}function F(e){return e.names&&e.names[b.value]?e.names[b.value]:e.name}function E(e){return e.descriptions&&e.descriptions[b.value]?e.descriptions[b.value]:e.description}function N(){if(w("update:modelValue",C.value),k){const e=[];Object.entries(C.value).forEach((([t,n])=>{Object.entries(n).forEach((([n,a])=>{e.push({categoryId:t,phenotypeId:n,status:a})}))})),k(e)}}P&&P.phenotypeData&&P.phenotypeData.length>0&&(Me.debug("PhenotypeSelector: initializing from unified data model with",P.phenotypeData.length,"phenotype items"),Me.debug("PhenotypeSelector: phenotype data items:",P.phenotypeData),P.phenotypeData.forEach((e=>{Me.debug("PhenotypeSelector: processing phenotype item:",e),C.value[e.categoryId]||(Me.debug("PhenotypeSelector: creating new category map for",e.categoryId),C.value[e.categoryId]={}),C.value[e.categoryId][e.phenotypeId]=e.status,Me.debug(`PhenotypeSelector: set ${e.phenotypeId} to ${e.status} in category ${e.categoryId}`)})),Me.debug("PhenotypeSelector: finished initialization, localPhenotypeData =",C.value)),m((()=>v.groupedPanelDetails),(e=>{e.forEach((e=>{if(!C.value[e.id]){const t=Xe.categories.find((t=>t.id===e.id));if(t&&t.phenotypes&&t.phenotypes.length){const n={};t.phenotypes.forEach((e=>{n[e.id]="no input"})),C.value[e.id]=n}}})),N()}),{immediate:!0,deep:!0}),m((()=>null==P?void 0:P.phenotypeData),(e=>{if(Me.debug("PhenotypeSelector: watching unified phenotype data -",(null==e?void 0:e.length)||0,"items"),e&&e.length>0){Me.debug("PhenotypeSelector: Found phenotype data in unified model:",e);if(1===e.length&&!e[0].categoryId&&!e[0].phenotypeId){Me.debug("PhenotypeSelector: Detected direct format phenotype data");const t=(null==P?void 0:P.category)||"nephrology";C.value[t]||(Me.debug(`PhenotypeSelector: Creating category ${t} for direct format data`),C.value[t]={}),Object.entries(e[0]).forEach((([e,n])=>{C.value[t][e]=n,Me.debug(`PhenotypeSelector: Set direct format ${e} = ${n} in ${t}`)}))}else e.forEach((e=>{e.categoryId&&e.phenotypeId&&e.status?(C.value[e.categoryId]||(Me.debug(`PhenotypeSelector: Creating category ${e.categoryId}`),C.value[e.categoryId]={}),C.value[e.categoryId][e.phenotypeId]=e.status,Me.debug(`PhenotypeSelector: Set ${e.phenotypeId} = ${e.status} in ${e.categoryId}`)):Me.warn("PhenotypeSelector: Invalid phenotype item:",e)}));C.value={...C.value},Me.debug("PhenotypeSelector: Updated phenotype data:",C.value),_.value=!0,Me.debug("PhenotypeSelector: Opening panel to show phenotype data")}}),{immediate:!0,deep:!0});const L=a((()=>v.groupedPanelDetails));return(e,t)=>(o(),y("div",nt,[s(B,{color:"primary",small:"",onClick:A},{default:i((()=>[d(c(u(r)(_.value?"phenotypeSelector.toggleButton.hide":"phenotypeSelector.toggleButton.add")),1)])),_:1}),t[7]||(t[7]=d()),s(ue,null,{default:i((()=>[_.value?(o(),y("div",at,[l("h2",rt,c(u(r)("phenotypeSelector.panelTitle")),1),t[6]||(t[6]=d()),(o(!0),y(x,null,S(L.value,(e=>{var n;return o(),y("div",{key:e.id,class:"category-section"},[l("h3",null,c(e.categoryTitle),1),t[5]||(t[5]=d()),(null==(n=I(e.id))?void 0:n.length)?(o(),y("div",ot,[(o(!0),y(x,null,S(I(e.id),(n=>(o(),y("div",{key:n.id,class:"phenotype-item"},[l("div",it,[l("strong",null,c(F(n)),1),t[0]||(t[0]=d()),l("span",lt,"("+c(n.hpo)+")",1),t[1]||(t[1]=d()),l("p",st,c(E(n)),1)]),t[4]||(t[4]=d()),s(de,{modelValue:C.value[e.id][n.id],"onUpdate:modelValue":t=>C.value[e.id][n.id]=t,inline:"",density:"compact",onChange:t=>(e.id,n.id,void N()),class:"radio-group"},{default:i((()=>[s(ce,{label:u(r)("phenotypeSelector.radioLabels.noInput"),value:"no input",density:"compact"},null,8,["label"]),t[2]||(t[2]=d()),s(ce,{label:u(r)("phenotypeSelector.radioLabels.present"),value:"present",density:"compact"},null,8,["label"]),t[3]||(t[3]=d()),s(ce,{label:u(r)("phenotypeSelector.radioLabels.absent"),value:"absent",density:"compact"},null,8,["label"])])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])))),128))])):(o(),y("div",dt,[l("p",null,c(u(r)("phenotypeSelector.noPhenotypesMessage")),1)]))])})),128))])):f("",!0)])),_:1})]))}},[["__scopeId","data-v-074f1c1a"]]);let ut=25,pt={};function ft(e){try{if("array"===e.store_type)return!1;if("local"!==e.store_type&&"session"!==e.store_type&&void 0!==e.store_type)return!1;let t="test";return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(t){return!1}}function ht(e){return"PEDIGREE_"+e.btn_target+"_"}function mt(e){return pt[ht(e)]}function gt(e,t){return"local"===e.store_type?localStorage.getItem(t):sessionStorage.getItem(t)}function yt(e,t,n){return"local"===e.store_type?localStorage.setItem(t,n):sessionStorage.setItem(t,n)}function bt(e){let t=ht(e),n="local"===e.store_type?localStorage:sessionStorage,a=[];for(let r=0;r<n.length;r++)0===n.key(r).indexOf(t)&&a.push(n.key(r));for(let r=0;r<a.length;r++)n.removeItem(a[r])}function vt(e){let t;return t=ft(e)?gt(e,ht(e)+"COUNT"):pt[ht(e)+"COUNT"],null!=t?t:0}function wt(e,t){ft(e)?yt(e,ht(e)+"COUNT",t):pt[ht(e)+"COUNT"]=t}function Dt(e){if(!e.dataset)return;let t=vt(e);ft(e)?yt(e,ht(e)+t,JSON.stringify(e.dataset)):(ut=500,void 0===mt(e)&&(pt[ht(e)]=[]),mt(e).push(JSON.stringify(e.dataset))),t<ut?t++:t=0,wt(e,t)}function xt(e){if(!ft(e))return mt(e)&&mt(e).length>0?mt(e).length:-1;for(let t=ut;t>0;t--)if(null!==gt(e,ht(e)+(t-1)))return t;return-1}function St(e){let t=vt(e)-1;return-1===t&&(t=ut),ft(e)?JSON.parse(gt(e,ht(e)+t)):mt(e)?JSON.parse(mt(e)[t]):void 0}function Pt(e,t){if(void 0===t&&(t=vt(e)-2),t<0){let n=xt(e);t=n<ut?n-1:ut-1}return wt(e,t+1),ft(e)?JSON.parse(gt(e,ht(e)+t)):JSON.parse(mt(e)[t])}function kt(e,t){return void 0===t&&(t=vt(e)),t>=ut&&(t=0),wt(e,parseInt(t)+1),ft(e)?JSON.parse(gt(e,ht(e)+t)):JSON.parse(mt(e)[t])}function _t(e){ft(e)&&function(e){"local"===e.store_type?localStorage.clear():sessionStorage.clear()}(e),pt={}}function Ct(e,t,n,a){if(ft(e)){let r="local"===e.store_type?localStorage:sessionStorage;t?(yt(e,ht(e)+"_X",t),yt(e,ht(e)+"_Y",n)):(r.removeItem(ht(e)+"_X"),r.removeItem(ht(e)+"_Y"));let o=ht(e)+"_ZOOM";a?yt(e,o,a):r.removeItem(o)}}function At(e){if(!ft(e)||null===localStorage.getItem(ht(e)+"_X")&&null===sessionStorage.getItem(ht(e)+"_X"))return[null,null];let t=[parseInt(gt(e,ht(e)+"_X")),parseInt(gt(e,ht(e)+"_Y"))];return null!==gt(e,ht(e)+"_ZOOM")&&t.push(parseFloat(gt(e,ht(e)+"_ZOOM"))),t}var It=Object.freeze({__proto__:null,clear:_t,clear_pedigree_data:bt,current:St,get_count:vt,getposition:At,init_cache:Dt,last:function(e){if(ft(e))for(let t=ut;t>0;t--){let n=gt(e,ht(e)+(t-1));if(null!==n)return wt(e,t),JSON.parse(n)}else{let t=mt(e);if(t)return JSON.parse(t(t.length-1))}},next:kt,nstore:xt,previous:Pt,setposition:Ct});let Ft,Et={};function Nt(e){return new Error(e)}function Lt(e){if(e.validate){if("function"==typeof e.validate)return e.DEBUG,e.validate.call(this,e);let t,n=[],a=[];for(let r=0;r<e.dataset.length;r++){if(!r.hidden&&(e.dataset[r].mother||e.dataset[r].father)){t=e.dataset[r].display_name,t||(t="unnamed"),t+=" (IndivID: "+e.dataset[r].name+")";let n=e.dataset[r].mother,a=e.dataset[r].father;if(!n||!a)throw Nt("Missing parent for "+t);let o=Yt(e.dataset,n),i=Yt(e.dataset,a);if(-1===o)throw Nt("The mother (IndivID: "+n+") of family member "+t+" is missing from the pedigree.");if(-1===i)throw Nt("The father (IndivID: "+a+") of family member "+t+" is missing from the pedigree.");if("F"!==e.dataset[o].sex)throw Nt("The mother of family member "+t+" is not specified as female. All mothers in the pedigree must have sex specified as 'F'.");if("M"!==e.dataset[i].sex)throw Nt("The father of family member "+t+" is not specified as male. All fathers in the pedigree must have sex specified as 'M'.")}if(!e.dataset[r].name)throw Nt(t+" has no IndivID.");if($.inArray(e.dataset[r].name,n)>-1)throw Nt("IndivID for family member "+t+" is not unique.");n.push(e.dataset[r].name),-1===$.inArray(e.dataset[r].famid,a)&&e.dataset[r].famid&&a.push(e.dataset[r].famid)}if(a.length>1)throw Nt("More than one family found: "+a.join(", ")+".");jt(e.dataset).length}}function Ot(e){e[0].id&&e.sort((function(e,t){return e.id&&t.id?e.id>t.id?1:t.id>e.id?-1:0:0}));let t=["id","parent_node"],n=[];for(let a=0;a<e.length;a++){let r={};for(let n in e[a])-1===t.indexOf(n)&&(r[n]=e[a][n]);n.push(r)}return n}function Vt(e,t){let n=!1;return t&&$.each(t,(function(t,a){if(0===t.indexOf(e+"_")||t===e)return n=!0,n})),n}function Tt(e,t,n,a,r){try{n?$('<div id="msgDialog">'+t+"</div>").dialog({modal:!0,title:e,width:350,buttons:{Yes:function(){$(this).dialog("close"),n(a,r)},No:function(){$(this).dialog("close")}}}):$('<div id="msgDialog">'+t+"</div>").dialog({title:e,width:350,buttons:[{text:"OK",click:function(){$(this).dialog("close")}}]})}catch(o){!function(e,t,n,a,r){const o=document.getElementById("errModal"),i=o.querySelector(".modal-title"),l=o.querySelector(".modal-body");if(n)$("#errModal button.hidden").removeClass("hidden"),$('#errModal button:contains("OK")').on("click",(function(){n(a,r),$('#errModal button:contains("OK")').off("click")}));else{const e=$('#errModal button:contains("CANCEL")');e.hasClass("hidden")||e.addClass("hidden"),$('#errModal button:contains("OK")').off("click")}i.textContent=e,l.textContent=t,$("#errModal").modal("show")}(e,t,n,a,r)}}function Rt(e){let t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(let a=0;a<e;a++)t+=n.charAt(Math.floor(52*Math.random()));return t}function zt(e,t,n,a,r){void 0===t.children&&(t.children=Jt(e.dataset,t)),void 0===a&&(a=[],r=1);let o=tn(n),i=[];return $.each(t.children,(function(t,n){$.each(e.dataset,(function(t,a){if((n.name===a.mother||n.name===a.father)&&void 0===n.id){let t=rn(o,a.mother),n=rn(o,a.father);t=void 0!==t?t:rn(e.dataset,a.mother),n=void 0!==n?n:rn(e.dataset,a.father),function(e,t,n){for(let a=0;a<e.length;a++)if(e[a].mother===t&&e[a].father===n)return!0;return!1}(i,t,n)||i.push({mother:t,father:n})}}))})),$.merge(a,i),$.each(i,(function(n,a){let i=a.mother,l=a.father;i.children=[];let s={name:Rt(4),hidden:!0,parent:null,father:l,mother:i,children:Jt(e.dataset,i,l)},d=Yt(e.dataset,i.name),c=Yt(e.dataset,l.name);"id"in l||"id"in i||(r=Ut(t.children,r));let u=function(e,t,n){let a=t,r=n;for(;"mother"in e[a]&&"mother"in e[r]&&!("noparents"in e[a])&&!("noparents"in e[r]);)a=Yt(e,e[a].mother),r=Yt(e,e[r].mother);return{midx:a,fidx:r}}(e.dataset,d,c);u.fidx<u.midx?(l.id=r++,s.id=r++,i.id=r++):(i.id=r++,s.id=r++,l.id=r++),r=Mt(i,s,r,o,e),r=Mt(l,s,r,o,e),t.children.push(s)})),r=Ut(t.children,r),$.each(t.children,(function(t,o){r=zt(e,o,n,a,r)[1]})),[a,r]}function Mt(e,t,n,a,r){if("parent_node"in e?e.parent_node.push(t):e.parent_node=[t],e.mztwin||e.dztwins){let t=Kt(r.dataset,e);for(let e=0;e<t.length;e++){let r=rn(a,t[e].name);r&&(r.id=n++)}}return n}function Ut(e,t){return e.sort((function(e,t){return e.mztwin&&t.mztwin&&e.mztwin===t.mztwin||e.dztwin&&t.dztwin&&e.dztwin===t.dztwin?0:e.mztwin||t.mztwin||e.dztwin||t.dztwin?1:0})),$.each(e,(function(e,n){void 0===n.id&&(n.id=t++)})),t}function qt(e){return void 0!==$(e).attr("proband")&&!1!==$(e).attr("proband")}function Ht(e,t){for(let n=0;n<t.length;n++)-1===$.inArray(t[n],e)&&e.push(t[n])}function Bt(e,t,n){if(-1===$.inArray(t.name,e))return;Ht(e,$t(n,t));let a=Qt(n,t);$.each(a,(function(t,a){-1===$.inArray(a.name,e)&&(e.push(a.name),Ht(e,$t(n,a)))}))}function $t(e,t){let n=[];for(let a=0;a<e.length;a++){let r=e[a];t.name===r.mother&&-1===$.inArray(r.father,n)?n.push(r.father):t.name===r.father&&-1===$.inArray(r.mother,n)&&n.push(r.mother)}return n}function jt(e){let t=e[Gt(e)];if(!t){if(0===e.length)throw new Error("empty pedigree data set");t=e[0]}let n=[t.name],a=!0,r=0;for(;a&&r<200;){r++;let o=n.length;$.each(e,(function(a,r){if(-1!==$.inArray(r.name,n)){let a=$t(e,r),o=r.name===t.name||!r.noparents;for(let t=0;t<a.length;t++)rn(e,a[t]).noparents||(o=!0);o&&(r.mother&&-1===$.inArray(r.mother,n)&&n.push(r.mother),r.father&&-1===$.inArray(r.father,n)&&n.push(r.father))}else!r.noparents&&(r.mother&&-1!==$.inArray(r.mother,n)||r.father&&-1!==$.inArray(r.father,n))&&n.push(r.name);Bt(n,r,e)})),a=o!==n.length}let o=$.map(e,(function(e,t){return e.name}));return $.map(o,(function(e,t){return-1===$.inArray(e,n)?e:null}))}function Gt(e){let t;return $.each(e,(function(e,n){if(qt(n))return t=e,t})),t}function Jt(e,t,n){let a=[],r=[];return"F"===t.sex&&$.each(e,(function(e,o){t.name===o.mother&&(n&&n.name!==o.father||-1===$.inArray(o.name,r)&&(a.push(o),r.push(o.name)))})),a}function Kt(e,t){let n=function(e,t,n){return void 0===t||!t.mother||t.noparents?[]:$.map(e,(function(e,a){return e.name===t.name||"noparents"in e||!e.mother||e.mother!==t.mother||e.father!==t.father||n&&e.sex!==n?null:e}))}(e,t),a=t.mztwin?"mztwin":"dztwin";return $.map(n,(function(e,n){return e.name!==t.name&&e[a]===t[a]?e:null}))}function Wt(e,t,n){return $.map(e,(function(e,a){return e.name===t.name||"noparents"in e||!e.mother||e.mother!==t.mother||e.father!==t.father||n&&e.sex!==n?null:e}))}function Qt(e,t,n){return $.map(e,(function(e,a){return"noparents"in e||e.mother!==t.name&&e.father!==t.name||n&&e.sex!==n?null:e}))}function Zt(e,t){let n=Yt(e,t),a=1;for(;n>=0&&("mother"in e[n]||e[n].top_level);)n=Yt(e,e[n].mother),a++;return a}function Yt(e,t){let n=-1;return $.each(e,(function(e,a){if(t===a.name)return n=e,n})),n}function Xt(e,t,n){return $.map(e,(function(e,a){return e.depth!==t||e.data.hidden||-1!==$.inArray(e.data.name,n)?null:e})).sort((function(e,t){return e.x-t.x}))}function en(e,t){let n=[];return function t(a){a.data&&(a=a.data),"mother"in a&&"father"in a&&!("noparents"in a)&&(t(rn(e,a.mother)),t(rn(e,a.father))),n.push(a)}(t),n}function tn(e){let t=[];return function e(n){n.children&&n.children.forEach(e),t.push(n)}(e),t}function nn(e,t,n){function a(r){if(r.children&&(r.children.forEach(a),void 0!==r.data.father)){let a=rn(n,r.data.father.name),o=rn(n,r.data.mother.name),i=(a.x+o.x)/2;if(an(e,t.descendants(),i,r.depth,[r.data.name]))(r.x<a.x&&r.x<o.x||r.x>a.x&&r.x>o.x)&&(r.x=i);else{r.x=i;let n=r.x-i;if(2===r.children.length&&(r.children[0].data.hidden||r.children[1].data.hidden)){if(!r.children[0].data.hidden||!r.children[1].data.hidden){let n=r.children[0].data.hidden?r.children[1]:r.children[0],a=r.children[0].data.hidden?r.children[0]:r.children[1];(n.x<a.x&&i<a.x||n.x>a.x&&i>a.x)&&!an(e,t.descendants(),i,n.depth,[n.data.name])&&(n.x=i)}}else if(1!==r.children.length||r.children[0].data.hidden){if(0!==n&&!function(e,t,n,a){let r=t.descendants(),o=$.map(r,(function(e,t){return e.data.name})),i=a.descendants();for(let l=0;l<r.length;l++){let a=r[l];if(t.data.name!==a.data.name){if(an(e,i,a.x-n,a.depth,o))return!0}}return!1}(e,r,n,t))if(1===r.children.length)r.children[0].x=i;else{let t=r.descendants();e.DEBUG;for(let e=0;e<t.length;e++)r.data.name!==t[e].data.name&&(t[e].x-=n)}}else an(e,t.descendants(),i,r.children[0].depth,[r.children[0].data.name])||(r.children[0].x=i)}}}a(t),a(t)}function an(e,t,n,a,r){for(let o=0;o<t.length;o++)if(a===t[o].depth&&-1===$.inArray(t[o].data.name,r)&&Math.abs(n-t[o].x)<1.15*e.symbol_size)return!0;return!1}function rn(e,t){for(let n=0;n<e.length;n++){if(e[n].data&&t===e[n].data.name)return e[n];if(t===e[n].name)return e[n]}}function on(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function ln(e){return{width:on()?window.innerWidth:e.width,height:on()?window.innerHeight:e.height}}function sn(e,t){let n=e.symbol_size/2,a=2.5*-e.symbol_size;Ft=d3.zoom().scaleExtent([e.zoomIn,e.zoomOut]).filter((function(t){return!((!e.zoomSrc||-1===e.zoomSrc.indexOf("wheel"))&&t.type&&"wheel"===t.type)&&("dblclick"!==t.type&&!t.button)})).on("zoom",(function(t){!function(e,t){t.DEBUG;let n=e.transform,a=n.k&&1!==n.k?n.k:void 0;Ct(t,n.x,n.y,a);let r=d3.select("#"+t.targetDiv).select(".diagram");r.attr("transform","translate("+n.x+","+n.y+")"+(a?" scale("+a+")":""))}(t,e)})),t.call(Ft);let r=At(e),o=3===r.length?r[2]:1,i=null!==r[0]?r[0]/o:n*o,l=null!==r[1]?r[1]/o:a*o;var s=d3.zoomIdentity.scale(o).translate(i,l);t.call(Ft.transform,s)}function dn(e,t){d3.select("#"+e.targetDiv).select("svg").transition().duration(50).call(Ft.scaleBy,t)}function cn(e){let t=function(e){let t=un(e);return{wid:Math.abs(t.xmax-t.xmin),hgt:Math.abs(t.ymax-t.ymin)}}(e),n=d3.select("#"+e.targetDiv).select("svg"),a=function(e){return{w:e.node().clientWidth,h:e.node().clientHeight}}(n),r=1/Math.max(t.wid/a.w,t.hgt/a.h);r<e.zoomIn&&Ft.scaleExtent([r,e.zoomOut]);let o=function(e){let t=un(e);return{x:t.xmin+(t.xmax-t.xmin)/2,y:t.ymin+(t.ymax-t.ymin)/2}}(e);n.call(Ft.translateTo,o.x-e.symbol_size,o.y-e.symbol_size),setTimeout((function(){n.transition().duration(700).call(Ft.scaleTo,r)}),400)}function un(e){let t=d3.select("#"+e.targetDiv).select(".diagram"),n=Number.MAX_VALUE,a=-1e6,r=Number.MAX_VALUE,o=-1e6,i=e.symbol_size;return t.selectAll("g").each((function(t,l){if(t.x&&"hidden_root"!==t.data.name&&!t.data.hidden){let l=function(e,t,n){let a=d3.select(t).node().getBBox(),r=a.width,o=a.height;if(0===r&&0===o)try{r=2*n,o=2*n;let a=d3.select(t).selectAll(".indi_details");for(let t=0;t<a._groups[0].length;t++){let i=pn(a._groups[0][t].firstChild.nodeValue,e.font_family,e.font_size);r=Math.max(i.w+n/2,r),o=Math.max(2*n+t*i.h,o)}}catch(i){r=2*n,o=2*n}return{w:r,h:o}}(e,this,i);t.x-i<n&&(n=t.x-i),t.x+l.w+i>a&&(a=t.x+l.w+i),t.y<r&&(r=t.y),t.y+l.h+i>o&&(o=t.y+l.h+i)}})),{xmin:n,xmax:a,ymin:r,ymax:o}}function pn(e,t,n){let a=$("<div></div>").text(e).css({position:"absolute",float:"left","white-space":"nowrap",visibility:"hidden",font:t||"Helvetica",fontSize:n||"1em"}).appendTo($("body")),r={w:a.width(),h:a.height()};return a.remove(),r}var fn=Object.freeze({__proto__:null,btn_zoom:dn,get_bounds:un,init_zoom:sn,scale_to_fit:cn});function hn(e){let t=$.extend({btn_target:"pedigree_history"},e),n=[{fa:"fa-file-image",title:"download PNG image"},{fa:"fa-undo",title:"undo"},{fa:"fa-redo",title:"redo"},{fa:"fa-refresh",title:"reset"}];n.push({fa:"fa-crosshairs",title:"scale-to-fit"}),t.zoomSrc&&t.zoomSrc.indexOf("button")>-1&&(1!==t.zoomOut&&n.push({fa:"fa-minus-circle",title:"zoom-out"}),1!==t.zoomIn&&n.push({fa:"fa-plus-circle",title:"zoom-in"})),n.push({fa:"fa-arrows-alt",title:"fullscreen"});let a="";for(let r=0;r<n.length;r++)a+="<span>",a+='<i class="fa fa-lg '+n[r].fa+' pe-2" aria-hidden="true" title="'+n[r].title+'"'+("fa-arrows-alt"===n[r].fa?'id="fullscreen" ':"")+"></i>",a+="</span>";$("#"+t.btn_target).append(a),function(e){$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",(function(t){let n=St(e);null!=n&&(e.dataset=n),$(document).trigger("rebuild",[e]),setTimeout((function(){cn(e)}),500)})),$("#fullscreen").on("click",(function(t){if(on())document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{let t=$("#"+e.targetDiv)[0];t.requestFullscreen?t.requestFullscreen():document.documentElement.mozRequestFullScreen?t.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen?t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):document.documentElement.msRequestFullscreen&&t.msRequestFullscreen()}}));let t=0;function n(){dn(e,1.05)}function a(){dn(e,.95)}$(".fa-plus-circle, .fa-minus-circle").on("mousedown",(function(){t=setInterval($(this).hasClass("fa-plus-circle")?n:a,50)})).on("mouseup mouseleave",(function(){clearInterval(t)})),$("#"+e.btn_target).on("click",(function(t){if(t.stopPropagation(),$(t.target).hasClass("fg-grey"))return!1;if($(t.target).hasClass("fa-undo"))e.dataset=Pt(e),$("#"+e.targetDiv).empty(),$(document).trigger("build",[e]);else if($(t.target).hasClass("fa-redo"))e.dataset=kt(e),$("#"+e.targetDiv).empty(),$(document).trigger("build",[e]);else if($(t.target).hasClass("fa-refresh"))Tt("Pedigree Reset","This may result in loss of some data. Reset now?",mn,e);else if($(t.target).hasClass("fa-crosshairs"))cn(e);else if($(t.target).hasClass("fa-file-image"))return;$(document).trigger("fhChange",[e])}))}(t)}function mn(e){let t;if(e.keep_proband_on_reset){let n=Ot(St(e));t=n[Gt(n)],t.name="ch1",t.mother="f21",t.father="m21",bt(e)}else t={name:"ch1",sex:"F",mother:"f21",father:"m21",proband:!0,status:"0",display_name:"me"},_t(e);delete e.dataset;let n=$("input[name='default_fam']:checked");n.length>0&&"extended2"===n.val()?e.dataset=[{name:"wZA",sex:"M",top_level:!0,status:"0",display_name:"paternal grandfather"},{name:"MAk",sex:"F",top_level:!0,status:"0",display_name:"paternal grandmother"},{name:"zwB",sex:"M",top_level:!0,status:"0",display_name:"maternal grandfather"},{name:"dOH",sex:"F",top_level:!0,status:"0",display_name:"maternal grandmother"},{name:"MKg",sex:"F",mother:"MAk",father:"wZA",status:"0",display_name:"paternal aunt"},{name:"xsm",sex:"M",mother:"MAk",father:"wZA",status:"0",display_name:"paternal uncle"},{name:"m21",sex:"M",mother:"MAk",father:"wZA",status:"0",display_name:"father"},{name:"f21",sex:"F",mother:"dOH",father:"zwB",status:"0",display_name:"mother"},{name:"aOH",sex:"F",mother:"f21",father:"m21",status:"0",display_name:"sister"},{name:"Vha",sex:"M",mother:"f21",father:"m21",status:"0",display_name:"brother"},{name:"Spj",sex:"M",mother:"f21",father:"m21",noparents:!0,status:"0",display_name:"partner"},t,{name:"zhk",sex:"F",mother:"ch1",father:"Spj",status:"0",display_name:"daughter"},{name:"Knx",display_name:"son",sex:"M",mother:"ch1",father:"Spj",status:"0"},{name:"uuc",display_name:"maternal aunt",sex:"F",mother:"dOH",father:"zwB",status:"0"},{name:"xIw",display_name:"maternal uncle",sex:"M",mother:"dOH",father:"zwB",status:"0"}]:n.length>0&&"extended1"===n.val()?e.dataset=[{name:"m21",sex:"M",mother:null,father:null,status:"0",display_name:"father",noparents:!0},{name:"f21",sex:"F",mother:null,father:null,status:"0",display_name:"mother",noparents:!0},{name:"aOH",sex:"F",mother:"f21",father:"m21",status:"0",display_name:"sister"},{name:"Vha",sex:"M",mother:"f21",father:"m21",status:"0",display_name:"brother"},{name:"Spj",sex:"M",mother:"f21",father:"m21",noparents:!0,status:"0",display_name:"partner"},t,{name:"zhk",sex:"F",mother:"ch1",father:"Spj",status:"0",display_name:"daughter"},{name:"Knx",display_name:"son",sex:"M",mother:"ch1",father:"Spj",status:"0"}]:e.dataset=[{name:"m21",display_name:"father",sex:"M",top_level:!0},{name:"f21",display_name:"mother",sex:"F",top_level:!0},t],$(document).trigger("rebuild",[e])}let gn={breast_cancer:"breast_cancer_diagnosis_age",breast_cancer2:"breast_cancer2_diagnosis_age",ovarian_cancer:"ovarian_cancer_diagnosis_age",prostate_cancer:"prostate_cancer_diagnosis_age",pancreatic_cancer:"pancreatic_cancer_diagnosis_age"},yn=["brca1","brca2","palb2","atm","chek2","rad51d","rad51c","brip1"],bn=["brca1","brca2","palb2","atm","chek2","bard1","rad51d","rad51c","brip1"],vn=["brca1","brca2","palb2","atm","chek2","bard1","rad51d","rad51c","brip1","hoxb13"],wn=["er","pr","her2","ck14","ck56"];function Dn(e){return 1===(e=parseInt(e))?yn:2===e||3===e?bn:vn}function xn(e){$("#load").change((function(t){!function(e,t){let n=e.target.files[0];if(n){let e=new FileReader;e.onload=function(e){Nn(e.target.result,t)},e.onerror=function(){Tt("File Error","File could not be read! Code "+e.error)},e.readAsText(n)}$("#load")[0].value=""}(t,e)})),$("#save").click((function(t){!function(e){let t=JSON.stringify(St(e));Fn(e,t)}(e)})),$("#print").click((function(t){In(Cn(e))})),$("#svg_download").click((function(t){An(Cn(e))})),$("#png_download, .fa-file-image").click((function(t){Pn(e,4,"image/png")}))}function Sn(e,t){let n=["svg","g"],a=e.childNodes,r=t.childNodes;for(let i=0;i<a.length;i++){let e=a[i];if(-1===n.indexOf(e.tagName))try{let t=r[i].currentStyle||window.getComputedStyle(r[i]);if("undefined"===t||null===t)continue;let n=t.length,a=e.style;for(let e=0;e<n;e++){let n=t[e];(n.indexOf("text-")>-1||n.indexOf("font-")>-1)&&a.setProperty(n,t.getPropertyValue(n))}}catch(o){continue}else Sn(e,r[i])}}function Pn(e,t,n){let a=_n($("#"+e.targetDiv).find("svg"),"pedigree",{resolution:t,img_type:n});$.when.apply($,[a]).done((function(){let e=(t=arguments,n="pedigree",$.grep(t,(function(e){return e&&e.name===n}))[0]);var t,n;if(navigator.userAgent.match(/Edge/g)||function(){let e=navigator.userAgent;return e.indexOf("MSIE ")>-1||e.indexOf("Trident/")>-1}()){let t="<img src='"+e.img+"' alt='canvas image'/>";window.open().document.write(t)}else{let t=document.createElement("a");t.href=e.img,t.download="plot.png",t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}))}function kn(e){let t=e.get(0).cloneNode(!0);d3.select(t).selectAll("text").filter((function(){return 0===d3.select(this).text().length||d3.select(this),"FontAwesome"===d3.select(this).attr("font-family")})).remove(),Sn(t,e.get(0));let n=(new XMLSerializer).serializeToString(t);return"data:image/svg+xml;base64,"+window.btoa(decodeURI(encodeURI(n)))}function _n(e,t,n){let a={iscanvg:!1,resolution:1,img_type:"image/png"};n||(n=a),$.each(a,(function(e,t){e in n||(n[e]=t)}));let r=$.Deferred(),o=kn(e),i=document.createElement("canvas");i.width=e.width()*n.resolution,i.height=e.height()*n.resolution;let l=i.getContext("2d");l.fillStyle="white",l.fillRect(0,0,i.width,i.height);let s=document.createElement("img");return s.onload=function(){l.drawImage(s,0,0,i.width,i.height),r.resolve({name:t,resolution:n.resolution,img:i.toDataURL(n.img_type,1),w:i.width,h:i.height}),l.clearRect(0,0,i.width,i.height)},s.src=o,r.promise()}function Cn(e){let t=St(e);null!=t&&(e.dataset=t);let n=$("<div></div>"),a=$("#"+e.targetDiv).find("svg").clone().appendTo(n),r=555,o=792,i=un(e),l=Math.abs(i.xmax-i.xmin),s=Math.abs(i.ymax-i.ymin),d=1/Math.max(l/r,s/o),c=-(i.xmin-e.symbol_size)*d,u=-(i.ymin-e.symbol_size)*d;return a.attr("width",r),a.attr("height",s*d),a.find(".diagram").attr("transform","translate("+c+", "+u+") scale("+d+")"),n}function An(e){let t=document.createElement("a");t.href=kn(e),t.download="plot.svg",t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function In(e,t){e.constructor!==Array&&(e=[e]);let n=.9*$(window).width(),a=$(window).height()-10,r=["/static/css/canrisk.css","https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"],o=window.open("","PrintMap","width="+n+",height="+a),i="";for(let s=0;s<r.length;s++)i+='<link href="'+r[s]+'" rel="stylesheet" type="text/css" media="all">';i+="<style>body {font-size: "+$("body").css("font-size")+";}</style>";let l="";for(let s=0;s<e.length;s++)0===s&&t&&(l+=t),l+=$(e[s]).html(),s<e.length-1&&(l+='<div class="page-break"> </div>');o.document.write(i),o.document.write(l),o.document.close(),o.focus(),setTimeout((function(){o.print(),o.close()}),300)}function Fn(e,t,n,a){e.DEBUG,n||(n="ped.txt"),a||(a="text/plain");let r=new Blob([t],{type:a});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(r,n);else{let e=document.createElement("a"),t=URL.createObjectURL(r);e.href=t,e.download=n,document.body.appendChild(e),e.click(),setTimeout((function(){document.body.removeChild(e),window.URL.revokeObjectURL(t)}),0)}}function En(e){$.each(e.dataset,(function(e,t){if(!t.hidden&&"M"===t.sex&&!qt(t)&&t[gn.breast_cancer2]){let e="Male family member ("+t.display_name+") with contralateral breast cancer found. Please note that as the risk models do not take this into account the second breast cancer is ignored.";delete t[gn.breast_cancer2],Tt("Warning",e)}}))}function Nn(e,t){let n;t.DEBUG;try{if(0===e.indexOf("BOADICEA import pedigree file format 4.0"))t.dataset=Vn(e,4),En(t);else if(0===e.indexOf("BOADICEA import pedigree file format 2.0"))t.dataset=Vn(e,2),En(t);else if(0===e.indexOf("##")&&-1!==e.indexOf("CanRisk")){let a=On(e);n=a[0],t.dataset=a[1],En(t)}else try{let n=JSON.parse(e),a=!0;for(let e=0;e<n.length;e++)n[e].top_level&&(a=!1);t.dataset=a?Tn(n):n}catch(a){t.dataset=Ln(e)}Lt(t)}catch(r){return void Tt("File Error",r.message?r.message:r)}t.DEBUG;try{Ct(t),$(document).trigger("rebuild",[t]),$(document).trigger("riskfactorChange",[t,n]),$(document).trigger("fhChange",[t]);try{acc_FamHist_ticked(),acc_FamHist_Leave(),RESULT.FLAG_FAMILY_MODAL=!0}catch(o){}}catch(i){Tt("File Error",i.message?i.message:i)}}function Ln(e){let t,n=e.trim().split("\n"),a=[];for(let r=0;r<n.length;r++){let e=$.map(n[r].trim().split(/\s+/),(function(e,t){return e.trim()}));if(e.length<5)throw new Error("unknown format");let o="1"===e[4]?"M":"2"===e[4]?"F":"U",i={famid:e[0],display_name:e[1],name:e[1],sex:o};if("0"!==e[2]&&(i.father=e[2]),"0"!==e[3]&&(i.mother=e[3]),void 0!==t&&t!==i.famid)break;if("2"===e[5]&&(i.affected=2),e.length>6){i.alleles="";for(let t=6;t<e.length;t+=2)i.alleles+=e[t]+"/"+e[t+1]+";"}a.unshift(i),t=e[0]}return Tn(a)}function On(e){let[t,n]=function(e){let t=e.trim().split("\n"),n=[],a=[];const r=/([0-9])/;let o=3,i=Dn(o),l=[26,27,27,28];for(let s=0;s<t.length;s++){let e=t[s].trim();if(0===e.indexOf("##")){if(0===e.indexOf("##CanRisk")){const t=e.match(r);if(o=parseInt(t[1]),i=Dn(o),e.indexOf(";")>-1){let t=e.split(";");for(let e=1;e<t.length;e++)2===t[e].split("=").length&&a.push(t[e])}}-1===e.indexOf("CanRisk")&&0!==e.indexOf("##FamID")&&a.push(e.replace("##",""));continue}let d=/\t/;e.indexOf("\t")<0&&(d=/\s+/);let c=$.map(e.split(d),(function(e,t){return e.trim()}));if(c.length>1){if(c.length!==l[o-1])throw new Error("Found number of columns "+c.length+"; expected "+l[o-1]+" for CanRisk version "+o);let e={famid:c[0],display_name:c[1],name:c[3],sex:c[6],status:c[8]};"1"===c[2]&&(e.proband=!0),"0"!==c[4]&&(e.father=c[4]),"0"!==c[5]&&(e.mother=c[5]),"0"!==c[7]&&(e.mztwin=c[7]),"0"!==c[9]&&(e.age=c[9]),"0"!==c[10]&&(e.yob=c[10]);let t=11;$.each(gn,(function(n,a){"0"!==c[t]&&(e[a]=c[t]),t++})),"0"!==c[t++]&&(e.ashkenazi=1);for(let n=0;n<i.length;n++){let a=c[t].split(":");"0"!==a[0]?"S"!==a[0]&&"T"!==a[0]||"P"!==a[1]&&"N"!==a[1]||(e[i[n]+"_gene_test"]={type:a[0],result:a[1]}):"P"!==a[1]&&"N"!==a[1]||(e[i[n]+"_gene_test"]={type:a[0],result:a[1]}),t++}let a=c[t].split(":");for(let n=0;n<a.length;n++)"0"!==a[n]&&("N"!==a[n]&&"P"!==a[n]||(e[wn[n]+"_bc_pathology"]=a[n]));n.push(e)}}return n.sort((function(e,t){return void 0!==e.mztwin?e.mztwin.localeCompare(t.mztwin):0})),[a,n]}(e);try{return[t,Tn(n)]}catch(a){return[t,n]}}function Vn(e,t){let n=e.trim().split("\n"),a=[];for(let o=2;o<n.length;o++){let e=$.map(n[o].trim().split(/\s+/),(function(e,t){return e.trim()}));if(e.length>1){let n={famid:e[0],display_name:e[1],name:e[3],sex:e[6],status:e[8]};"1"===e[2]&&(n.proband=!0),"0"!==e[4]&&(n.father=e[4]),"0"!==e[5]&&(n.mother=e[5]),"0"!==e[7]&&(n.mztwin=e[7]),"0"!==e[9]&&(n.age=e[9]),"0"!==e[10]&&(n.yob=e[10]);let r=11;if($.each(gn,(function(t,a){"0"!==e[r]&&(n[a]=e[r]),r++})),4===t){"0"!==e[r++]&&(n.ashkenazi=1);for(let t=0;t<5;t++)r+=2,"0"!==e[r-2]&&("S"!==e[r-2]&&"T"!==e[r-2]||"P"!==e[r-1]&&"N"!==e[r-1]||(n[yn[t]+"_gene_test"]={type:e[r-2],result:e[r-1]}))}else 2===t&&(r+=2,"0"!==e[r-2]&&("S"!==e[r-2]&&"T"!==e[r-2]||("N"===e[r-1]?(n.brca1_gene_test={type:e[r-2],result:"N"},n.brca2_gene_test={type:e[r-2],result:"N"}):"1"===e[r-1]?(n.brca1_gene_test={type:e[r-2],result:"P"},n.brca2_gene_test={type:e[r-2],result:"N"}):"2"===e[r-1]?(n.brca1_gene_test={type:e[r-2],result:"N"},n.brca2_gene_test={type:e[r-2],result:"P"}):"3"===e[r-1]&&(n.brca1_gene_test={type:e[r-2],result:"P"},n.brca2_gene_test={type:e[r-2],result:"P"}))),"0"!==e[r++]&&(n.ashkenazi=1));for(let t=0;t<wn.length;t++)"0"!==e[r]&&("N"!==e[r]&&"P"!==e[r]||(n[wn[t]+"_bc_pathology"]=e[r])),r++;a.unshift(n)}}try{return Tn(a)}catch(r){return a}}function Tn(e){for(let n=0;n<2;n++)for(let t=0;t<e.length;t++)zn(e,e[t].name);!function(e){let t=!1,n=e.length;for(let a=0;a<n;a++){let n=Jt(e,e[a]),r=e[a].level;for(let a=0;a<n.length;a++)if(r-n[a].level>1){n[a].level=r-1;let o=$t(e,n[a]);for(let t=0;t<o.length;t++){let n=rn(e,o[t]);n.level=r-1;let a=rn(e,n.mother),i=rn(e,n.father);a&&(a.level=r),i&&(i.level=r)}t=!0}}}(e);let t=0;for(let n=0;n<e.length;n++)e[n].level&&e[n].level>t&&(t=e[n].level);for(let n=0;n<e.length;n++)if(1===Zt(e,e[n].name))if(e[n].level&&e[n].level===t)e[n].top_level=!0;else{e[n].noparents=!0;let t=Rn(e,e[n]);if(t>-1&&e[t].mother&&(e[n].mother=e[t].mother,e[n].father=e[t].father),!e[n].mother)for(let a=0;a<e.length;a++)if(e[n].level===e[a].level-1&&(t=Rn(e,e[a]),t>-1&&n!==t)){e[n].mother="F"===e[a].sex?e[a].name:e[t].name,e[n].father="M"===e[a].sex?e[a].name:e[t].name;break}}else delete e[n].top_level;return e}function Rn(e,t){for(let n=0;n<e.length;n++){let a=e[n];if(t.name===a.mother)return Yt(e,a.father);if(t.name===a.father)return Yt(e,a.mother)}return-1}function zn(e,t){let n=Yt(e,t);Mn(n,e[n].level?e[n].level:0,e)}function Mn(e,t,n){let a=["mother","father"];t++;for(let r=0;r<a.length;r++){let o=Yt(n,n[e][a[r]]);if(o>=0){let a=n[Yt(n,n[e].mother)],r=n[Yt(n,n[e].father)];(!n[o].level||n[o].level<t)&&(a.level=t,r.level=t),a.level<r.level?a.level=r.level:r.level<a.level&&(r.level=a.level),Mn(o,t,n)}}}var Un=Object.freeze({__proto__:null,addIO:xn,copy_svg:function(e){let t=Cn(e);return d3.select(t.get(0)).selectAll("text").filter((function(){return 0===d3.select(this).text().length||d3.select(this),"FontAwesome"===d3.select(this).attr("font-family")})).remove(),$(function(e){let t=function(e,t){let n=[],a=0;t.lastIndex=0;let r=t.exec(e);for(;r;){if(a++,a>400)return-1;n.push(r),t.lastIndex===r.index&&t.lastIndex++,r=t.exec(e)}return n}(e,/url\((&quot;|"|'){0,1}#(.*?)(&quot;|"|'){0,1}\)/g);return-1===t?"ERROR DISPLAYING PEDIGREE":($.each(t,(function(t,n){let a=n[1]?n[1]:"",r=n[2],o='id="'+r+'"',i="url\\("+a+"#"+r+a+"\\)",l=r+Rt(2);e=(e=e.replace(new RegExp(o,"g"),'id="'+l+'"')).replace(new RegExp(i,"g"),"url(#"+l+")")})),e)}(t.html()))},img_download:Pn,load_data:Nn,print:In,readBoadiceaV4:Vn,readCanRiskFile:On,readLinkage:Ln,save_file:Fn,svg2img:_n,svg_download:An});function qn(e,t){let n=[1,2,3,4,5,6,7,8,9,"A"];for(let a=0;a<e.length;a++)if(e[a][t]){let r=n.indexOf(e[a][t]);r>-1&&n.splice(r,1)}if(n.length>0)return n[0]}function Hn(e){let t=St(e),n=$("#id_name").val(),a=Ot(t),r=rn(a,n);if(!r)return;$("#"+e.targetDiv).empty();let o=$("#id_yob_0").val();o&&""!==o?r.yob=o:delete r.yob;let i=$("#id_status").find("input[type='radio']:checked");i.length>0&&(r.status=i.val());let l=["miscarriage","adopted_in","adopted_out","termination","stillbirth"];for(let p=0;p<l.length;p++){let e=l[p],t=$("#id_"+e);t.length>0&&(t.is(":checked")?r[e]=!0:delete r[e])}let s=$("#id_sex").find("input[type='radio']:checked");var d;s.length>0&&(r.sex=s.val(),d=r,$("#cancer .row").show(),"M"===d.sex?(delete d.ovarian_cancer_diagnosis_age,$("[id^='id_ovarian_cancer_diagnosis_age']").closest(".row").hide(),$("[id^='id_breast_cancer2_diagnosis_age']").prop("disabled",!0)):"F"===d.sex&&(delete d.prostate_cancer_diagnosis_age,$("[id^='id_prostate_cancer_diagnosis_age']").closest(".row").hide(),$("[id^='id_breast_cancer2_diagnosis_age']").prop("disabled",!1))),function(e){$("#orig_ashk").is(":checked")?$.each(e,(function(e,t){t.proband&&(t.ashkenazi=1)})):$.each(e,(function(e,t){delete t.ashkenazi}))}(a),$("#id_approx").is(":checked")?r.approx_diagnosis_age=!0:delete r.approx_diagnosis_age,$("#person_details select[name*='_diagnosis_age']:visible, #person_details input[type=text]:visible, #person_details input[type=number]:visible").each((function(){let e=this.name.indexOf("_diagnosis_age")>-1?this.name.substring(0,this.name.length-2):this.name;if($(this).val()){let t=$(this).val();e.indexOf("_diagnosis_age")>-1&&$("#id_approx").is(":checked")&&(t=function(e){let t=10*Math.round((e-1)/10);return e<t?t-5:t+5}(t)),r[e]=t}else delete r[e]})),$('#person_details input[type="checkbox"][name$="cancer"],input[type="checkbox"][name$="cancer2"]').each((function(){this.checked?r[$(this).attr("name")]=!0:delete r[$(this).attr("name")]})),$('#person_details select[name$="_bc_pathology"]').each((function(){"-"!==$(this).val()?r[$(this).attr("name")]=$(this).val():delete r[$(this).attr("name")]})),$('#person_details select[name$="_gene_test"]').each((function(){if("-"!==$(this).val()){let e=$('select[name="'+$(this).attr("name")+'_result"]');r[$(this).attr("name")]={type:$(this).val(),result:$(e).val()}}else delete r[$(this).attr("name")]}));let c=$('#person_details select[name="hoxb13_gene_test_result"]').val();void 0!==c&&"-"!==c?r.hoxb13_gene_test={type:"T",result:c}:delete r.hoxb13_gene_test;try{$("#person_details").find("form").valid()}catch(u){}!function(e,t){if(!t.mztwin&&!t.dztwin)return;let n=t.mztwin?"mztwin":"dztwin";for(let a=0;a<e.length;a++){let r=e[a];r[n]&&t[n]===r[n]&&r.name!==t.name&&("mztwin"===n&&(r.sex=t.sex),t.yob&&(r.yob=t.yob),!t.age||0!==t.status&&t.status||(r.age=t.age))}}(a,r),e.dataset=a,$(document).trigger("rebuild",[e])}let Bn,$n;function jn(e,t){let n=parseInt($("body").css("font-size")),a=d3.select(".diagram");a.append("rect").attr("class","popup_selection").attr("rx",6).attr("ry",6).attr("transform","translate(-1000,-100)").style("opacity",0).attr("width",7.9*n).attr("height",2*n).style("stroke","darkgrey").attr("fill","white");let r=a.append("text").attr("font-family","FontAwesome").style("opacity",0).style("font-size","1.1em").attr("class","popup_selection fa-square persontype").attr("transform","translate(-1000,-100)").attr("x",n/3).attr("y",1.5*n).text(" ").append("svg:title").text("add male"),o=a.append("text").attr("font-family","FontAwesome").style("opacity",0).style("font-size","1.1em").attr("class","popup_selection fa-circle persontype").attr("transform","translate(-1000,-100)").attr("x",1.71*n).attr("y",1.5*n).text(" ").append("svg:title").text("add female");a.append("text").attr("font-family","FontAwesome").style("opacity",0).style("font-size","1.1em").attr("transform","translate(-1000,-100)").attr("x",.065*n).attr("y",.065*-n).attr("class","popup_selection fa-unspecified popup_selection_rotate45 persontype").text(" ").append("svg:title").text("add unspecified"),a.append("text").attr("font-family","FontAwesome").style("opacity",0).style("font-size","1.6em").attr("transform","translate(-1000,-100)").attr("class","popup_selection fa-angle-up persontype dztwin").attr("x",4.62*n).attr("y",1.5*n).text(" ").append("svg:title").text("add dizygotic/fraternal twins"),a.append("text").attr("font-family","FontAwesome").style("opacity",0).style("font-size","1.6em").attr("transform","translate(-1000,-100)").attr("class","popup_selection fa-caret-up persontype mztwin").attr("x",6.4*n).attr("y",1.5*n).text(" ").append("svg:title").text("add monozygotic/identical twins");let i={};d3.selectAll(".persontype").on("click",(function(){let t,n,a=Ot(St(e)),r=d3.select(this).classed("mztwin"),o=d3.select(this).classed("dztwin");if(r||o?(n=i.node.datum().data.sex,t=r?"mztwin":"dztwin"):n=d3.select(this).classed("fa-square")?"M":d3.select(this).classed("fa-circle")?"F":"U","addsibling"===i.type)Wn(a,i.node.datum().data,n,!1,t);else{if("addchild"!==i.type)return;!function(e,t,n,a,r){if(r&&-1===$.inArray(r,["mztwin","dztwin"]))return new Error("INVALID TWIN TYPE SET: "+r);void 0===a&&(a=1);let o,i,l,s=Qt(e,t);if(0===s.length){let n=Wn(e,t,"F"===t.sex?"M":"F","F"===t.sex);n.noparents=!0,o=n.name,i=Yt(e,t.name)+1}else{let n=s[0];o=n.father===t.name?n.mother:n.father,i=Yt(e,n.name)}r&&(l=qn(e,r));let d=[];for(let c=0;c<a;c++){let a={name:Rt(4),sex:n,mother:"F"===t.sex?t.name:o,father:"F"===t.sex?o:t.name};e.splice(i,0,a),r&&(a[r]=l),d.push(a)}}(a,i.node.datum().data,t?"U":n,t?2:1,t)}e.dataset=a,$(document).trigger("rebuild",[e]),d3.selectAll(".popup_selection").style("opacity",0),i={}})).on("mouseover",(function(){i.node&&i.node.select("rect").style("opacity",.2),d3.selectAll(".popup_selection").style("opacity",1),"addsibling"===i.type?d3.select(this).classed("fa-square")?r.text("add brother"):o.text("add sister"):"addchild"===i.type&&(d3.select(this).classed("fa-square")?r.text("add son"):o.text("add daughter"))})),d3.selectAll(".popup_selection").on("mouseout",(function(){void 0!==i.node&&-1===u.indexOf(i.node.datum())&&i.node.select("rect").style("opacity",0),d3.selectAll(".popup_selection").style("opacity",0)})),function(e){function t(){Bn=$n,d3.selectAll(".line_drag_selection").attr("stroke","darkred")}function n(t){if($n&&Bn.data.name!==$n.data.name&&Bn.data.sex!==$n.data.sex){let t={name:Rt(4),sex:"U",mother:"F"===Bn.data.sex?Bn.data.name:$n.data.name,father:"F"===Bn.data.sex?$n.data.name:Bn.data.name},n=Ot(e.dataset);e.dataset=n;let a=Yt(e.dataset,Bn.data.name)+1;e.dataset.splice(a,0,t),$(document).trigger("rebuild",[e])}Jn(0,0,0,0),d3.selectAll(".line_drag_selection").attr("stroke","black"),Bn=void 0}function a(t){t.sourceEvent.stopPropagation();let n=t.dx,a=t.dy,r=parseFloat(d3.select(this).attr("x2"))+n,o=parseFloat(d3.select(this).attr("y2"))+a;Jn(e.symbol_size-10,0,r,o)}d3.select(".diagram").append("line").attr("class","line_drag_selection").attr("stroke-width",6).style("stroke-dasharray","2, 1").attr("stroke","black").call(d3.drag().on("start",t).on("drag",a).on("end",n)).append("svg:title").text("drag to create consanguineous partners"),Jn(0,0,0,0)}(e),t.filter((function(t){return!(t.data.hidden&&!e.DEBUG)})).append("rect").attr("class","indi_rect").attr("rx",6).attr("ry",6).attr("x",(function(t){return-.75*e.symbol_size})).attr("y",(function(t){return-e.symbol_size})).attr("width",1.5*e.symbol_size+"px").attr("height",2*e.symbol_size+"px").style("stroke","black").style("stroke-width",.7).style("opacity",0).attr("fill","lightgrey");let l=function(t){return d-.75*e.symbol_size},s=e.symbol_size-2,d=0,c={addchild:{text:"",title:"add child",fx:l,fy:s},addsibling:{text:"",title:"add sibling",fx:l,fy:s},addpartner:{text:"",title:"add partner",fx:l,fy:s},addparents:{text:"",title:"add parents",fx:-.75*e.symbol_size,fy:11-e.symbol_size},delete:{text:"X",title:"delete",fx:e.symbol_size/2-1,fy:12-e.symbol_size,styles:{"font-weight":"bold",fill:"darkred","font-family":"monospace"}}};e.edit&&(c.settings={text:"",title:"settings",fx:-n/2+2,fy:11-e.symbol_size});for(let p in c){let n=t.filter((function(t){return!(t.data.hidden&&!e.DEBUG||(void 0===t.data.mother||t.data.noparents)&&"addsibling"===p||void 0!==t.data.parent_node&&t.data.parent_node.length>1&&"addpartner"===p||void 0===t.data.parent_node&&"addchild"===p||void 0===t.data.noparents&&void 0===t.data.top_level&&"addparents"===p)})).append("text").attr("class",p).style("opacity",0).attr("font-family","FontAwesome").attr("xx",(function(e){return e.x})).attr("yy",(function(e){return e.y})).attr("x",c[p].fx).attr("y",c[p].fy).attr("font-size","0.85em").text(c[p].text);if("styles"in c[p])for(let e in c[p].styles)n.attr(e,c[p].styles[e]);n.append("svg:title").text(c[p].title),d+=17}d3.selectAll(".addsibling, .addchild").on("mouseover",(function(){let e=d3.select(this).attr("class");d3.selectAll(".popup_selection").style("opacity",1),i={node:d3.select(this.parentNode),type:e};let t=parseInt(d3.select(this).attr("xx"))+parseInt(d3.select(this).attr("x")),a=parseInt(d3.select(this).attr("yy"))+parseInt(d3.select(this).attr("y"));d3.selectAll(".popup_selection").attr("transform","translate("+t+","+(a+2)+")"),d3.selectAll(".popup_selection_rotate45").attr("transform","translate("+(t+3*n)+","+(a+1.2*n)+") rotate(45)")})),d3.selectAll(".addchild, .addpartner, .addparents, .delete, .settings").on("click",(function(t){t.stopPropagation();let n,a=d3.select(this).attr("class"),r=d3.select(this.parentNode).datum();e.DEBUG,"settings"===a?"function"==typeof e.edit?e.edit(e,r):function(e,t){$("#node_properties").dialog({autoOpen:!1,title:t.data.display_name,width:$(window).width()>400?450:$(window).width()-30});let n="<table id='person_details' class='table'>";n+="<tr><td style='text-align:right'>Unique ID</td><td><input class='form-control' type='text' id='id_name' name='name' value="+(t.data.name?t.data.name:"")+"></td></tr>",n+="<tr><td style='text-align:right'>Name</td><td><input class='form-control' type='text' id='id_display_name' name='display_name' value="+(t.data.display_name?t.data.display_name:"")+"></td></tr>",n+="<tr><td style='text-align:right'>Age</td><td><input class='form-control' type='number' id='id_age' min='0' max='120' name='age' style='width:7em' value="+(t.data.age?t.data.age:"")+"></td></tr>",n+="<tr><td style='text-align:right'>Year Of Birth</td><td><input class='form-control' type='number' id='id_yob' min='1900' max='2050' name='yob' style='width:7em' value="+(t.data.yob?t.data.yob:"")+"></td></tr>",n+='<tr><td colspan="2" id="id_sex"><label class="radio-inline"><input type="radio" name="sex" value="M" '+("M"===t.data.sex?"checked":"")+'>Male</label><label class="radio-inline"><input type="radio" name="sex" value="F" '+("F"===t.data.sex?"checked":"")+'>Female</label><label class="radio-inline"><input type="radio" name="sex" value="U">Unknown</label></td></tr>',n+='<tr><td colspan="2" id="id_status"><label class="checkbox-inline"><input type="radio" name="status" value="0" '+(0===parseInt(t.data.status)?"checked":"")+'>&thinsp;Alive</label><label class="checkbox-inline"><input type="radio" name="status" value="1" '+(1===parseInt(t.data.status)?"checked":"")+">&thinsp;Deceased</label></td></tr>",$("#id_status input[value='"+t.data.status+"']").prop("checked",!0);let a=["adopted_in","adopted_out","miscarriage","stillbirth","termination"];n+='<tr><td colspan="2"><strong>Reproduction:</strong></td></tr>',n+='<tr><td colspan="2">';for(let o=0;o<a.length;o++){let e=a[o];2===o&&(n+='</td></tr><tr><td colspan="2">'),n+='<label class="checkbox-inline"><input type="checkbox" id="id_'+e+'" name="'+e+'" value="0" '+(t.data[e]?"checked":"")+">&thinsp;"+Kn(e.replace("_"," "))+"</label>"}n+="</td></tr>";let r=["children","name","parent_node","top_level","id","noparents","level","age","sex","status","display_name","mother","father","yob","mztwin","dztwin"];$.merge(r,a),n+='<tr><td colspan="2"><strong>Age of Diagnosis:</strong></td></tr>',$.each(e.diseases,(function(a,o){r.push(o.type+"_diagnosis_age");let i='&thinsp;<span style="padding-left:5px;background:'+e.diseases[a].colour+'"></span>',l=t.data[o.type+"_diagnosis_age"];n+="<tr><td style='text-align:right'>"+Kn(o.type.replace("_"," "))+i+"&nbsp;</td><td><input class='form-control' id='id_"+o.type+"_diagnosis_age_0' max='110' min='0' name='"+o.type+"_diagnosis_age_0' style='width:5em' type='number' value='"+(void 0!==l?l:"")+"'></td></tr>"})),n+='<tr><td colspan="2" style="line-height:1px;"></td></tr>',$.each(t.data,(function(e,t){if(-1===$.inArray(e,r)){let a=Kn(e);!0===t||!1===t?n+="<tr><td style='text-align:right'>"+a+"&nbsp;</td><td><input type='checkbox' id='id_"+e+"' name='"+e+"' value="+t+" "+(t?"checked":"")+"></td></tr>":e.length>0&&(n+="<tr><td style='text-align:right'>"+a+"&nbsp;</td><td><input type='text' id='id_"+e+"' name='"+e+"' value="+t+"></td></tr>")}})),n+="</table>",$("#node_properties").html(n),$("#node_properties").dialog("open"),$("#node_properties input[type=radio], #node_properties input[type=checkbox], #node_properties input[type=text], #node_properties input[type=number]").change((function(){Hn(e)}))}(e,r):"delete"===a?(n=Ot(St(e)),function(e,t,n,a){let r,o,i,l=Et[n.targetDiv],s=tn(l),d=[];if(void 0===t.id){let e=rn(s,t.name);void 0!==e&&(t=e.data)}if(t.parent_node)for(r=0;r<t.parent_node.length;r++){let n=t.parent_node[r],a=[rn(e,n.mother.name),rn(e,n.father.name)];for(o=0;o<a.length;o++)(a[o].name===t.name||void 0!==a[o].noparents||a[o].top_level)&&(e.splice(Yt(e,a[o].name),1),d.push(a[o]));let i=n.children,c=$.map(i,(function(e,t){return e.name}));for(o=0;o<i.length;o++){let t=rn(e,i[o].name);if(t){t.noparents=!0;let n,a=$t(e,t);if(a.length>0&&(n=rn(e,a[0])),n&&n.mother!==t.mother)t.mother=n.mother,t.father=n.father;else if(n){let e=Qn(l,rn(s,t.name),c);t.mother=e[0]?e[0].data.mother:e[1]?e[1].data.mother:null,t.father=e[0]?e[0].data.father:e[1]?e[1].data.father:null}else e.splice(Yt(e,t.name),1)}}}else e.splice(Yt(e,t.name),1);for(r=0;r<d.length;r++){let t=d[r];if(Wt(e,t).length<1){let n=rn(s,t.name).ancestors();for(o=0;o<n.length;o++)n[o].data.mother&&(e.splice(Yt(e,n[o].data.mother.name),1),e.splice(Yt(e,n[o].data.father.name),1))}}!function(e){let t=["mztwin","dztwin"];for(let n=0;n<e.length;n++)for(let a=0;a<t.length;a++){let r=t[a];if(e[n][r]){let t=0;for(let a=0;a<e.length;a++)e[a][r]===e[n][r]&&t++;t<2&&delete e[n][[r]]}}}(e);try{let t=$.extend({},n);t.dataset=Ot(e),Lt(t),i=jt(e)}catch(c){throw Tt("Warning","Deletion of this pedigree member is disallowed."),c}if(i.length>0&&0===jt(n.dataset).length)return void Tt("Warning","Deleting this will split the pedigree. Continue?",a,n,e);a&&a(n,e)}(n,r.data,e,Gn)):"addparents"===a?(n=Ot(St(e)),e.dataset=n,function(e,t,n){let a,r,o,i,l=Et[e.targetDiv],s=tn(l),d=rn(s,n),c=d.data,u=d.depth,p=-101,f=Qt(t,c);f.length>0&&(o=f[0].mother===c.name?f[0].father:f[0].mother,p=rn(s,o).data.id);if(1===u)for(a={name:Rt(4),sex:"F",top_level:!0},r={name:Rt(4),sex:"M",top_level:!0},t.splice(0,0,a),t.splice(0,0,r),i=0;i<t.length;i++)!t[i].top_level&&2!==Zt(t,t[i].name)||t[i].name===a.name||t[i].name===r.name||(delete t[i].top_level,t[i].noparents=!0,t[i].mother=a.name,t[i].father=r.name);else{let n=rn(s,d.data.mother),o=rn(s,d.data.father),l=Wt(t,c),u=1e4,f=d.data.id;for(i=0;i<l.length;i++){let e=rn(s,l[i].name).data.id;e<u&&e>d.data.id&&(u=e),e<f&&(f=e)}let h,m=f>=d.data.id||p===f&&u<1e4;e.DEBUG,h=!m&&o.data.id>n.data.id||m&&o.data.id<n.data.id?Yt(t,c.father):Yt(t,c.mother);let g=t[h];r=Wn(t,g,"M",m),a=Wn(t,g,"F",m);let y=Yt(t,r.name),b=Yt(t,a.name);if(y>b){let e=t[y];t[y]=t[b],t[b]=e}let v=function(e,t){return $.map(e,(function(e,n){return e.name!==t.name&&"noparents"in e&&e.mother===t.mother&&e.father===t.father?e:null}))}(t,c),w=d.data.id;for(i=0;i<v.length;i++){let n=rn(s,v[i].name).data.id;if(e.DEBUG,(m||w<n)&&n<u){let e=Yt(t,v[i].name);t[e].mother=a.name,t[e].father=r.name}}}2===u?(a.top_level=!0,r.top_level=!0):u>2&&(a.noparents=!0,r.noparents=!0);let h=Yt(t,c.name);if(t[h].mother=a.name,t[h].father=r.name,delete t[h].noparents,"parent_node"in c){let e=t[Yt(t,o)];"noparents"in e&&(e.mother=a.name,e.father=r.name)}}(e,n,r.data.name),$(document).trigger("rebuild",[e])):"addpartner"===a&&(n=Ot(St(e)),function(e,t,n){let a=Et[e.targetDiv],r=rn(tn(a),n),o=Wn(t,r.data,"F"===r.data.sex?"M":"F","F"===r.data.sex);o.noparents=!0;let i={name:Rt(4),sex:"M"};i.mother="F"===r.data.sex?r.data.name:o.name,i.father="F"===r.data.sex?o.name:r.data.name;let l=Yt(t,r.data.name)+2;t.splice(l,0,i)}(e,n,r.data.name),e.dataset=n,$(document).trigger("rebuild",[e])),$(document).trigger("fhChange",[e])}));let u=[];t.filter((function(e){return!e.data.hidden})).on("click",(function(t,n){t.ctrlKey?-1===u.indexOf(n)?u.push(n):u.splice(u.indexOf(n),1):u=[n],"nodeclick"in e&&(e.nodeclick(n.data),d3.selectAll(".indi_rect").style("opacity",0),d3.selectAll(".indi_rect").filter((function(e){return-1!==u.indexOf(e)})).style("opacity",.5))})).on("mouseover",(function(t,n){t.stopPropagation(),$n=n,Bn?Bn.data.name!==$n.data.name&&Bn.data.sex!==$n.data.sex&&d3.select(this).select("rect").style("opacity",.2):(d3.select(this).select("rect").style("opacity",.2),d3.select(this).selectAll(".addchild, .addsibling, .addpartner, .addparents, .delete, .settings").style("opacity",1),d3.select(this).selectAll(".indi_details").style("opacity",0),Jn(e.symbol_size-10,0,e.symbol_size-2,0,n.x+","+(n.y+2)))})).on("mouseout",(function(t){if(Bn)return;d3.select(this).selectAll(".addchild, .addsibling, .addpartner, .addparents, .delete, .settings").style("opacity",0),-1===u.indexOf(t)&&d3.select(this).select("rect").style("opacity",0),d3.select(this).selectAll(".indi_details").style("opacity",1);let n=d3.pointer(t)[0],a=d3.pointer(t)[1];a<.8*e.symbol_size&&d3.selectAll(".popup_selection").style("opacity",0),Bn||(Math.abs(a)>.25*e.symbol_size||Math.abs(a)<-.25*e.symbol_size||n<.2*e.symbol_size)&&Jn(0,0,0,0)}))}function Gn(e,t){e.dataset=t,$(document).trigger("rebuild",[e])}function Jn(e,t,n,a,r){r&&d3.selectAll(".line_drag_selection").attr("transform","translate("+r+")"),d3.selectAll(".line_drag_selection").attr("x1",e).attr("y1",t).attr("x2",n).attr("y2",a)}function Kn(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Wn(e,t,n,a,r){if(r&&-1===$.inArray(r,["mztwin","dztwin"]))return new Error("INVALID TWIN TYPE SET: "+r);let o={name:Rt(4),sex:n};t.top_level?o.top_level=!0:(o.mother=t.mother,o.father=t.father);let i=Yt(e,t.name);return r&&function(e,t,n,a){!t[a]&&(t[a]=qn(e,a),!t[a])||(n[a]=t[a],t.yob&&(n.yob=t.yob),!t.age||"0"!==t.status&&t.status||(n.age=t.age))}(e,e[i],o,r),a?i>0&&i--:i++,e.splice(i,0,o),o}function Qn(e,t,n){let a,r,o=Xt(tn(e),t.depth,n);for(let i=0;i<o.length;i++)o[i].x<t.x&&(a=o[i]),!r&&o[i].x>t.x&&(r=o[i]);return[a,r]}function Zn(e,t){ta(e,t,-.4*e.symbol_size,-.1*e.symbol_size,(function(t){return e.DEBUG?("display_name"in t.data?t.data.display_name:t.data.name)+"  "+t.data.id:"display_name"in t.data?t.data.display_name:""}),void 0,["display_name"]);let n=parseInt(function(e){let t=e.font_size;if(t===parseInt(t,10))return t;if(t.indexOf("px")>-1)return t.replace("px","");if(-1===t.indexOf("em"))return t;return t=parseFloat(t.replace("em","")),parseFloat(getComputedStyle($("#"+e.targetDiv).get(0)).fontSize)*t-1}(e))+4;for(let a=0;a<e.labels.length;a++){let r=e.labels[a],o=Array.isArray(r)?r:[r];(o.indexOf("age")>-1||o.indexOf("yob")>-1)&&ta(e,t,-e.symbol_size,(function(e){return Xn(e,o,n)}),(function(e){return Yn(e,o)}),"indi_details",o)}for(let a=0;a<e.diseases.length;a++){let r=e.diseases[a].type;ta(e,t,-e.symbol_size,(function(e){return Xn(e,[r],n)}),(function(e){let t=r.replace("_"," ").replace("cancer","ca.");return r+"_diagnosis_age"in e.data?t+": "+e.data[r+"_diagnosis_age"]:""}),"indi_details",[r])}for(let a=0;a<e.labels.length;a++){let r=e.labels[a],o=Array.isArray(r)?r:[r];-1===o.indexOf("age")&&-1===o.indexOf("yob")&&ta(e,t,-e.symbol_size,(function(e){return Xn(e,o,n)}),(function(e){return Yn(e,o)}),"indi_details",o)}}function Yn(e,t){let n="";for(let a=0;a<t.length;a++){let r=t[a];if(e.data[r])if("alleles"===r){let t=e.data.alleles.split(";");for(let e=0;e<t.length;e++)""!==t[e]&&(n+=t[e]+";")}else if("age"===r)n+=e.data[r]+"y ";else if("stillbirth"===r)n+="SB";else if(r.match("_gene_test$")&&"result"in e.data[r]){let t=e.data[r].result.toUpperCase();"-"!==t&&(n+=r.replace("_gene_test","").toUpperCase(),n+="P"===t?"+ ":"N"===t?"- ":" ")}else if(r.match("_bc_pathology$")){let t=e.data[r].toUpperCase();n+=r.replace("_bc_pathology","").toUpperCase(),n+="P"===t?"+ ":"N"===t?"- ":" "}else n+=e.data[r]}if(""!==n)return n}function Xn(e,t,n){if(ea(e,t))return e.y_offset=e.y_offset?e.y_offset+n:2.35*n,e.y_offset}function ea(e,t){for(let n=0;n<t.length;n++)if(Vt(t[n],e.data))return!0;return!1}function ta(e,t,n,a,r,o,i){t.filter((function(e){return!e.data.hidden&&(!i||ea(e,i))})).append("text").attr("class",o?o+" ped_label":"ped_label").attr("x",n).attr("y",a).attr("font-family",e.font_family).attr("font-size",e.font_size).attr("font-weight",e.font_weight).text(r)}function na(e,t,n){if(n>=e.length)for(var a=n-e.length+1;a--;)e.push(void 0);return e.splice(n,0,e.splice(t,1)[0]),e}function aa(e){let t=$.extend({targetDiv:"pedigree_edit",dataset:[{name:"m21",display_name:"father",sex:"M",top_level:!0},{name:"f21",display_name:"mother",sex:"F",top_level:!0},{name:"ch1",display_name:"me",sex:"F",mother:"f21",father:"m21",proband:!0}],width:600,height:400,symbol_size:35,zoomSrc:["wheel","button"],zoomIn:1,zoomOut:1,dragNode:!0,showWidgets:!0,diseases:[{type:"breast_cancer",colour:"#F68F35"},{type:"breast_cancer2",colour:"pink"},{type:"ovarian_cancer",colour:"#306430"},{type:"pancreatic_cancer",colour:"#4289BA"},{type:"prostate_cancer",colour:"#D5494A"}],labels:["stillbirth",["age","yob"],"alleles",["brca1_gene_test","brca2_gene_test","palb2_gene_test","chek2_gene_test","atm_gene_test"],["rad51d_gene_test","rad51c_gene_test","brip1_gene_test","hoxb13_gene_test"],["er_bc_pathology","pr_bc_pathology","her2_bc_pathology","ck14_bc_pathology","ck56_bc_pathology"]],keep_proband_on_reset:!1,font_size:".75em",font_family:"Helvetica",font_weight:700,background:"#FAFAFA",node_background:"#fdfdfd",validate:!0,DEBUG:!1},e);0===$("#fullscreen").length&&(hn(t),xn(t)),-1===xt(t)&&Dt(t),function(e){let t=vt(e),n=xt(e),a="#"+e.btn_target;n<=t?$(a+" .fa-redo").addClass("fg-grey"):$(a+" .fa-redo").removeClass("fg-grey"),t>1?$(a+" .fa-undo").removeClass("fg-grey"):$(a+" .fa-undo").addClass("fg-grey")}(t),Lt(t),t.dataset=function(e){for(let r=0;r<e.length;r++)2===Zt(e,e[r].name)&&(e[r].top_level=!0);let t=[],n=[];for(let r=0;r<e.length;r++){let a=e[r];if("top_level"in a&&-1===$.inArray(a.name,n)){n.push(a.name),t.push(a);let r=$t(e,a);for(let a=0;a<r.length;a++)-1===$.inArray(r[a],n)&&(n.push(r[a]),t.push(rn(e,r[a])))}}let a=$.map(e,(function(e,t){return"top_level"in e&&e.top_level?null:e}));for(let r=t.length;r>0;--r)a.unshift(t[r-1]);return a}(t.dataset),t.DEBUG&&function(e){let t;$("#pedigree_data").remove(),$("body").append("<div id='pedigree_data'></div>");for(let n=0;n<e.dataset.length;n++){let a="<div class='row'><strong class='col-md-1 text-right'>"+e.dataset[n].name+"</strong><div class='col-md-11'>";for(t in e.dataset[n])"name"!==t&&("parent"===t?a+="<span>"+t+":"+e.dataset[n][t].name+"; </span>":"children"===t?void 0!==e.dataset[n][t][0]&&(a+="<span>"+t+":"+e.dataset[n][t][0].name+"; </span>"):a+="<span>"+t+":"+e.dataset[n][t]+"; </span>");$("#pedigree_data").append(a+"</div></div>")}for(t in $("#pedigree_data").append("<br /><br />"),e)"dataset"!==t&&$("#pedigree_data").append("<span>"+t+":"+e[t]+"; </span>")}(t);let n=ln(t),a=d3.select("#"+t.targetDiv).append("svg:svg").attr("width",n.width).attr("height",n.height);a.append("rect").attr("width","100%").attr("height","100%").attr("rx",6).attr("ry",6).style("stroke","darkgrey").style("fill",t.background).style("stroke-width",1);let r=a.append("g").attr("class","diagram"),o={name:"hidden_root",id:0,hidden:!0,children:$.map(t.dataset,(function(e,t){return"top_level"in e&&e.top_level?e:null}))},i=zt(t,o,o)[0],l=d3.hierarchy(o);Et[t.targetDiv]=l;let s=function(e){let t=ln(e),n=0,a={};for(let o=0;o<e.dataset.length;o++){let t=Zt(e.dataset,e.dataset[o].name),r=Qt(e.dataset,e.dataset[o]),i=1+(r.length>0?.55+.25*r.length:0)+(e.dataset[o].father?.25:0);t in a?a[t]+=i:a[t]=i,a[t]>n&&(n=a[t])}let r=Object.keys(a).length*e.symbol_size*3.5;return{width:t.width-e.symbol_size>n*e.symbol_size*1.65?t.width-e.symbol_size:n*e.symbol_size*1.65,height:t.height-e.symbol_size>r?t.height-e.symbol_size:r}}(t);t.DEBUG;let d=d3.tree().separation((function(e,t){return e.parent===t.parent||e.data.hidden||t.data.hidden?1.2:2.2})).size([s.width,s.height])(l.sort((function(e,t){return e.data.id-t.data.id}))),c=d.descendants();if($.map(t.dataset,(function(e,t){return e.hidden?null:e})).length!==t.dataset.length)throw Nt("NUMBER OF VISIBLE NODES DIFFERENT TO NUMBER IN THE DATASET");nn(t,d,c);let u=function(e,t){let n=[];for(let a=0;a<t.length;a++)n.push({mother:rn(e,t[a].mother.name),father:rn(e,t[a].father.name)});return n}(c,i);!function(e,t){for(let n=0;n<t.length;n++){ia(e,t[n])}}(t,u);let p=r.selectAll(".node").data(d.descendants()).enter().append("g").attr("transform",(function(e,t){return"translate("+e.x+","+e.y+")"}));p.filter((function(e){return!e.data.hidden})).append("path").attr("shape-rendering","geometricPrecision").attr("transform",(function(e){return ra(e.data.sex)||e.data.miscarriage||e.data.termination?"":"rotate(45)"})).attr("d",d3.symbol().size((function(e){return t.symbol_size*t.symbol_size+2})).type((function(e){return e.data.miscarriage||e.data.termination?d3.symbolTriangle:"F"===e.data.sex?d3.symbolCircle:d3.symbolSquare}))).style("stroke",(function(e){return e.data.age&&e.data.yob&&!e.data.exclude?"#303030":"grey"})).style("stroke-width",(function(e){return e.data.age&&e.data.yob&&!e.data.exclude?".3em":".1em"})).style("stroke-dasharray",(function(e){return e.data.exclude?"3, 3":null})).style("fill","none"),p.filter((function(e){return!(e.data.hidden&&!t.DEBUG)})).append("clipPath").attr("id",(function(e){return e.data.name})).append("path").attr("class","node").attr("transform",(function(e){return ra(e.data.sex)||e.data.miscarriage||e.data.termination?"":"rotate(45)"})).attr("d",d3.symbol().size((function(e){return e.data.hidden?t.symbol_size*t.symbol_size/5:t.symbol_size*t.symbol_size})).type((function(e){return e.data.miscarriage||e.data.termination?d3.symbolTriangle:"F"===e.data.sex?d3.symbolCircle:d3.symbolSquare}))),p.filter((function(e){return!(e.data.hidden&&!t.DEBUG)})).selectAll("pienode").data((function(e){let n=0,a=$.map(t.diseases,(function(a,r){return Vt(t.diseases[r].type,e.data)?(n++,1):0}));return 0===n&&(a=[1]),[$.map(a,(function(t,a){return{cancer:t,ncancers:n,id:e.data.name,sex:e.data.sex,proband:e.data.proband,hidden:e.data.hidden,affected:e.data.affected,exclude:e.data.exclude}}))]})).enter().append("g").selectAll("path").data(d3.pie().value((function(e){return e.cancer}))).enter().append("path").attr("clip-path",(function(e){return"url(#"+e.data.id+")"})).attr("class","pienode").attr("d",d3.arc().innerRadius(0).outerRadius(t.symbol_size)).style("fill",(function(e,n){return e.data.exclude?"lightgrey":0===e.data.ncancers?e.data.affected?"darkgrey":t.node_background:t.diseases[n].colour})),p.filter((function(e){return!e.data.hidden&&(e.data.adopted_in||e.data.adopted_out)})).append("path").attr("d",(function(e){let n=-.66*t.symbol_size,a=-.64*t.symbol_size,r=t.symbol_size/4;return oa(n,a,r,t)+oa(-n,a,-r,t)})).style("stroke",(function(e){return e.data.age&&e.data.yob&&!e.data.exclude?"#303030":"grey"})).style("stroke-width",(function(e){return".1em"})).style("stroke-dasharray",(function(e){return e.data.exclude?"3, 3":null})).style("fill","none"),p.filter((function(e){return"1"===e.data.status||1===e.data.status})).append("line").style("stroke","black").attr("x1",(function(e,n){return-.6*t.symbol_size})).attr("y1",(function(e,n){return.6*t.symbol_size})).attr("x2",(function(e,n){return.6*t.symbol_size})).attr("y2",(function(e,n){return-.6*t.symbol_size})),Zn(t,p),t.showWidgets&&jn(t,p);let f={},h=function(e,t,n,a,r,o){let i=function(e,t){return e+1<t?i(++e):e},l="";for(let s=0;s<e.length;s++){let d=i(s,e.length),c=e[s]-t-o,u=e[d]+t+o;r.x>c&&r.x<u&&(r.y=a),l+="L"+c+","+(n-o)+"L"+c+","+(a-o)+"L"+u+","+(a-o)+"L"+u+","+(n-o),s=d}return l};i=r.selectAll(".partner").data(u).enter().insert("path","g").attr("fill","none").attr("stroke","#000").attr("shape-rendering","auto").attr("d",(function(e,n){let a,r,o,i=function(e,t,n){if(e.depth!==t.depth)return!0;let a=en(n.dataset,e),r=en(n.dataset,t),o=$.map(a,(function(e,t){return e.name})),i=$.map(r,(function(e,t){return e.name})),l=!1;return $.each(o,(function(e,t){if(-1!==$.inArray(t,i))return l=!0,!1})),l}(rn(c,e.mother.data.name),rn(c,e.father.data.name),t),l=e.mother.data.divorced&&e.mother.data.divorced===e.father.data.name,s=e.mother.x<e.father.x?e.mother.x:e.father.x,d=e.mother.x<e.father.x?e.father.x:e.mother.x,u=e.mother.y,p=ia(t,e),m="";if(p){e.mother.depth in f?f[e.mother.depth]+=4:f[e.mother.depth]=4,u-=f[e.mother.depth],r=f[e.mother.depth]+t.symbol_size/2+2;let n=e.mother.data.parent_node,i=n[0];for(let t=0;t<n.length;t++)n[t].father.name===e.father.data.name&&n[t].mother.name===e.mother.data.name&&(i=n[t].name);o=rn(c,i),o.y=u,p.sort((function(e,t){return e-t})),a=u-t.symbol_size/2-3,m=h(p,r,u,a,o,0)}let g="";if(l&&!p&&(g="M"+(s+.66*(d-s)+6)+","+(u-6)+"L"+(s+.66*(d-s)-6)+","+(u+6)+"M"+(s+.66*(d-s)+10)+","+(u-6)+"L"+(s+.66*(d-s)-2)+","+(u+6)),i){u=e.mother.x<e.father.x?e.mother.y:e.father.y,a=e.mother.x<e.father.x?e.father.y:e.mother.y;let t=3;if(Math.abs(u-a)>.1)return"M"+s+","+u+"L"+d+","+a+"M"+s+","+(u-t)+"L"+d+","+(a-t);return"M"+s+","+u+m+"L"+d+","+u+"M"+s+","+(u-t)+(p?h(p,r,u,a,o,t):"")+"L"+d+","+(u-t)+g}return"M"+s+","+u+m+"L"+d+","+u+g})),r.selectAll(".link").data(l.links(d.descendants())).enter().filter((function(e){return t.DEBUG||void 0===e.target.data.noparents&&null!==e.source.parent&&!e.target.data.hidden})).insert("path","g").attr("fill","none").attr("stroke-width",(function(e,n){return void 0!==e.target.data.noparents||null===e.source.parent||e.target.data.hidden?1:t.DEBUG?2:1})).attr("stroke",(function(e,t){return void 0!==e.target.data.noparents||null===e.source.parent||e.target.data.hidden?"pink":"#000"})).attr("stroke-dasharray",(function(e,n){if(!e.target.data.adopted_in)return null;let a=Math.abs(e.source.y-(e.source.y+e.target.y)/2),r=[a,0,Math.abs(e.source.x-e.target.x),0];Kt(t.dataset,e.target.data).length>=1&&(a*=3);for(let t=0;t<a;t+=10)$.merge(r,[5,5]);return r})).attr("shape-rendering",(function(e,t){return e.target.data.mztwin||e.target.data.dztwin?"geometricPrecision":"auto"})).attr("d",(function(e,n){if(e.target.data.mztwin||e.target.data.dztwin){let n=Kt(t.dataset,e.target.data);if(n.length>=1){let a=0,r=e.target.x;for(let e=0;e<n.length;e++){let t=rn(c,n[e].name).x;r>t&&(r=t),a+=t}let o=(e.target.x+a)/(n.length+1),i=(e.source.y+e.target.y)/2,l="";if(r===e.target.x&&e.target.data.mztwin){let n=(o+e.target.x)/2,a=(i+(e.target.y-t.symbol_size/2))/2;l="M"+n+","+a+"L"+(o+(o-n))+" "+a}return"M"+e.source.x+","+e.source.y+"V"+i+"H"+o+"L"+e.target.x+" "+(e.target.y-t.symbol_size/2)+l}}if(e.source.data.mother){let t=rn(c,e.source.data.mother.name),n=rn(c,e.source.data.father.name);if(t.depth!==n.depth)return"M"+e.source.x+","+(t.y+n.y)/2+"H"+e.target.x+"V"+e.target.y}return"M"+e.source.x+","+e.source.y+"V"+(e.source.y+e.target.y)/2+"H"+e.target.x+"V"+e.target.y}));let m=Gt(t.dataset);if(void 0!==m){let e=rn(c,t.dataset[m].name),n="triangle"+Rt(3);r.append("svg:defs").append("svg:marker").attr("id",n).attr("refX",6).attr("refY",6).attr("markerWidth",20).attr("markerHeight",20).attr("orient","auto").append("path").attr("d","M 0 0 12 6 0 12 3 6").style("fill","black"),r.append("line").attr("x1",e.x-t.symbol_size/.7).attr("y1",e.y+t.symbol_size/1.4).attr("x2",e.x-t.symbol_size/1.4).attr("y2",e.y+t.symbol_size/4).attr("stroke-width",1).attr("stroke","black").attr("marker-end","url(#"+n+")")}return sn(t,a),t.dragNode&&function(e,t){let n,a;t.filter((function(e){return!e.data.hidden})).call(d3.drag().filter((function(e){return!e.ctrlKey&&!e.button&&e.shiftKey})).on("start",(function(){n=d3.select(this).select(".indi_rect").attr("x")})).on("drag",(function(e){e.sourceEvent.stopPropagation();let t=e.dx,n=d3.select(this).select(".indi_rect");a=parseFloat(n.attr("x"))+t,n.attr("x",a)})).on("end",(function(t){let r=d3.select(this).datum().data,o=1===$t(e.dataset,r).length?$t(e.dataset,r)[0]:-1;d3.select(this).select(".indi_rect").attr("x",n);const i=a>n;let l,s,d,c=Et[e.targetDiv],u=rn(tn(c),r.name),p=Xt(tn(c),u.depth);a+=u.x;let f,h=-Number.MAX_VALUE,m=Number.MAX_VALUE;for(let e=0;e<p.length;e++)p[e].x<a&&p[e].x>h?(l=p[e],h=p[e].x):p[e].x>a&&p[e].x<m&&(s=p[e],m=p[e].x);if(void 0===l&&void 0===s)return;i?(f=Yt(e.dataset,l.data.name),d=l):(f=Yt(e.dataset,s.data.name),d=s);let g=Ot(St(e)),y=Yt(e.dataset,r.name);na(g,y,f),-1!==o&&o!==d.data.name&&(y=Yt(g,o),na(g,y,f)),e.dataset=g,$(document).trigger("rebuild",[e])})))}(t,p),t}function ra(e){return"M"===e||"F"===e}function oa(e,t,n,a){return"M"+(e+n)+","+t+"L"+e+" "+t+"L"+e+" "+(t+1.28*a.symbol_size)+"L"+e+" "+(t+1.28*a.symbol_size)+"L"+(e+n)+","+(t+1.28*a.symbol_size)}function ia(e,t){let n,a,r=tn(Et[e.targetDiv]);if("name"in t){if(!("mother"in(t=rn(r,t.name)).data))return null;n=rn(r,t.data.mother),a=rn(r,t.data.father)}else n=t.mother,a=t.father;let o=n.x<a.x?n.x:a.x,i=n.x<a.x?a.x:n.x,l=n.y,s=$.map(r,(function(e,t){return!e.data.hidden&&e.data.name!==n.data.name&&e.data.name!==a.data.name&&e.y===l&&e.x>o&&e.x<i?e.x:null}));return s.length>0?s:null}function la(e){$("#"+e.targetDiv).empty(),Dt(e);try{aa(e)}catch(t){throw t}try{templates.update(e)}catch(t){}}$(document).on("fhChange",(function(e,t){try{let e=$("#id_name").val();void 0===rn(St(t),e)?$("form > fieldset").prop("disabled",!0):$("form > fieldset").prop("disabled",!1)}catch(n){}})),$(document).on("rebuild",(function(e,t){la(t)})),$(document).on("build",(function(e,t){aa(t)}));var sa=Object.freeze({__proto__:null,build:aa,check_ptr_link_clashes:ia,rebuild:la});const da=$e({__name:"PedigreeDrawer",setup(e,{expose:t}){const{t:a}=n();function p(){if(!sa||!It||!Un)return void Me.error("pedigreejs libraries are not loaded.");let e=document.getElementById("pedigreejs");const t=document.getElementById("pedigree");!e&&t&&(e=document.createElement("div"),e.id="pedigreejs",t.appendChild(e));let n={targetDiv:"pedigree",btn_target:"pedigree_history",width:650,height:400,symbol_size:35,store_type:"session",diseases:[{type:"affected",colour:"#F68F35"}],labels:[],font_size:".75em",font_family:"Helvetica",font_weight:700,edit:!0,DEBUG:!1};const a=It.current(n);n.dataset=null!=a&&a.length>0?a:[{name:"father",sex:"M",top_level:!0},{name:"mother",sex:"F",top_level:!0},{name:"child",sex:"F",father:"father",mother:"mother",proband:!0,affected:!0}];try{let e=sa.build(n);fn.scale_to_fit(e)}catch(r){let e="";"string"==typeof r?e=r.toUpperCase():r instanceof Error&&(e=r.message),Me.error("PedigreeJS initialization error: "+e,r)}}return v((()=>{p()})),t({getPedigreeDataUrl:function(){return new Promise(((e,t)=>{try{const n=document.querySelector("#pedigree svg");if(!n)return void e("");const a=(new XMLSerializer).serializeToString(n),r=document.createElement("canvas"),o=n.getAttribute("width")||450,i=n.getAttribute("height")||320;r.width=o,r.height=i;const l=r.getContext("2d"),s=new Image;s.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(a))),s.onload=()=>{l.drawImage(s,0,0);const t=r.toDataURL("image/png");e(t)},s.onerror=e=>t(e)}catch(n){t(n)}}))},getPedigreeData:function(){try{const e={targetDiv:"pedigree",btn_target:"pedigree_history"},t=It.current(e);if(Me.debug("[PedigreeDrawer] Raw pedigree dataset fetched from cache:",t),!t||0===t.length)return Me.warn("[PedigreeDrawer] No pedigree data found in cache"),null;const n={};let a=1;t.forEach((e=>{const t=e.name||e.id||`p${a}`;n[t]||(n[t]=a++)}));const r=[];t.forEach((e=>{const t=e.name||e.id||`p${a}`,o=n[t],i="M"===e.sex?1:"F"===e.sex?2:0,l=e.father&&n[e.father]||0,s=e.mother&&n[e.mother]||0,d=e.affected?2:1;r.push([1,o,l,s,i,d])})),r.sort(((e,t)=>e[1]-t[1]));const o=[2,r];return Me.debug("[PedigreeDrawer] Final compact pedigree data prepared:",o),o}catch(e){return Me.error("[PedigreeDrawer] Error getting pedigree data:",e),null}},initPedigree:p}),(e,t)=>(o(),r(he,{class:"mb-4"},{default:i((()=>[s(pe,null,{default:i((()=>[d(c(u(a)("pedigreeDrawer.title")),1)])),_:1}),t[1]||(t[1]=d()),s(fe,null,{default:i((()=>t[0]||(t[0]=[l("div",{id:"pedigree",class:"pedigree-container"},null,-1),d(),l("div",{id:"pedigree_history"},null,-1)]))),_:1})])),_:1}))}},[["__scopeId","data-v-4bef441c"]]),ca=$e({__name:"ValidationSummary",props:{showValidation:{type:Boolean,default:!1}},setup(e){const t=g("isValid"),n=g("validationErrors"),p=a((()=>{if(!n||!n.value)return[];const e=new Set,t=[],a=e=>e.match(/phenotypeData\[(\d+)\]/)?"phenotypeData":e;return Object.entries(n.value).forEach((([n,r])=>{if(n.includes("."))return;const o=`${a(n)}: ${r}`;e.has(o)||(e.add(o),t.push({field:a(n),message:"phenotypeData"===a(n)?"Phenotype data: Some fields need to be completed":r}))})),t}));return(n,a)=>e.showValidation&&!u(t)&&p.value.length>0?(o(),r(me,{key:0,type:"error",density:"compact",variant:"tonal",class:"validation-summary",border:"start",role:"alert","aria-live":"assertive"},{default:i((()=>[a[0]||(a[0]=l("h3",null,"Please correct the following errors:",-1)),a[1]||(a[1]=d()),s(G,{density:"compact",class:"error-list"},{default:i((()=>[(o(!0),y(x,null,S(p.value,((e,t)=>(o(),r(J,{key:t,density:"compact",class:"error-item",onClick:t=>function(e){const t={firstName:"givenName",lastName:"familyName",referrer:"physicianName"}[e]||e,n=document.getElementById(t)||document.getElementById(e)||document.querySelector(`[name="${t}"]`)||document.querySelector(`[name="${e}"]`)||document.querySelector(`[data-field="${t}"]`)||document.querySelector(`[data-field="${e}"]`)||document.querySelector(`label[for="${t}"]`)||document.querySelector(`label[for="${e}"]`);n?(n.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout((()=>{n.focus()}),500)):Me.warn(`ValidationSummary: Could not find field element to scroll to: ${e} (mapped: ${t})`)}(e.field)},{default:i((()=>[s(K,null,{default:i((()=>[d(c(e.message),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):f("",!0)}},[["__scopeId","data-v-8cbfde80"]]),ua={schema:{name:"RequiForm PDF Schema",version:"0.1.0"},header:JSON.parse('{"elements":[{"type":"image","position":{"x":40,"y":30},"size":{"width":225,"height":47},"source":"data:image/png;base64,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"},{"type":"text","position":{"x":400,"y":40},"content":"Labor Berlin - Charité Vivantes GmbH","contents":{"en":"Labor Berlin - Charité Vivantes GmbH","de":"Labor Berlin - Charité Vivantes GmbH"},"style":{"font":"Helvetica","fontStyle":"normal","fontSize":10,"color":"#000000"}},{"type":"text","position":{"x":400,"y":50},"content":"Humangenetik","style":{"font":"Helvetica","fontStyle":"normal","fontSize":10,"color":"#000000"}},{"type":"text","position":{"x":400,"y":60},"content":"Sylter Straße 2 · 13353 Berlin","contents":{"en":"Sylter Strasse 2 · 13353 Berlin","de":"Sylter Straße 2 · 13353 Berlin"},"style":{"font":"Helvetica","fontStyle":"normal","fontSize":10,"color":"#000000"}},{"type":"text","position":{"x":40,"y":120},"content":"ANFORDERUNGSSCHEIN MOLEKULARGENETIK","contents":{"en":"MOLECULAR GENETICS REQUISITION FORM","de":"ANFORDERUNGSSCHEIN MOLEKULARGENETIK"},"style":{"font":"Helvetica","fontStyle":"bold","fontSize":14,"color":"#000000"}}]}'),body:{elements:[{type:"text",position:{x:40,y:140},content:"Patient*In",contents:{en:"Patient",de:"Patient*In"},style:{font:"Helvetica",fontStyle:"bold",fontSize:12,color:"#000000"}},{type:"text",position:{x:380,y:200},content:"- Praxisstempel -",contents:{en:"- Practice Stamp -",de:"- Praxisstempel -"},style:{font:"Helvetica",fontStyle:"italic",fontSize:12,color:"#A9A9A9"}},{type:"text",position:{x:40,y:160},content:"Vorname: {{givenName}}",contents:{en:"First Name: {{givenName}}",de:"Vorname: {{givenName}}"},style:{font:"Helvetica",fontStyle:"normal",fontSize:12,color:"#000000"}},{type:"text",position:{x:40,y:180},content:"Name: {{familyName}}",contents:{en:"Last Name: {{familyName}}",de:"Name: {{familyName}}"},style:{font:"Helvetica",fontStyle:"normal",fontSize:12,color:"#000000"}},{type:"text",position:{x:40,y:200},content:"Geburtsdatum: {{birthdate}}",contents:{en:"Date of Birth: {{birthdate}}",de:"Geburtsdatum: {{birthdate}}"},style:{font:"Helvetica",fontStyle:"normal",fontSize:12,color:"#000000"}},{type:"text",position:{x:40,y:220},content:"Geschlecht: {{sex}}",contents:{en:"Sex: {{sex}}",de:"Geschlecht: {{sex}}"},style:{font:"Helvetica",fontStyle:"normal",fontSize:12,color:"#000000"}},{type:"text",position:{x:40,y:240},content:"Bestelldatum: {{orderingDate}}",contents:{en:"Order Date: {{orderingDate}}",de:"Bestelldatum: {{orderingDate}}"},style:{font:"Helvetica",fontStyle:"normal",fontSize:12,color:"#000000"}},{type:"text",position:{x:40,y:260},content:"Kostenübernahme: {{insurance}}",style:{font:"Helvetica",fontStyle:"normal",fontSize:12,color:"#000000"}},{type:"text",position:{x:300,y:260},content:"Ärzt*In: {{physicianName}}",contents:{en:"Physician: {{physicianName}}",de:"Ärzt*In: {{physicianName}}"},style:{font:"Helvetica",fontStyle:"normal",fontSize:12,color:"#000000"}},{type:"text",position:{x:300,y:290},content:"Unterschrift: ______________________",contents:{en:"Signature: ______________________",de:"Unterschrift: ______________________"},style:{font:"Helvetica",fontStyle:"normal",fontSize:12,color:"#000000"}},{type:"text",position:{x:40,y:270},content:"Familienanamnese: {{familyHistory}}",contents:{en:"Family History: {{familyHistory}}",de:"Familienanamnese: {{familyHistory}}"},style:{font:"Helvetica",fontStyle:"normal",fontSize:12,color:"#000000"}},{type:"text",position:{x:40,y:284},content:"Elterliche Blutsverwandtschaft: {{parentalConsanguinity}}",contents:{en:"Parental Consanguinity: {{parentalConsanguinity}}",de:"Elterliche Blutsverwandtschaft: {{parentalConsanguinity}}"},style:{font:"Helvetica",fontStyle:"normal",fontSize:12,color:"#000000"}},{type:"text",position:{x:40,y:298},content:"Diagnose / Verdacht: {{diagnosis}}",contents:{en:"Diagnosis / Suspicion: {{diagnosis}}",de:"Diagnose / Verdacht: {{diagnosis}}"},style:{font:"Helvetica",fontStyle:"normal",fontSize:12,color:"#000000"}},{type:"text",position:{x:40,y:330},content:"Angeforderte Analyse(n):",contents:{en:"Requested Analysis:",de:"Angeforderte Analyse(n):"},style:{font:"Helvetica",fontStyle:"bold",fontSize:12,color:"#000000"}},{type:"rectangle",position:{x:320,y:130},size:{width:220,height:100},style:{borderColor:"#000000",borderWidth:.7}},{type:"line",start:{x:40,y:310},end:{x:540,y:310},style:{lineWidth:1,color:"#000000"}}]},panels:{baseY:350,maxHeight:700,spacing:14,offsetX:60,secondPageBaseY:50},qr:{position:{x:450,y:700},size:{width:100,height:100}},phenotypePage:{title:"Phenotype Data",titleContents:{en:"Phenotype Data",de:"Phänotyp-Daten"}},footer:{elements:[{type:"text",position:{x:40,y:780},content:"Tel: +49 (0)30 450 625 432",contents:{en:"Phone: +49 (0)30 450 625 432",de:"Tel: +49 (0)30 450 625 432"},style:{font:"Helvetica",fontStyle:"normal",fontSize:10,color:"#000000"}},{type:"text",position:{x:40,y:794},content:"E-Mail: humangenetik@laborberlin.com",contents:{en:"Email: humangenetik@laborberlin.com",de:"E-Mail: humangenetik@laborberlin.com"},style:{font:"Helvetica",fontStyle:"normal",fontSize:10,color:"#000000"}},{type:"text",position:{x:40,y:808},content:"laborberlin.com/humangenetik",contents:{en:"laborberlin.com/humangenetik",de:"laborberlin.com/humangenetik"},style:{font:"Helvetica",fontStyle:"normal",fontSize:10,color:"#000000"}}]},pageNumber:{enabled:!0,position:{x:500,y:820},font:"Helvetica",fontStyle:"normal",fontSize:10,color:"#000000"},consent:{enabled:!0,title:"Einwilligung zur genetischen Analyse nach GenDG",titleContents:{de:"Einwilligung zur genetischen Analyse nach GenDG",en:"Consent for Genetic Analysis according to GenDG"},paragraphs:["Ich erkläre mich hiermit einverstanden, dass von mir bzw. meinem Kind entnommenes Probenmaterial auf genetische Veränderungen auf Basis einer Genpanel- oder Gesamt-Exom-Anreicherung untersucht wird. Ich wurde über Zweck, Art, Umfang und Aussagekraft der angeforderten genetischen Untersuchung aufgeklärt. Ich wurde informiert, dass die Proben oder die erhobenen Daten als Analyseauftrag an Dritte verschickt werden können. Dabei werden personenbezogene Daten pseudonymisiert auf Datenservern gespeichert, teilweise auf 'Cloud'-Servern innerhalb Europas. Weiterhin werden Daten ggf. für die Abrechnung der Diagnostik zur jeweiligen Krankenkasse übermittelt. Ebenso wurden die möglichen Konsequenzen, die sich aus den Ergebnissen der genetischen Untersuchung für mich oder auch andere Familienmitglieder ergeben können, ausführlich besprochen.","Ich bin damit einverstanden, dass die Befunde der Analyse(n) zusätzlich zur/zum anfordernden Ärztin/Arzt auch weitergeleitet werden an: {{consentName}} (Anschrift falls vorhanden).","Bei genetischen Untersuchungen kann es zu Ergebnissen kommen, die nicht im Zusammenhang mit der klinischen Fragestellung stehen, aber nach aktuellem Wissensstand (angelehnt an die Empfehlungen des ACMG https://www.laborberlin.com/Zufallsbefunde) eine Behandlungs- oder Vorsorgekonsequenz für mich oder Angehörige haben können. Zufallsbefunde mitteilen: {{zufallsbefundeLabel}}","Mit der Aufbewahrung von überschüssigem Untersuchungsmaterial für ggf. ergänzende Untersuchungen zur Diagnosefindung und für laboranalytische Kontrollmaßnahmen bin ich einverstanden. ({{materialLabel}})","Ich bin einverstanden, dass die Untersuchungsergebnisse über die gesetzlich vorgeschriebene Frist von 10 Jahren hinaus (maximal 30 Jahre) aufbewahrt werden können. ({{extendedLabel}})","Ich bin einverstanden, dass erhobene Daten/Ergebnisse über die infrage stehende Erkrankung in verschlüsselter (pseudonymisierter) Form für wissenschaftliche und qualitätssichernde Zwecke genutzt und anonymisiert in Fachzeitschriften veröffentlicht werden. ({{researchLabel}})","Ich wurde darauf hingewiesen, dass ich meine Einwilligung jederzeit ohne Angaben von Gründen ganz oder teilweise zurückziehen kann, ohne dass mir daraus Nachteile entstehen, und dass ich das Recht habe, Untersuchungsergebnisse nicht zu erfahren (Recht auf Nichtwissen)."],paragraphsContents:{de:["Ich erkläre mich hiermit einverstanden, dass von mir bzw. meinem Kind entnommenes Probenmaterial auf genetische Veränderungen auf Basis einer Genpanel- oder Gesamt-Exom-Anreicherung untersucht wird. Ich wurde über Zweck, Art, Umfang und Aussagekraft der angeforderten genetischen Untersuchung aufgeklärt. Ich wurde informiert, dass die Proben oder die erhobenen Daten als Analyseauftrag an Dritte verschickt werden können. Dabei werden personenbezogene Daten pseudonymisiert auf Datenservern gespeichert, teilweise auf 'Cloud'-Servern innerhalb Europas. Weiterhin werden Daten ggf. für die Abrechnung der Diagnostik zur jeweiligen Krankenkasse übermittelt. Ebenso wurden die möglichen Konsequenzen, die sich aus den Ergebnissen der genetischen Untersuchung für mich oder auch andere Familienmitglieder ergeben können, ausführlich besprochen.","Ich bin damit einverstanden, dass die Befunde der Analyse(n) zusätzlich zur/zum anfordernden Ärztin/Arzt auch weitergeleitet werden an: {{consentName}} (Anschrift falls vorhanden).","Bei genetischen Untersuchungen kann es zu Ergebnissen kommen, die nicht im Zusammenhang mit der klinischen Fragestellung stehen, aber nach aktuellem Wissensstand (angelehnt an die Empfehlungen des ACMG https://www.laborberlin.com/Zufallsbefunde) eine Behandlungs- oder Vorsorgekonsequenz für mich oder Angehörige haben können. Zufallsbefunde mitteilen: {{zufallsbefundeLabel}}","Mit der Aufbewahrung von überschüssigem Untersuchungsmaterial für ggf. ergänzende Untersuchungen zur Diagnosefindung und für laboranalytische Kontrollmaßnahmen bin ich einverstanden. ({{materialLabel}})","Ich bin einverstanden, dass die Untersuchungsergebnisse über die gesetzlich vorgeschriebene Frist von 10 Jahren hinaus (maximal 30 Jahre) aufbewahrt werden können. ({{extendedLabel}})","Ich bin einverstanden, dass erhobene Daten/Ergebnisse über die infrage stehende Erkrankung in verschlüsselter (pseudonymisierter) Form für wissenschaftliche und qualitätssichernde Zwecke genutzt und anonymisiert in Fachzeitschriften veröffentlicht werden. ({{researchLabel}})","Ich wurde darauf hingewiesen, dass ich meine Einwilligung jederzeit ohne Angaben von Gründen ganz oder teilweise zurückziehen kann, ohne dass mir daraus Nachteile entstehen, und dass ich das Recht habe, Untersuchungsergebnisse nicht zu erfahren (Recht auf Nichtwissen)."],en:["I hereby declare that I agree to the examination of the sample material taken from me or my child for genetic changes on the basis of a gene panel or whole-exome enrichment. I have been informed about the purpose, type, scope and significance of the requested genetic examination. I have been informed that the samples or the data collected can be sent to third parties as an analysis order. In this process, personal data is pseudonymized on data servers, partly on 'cloud' servers within Europe. Furthermore, data may be transmitted to the respective health insurance company for the billing of diagnostics. The possible consequences that may arise from the results of the genetic examination for me or other family members have also been discussed in detail.","I agree that the findings of the analysis(es) will also be forwarded to {{consentName}} (address if available) in addition to the requesting physician.","Genetic testing may reveal findings unrelated to the clinical question, but which may have treatment or preventive consequences for me or relatives according to current knowledge (based on ACMG recommendations https://www.laborberlin.com/Zufallsbefunde). Share incidental findings: {{zufallsbefundeLabel}}","I agree with the storage of excess examination material for possible supplementary examinations for diagnosis and for laboratory analytical control measures. ({{materialLabel}})","I agree that the examination results can be kept beyond the legally prescribed period of 10 years (maximum 30 years). ({{extendedLabel}})","I agree that collected data/results about the disease in question may be used in encrypted (pseudonymized) form for scientific and quality assurance purposes and published anonymously in professional journals. ({{researchLabel}})","I have been informed that I can withdraw my consent in whole or in part at any time without giving reasons, without any disadvantages, and that I have the right not to know examination results (right not to know)."]},signatureArea:{patientLabel:"Patient*in / gesetzl. Vertreter*in (Druckbuchstaben)",physicianLabel:"Ärztin/Arzt (Druckbuchstaben)",signHint:"Datum / Unterschrift"},signatureAreaContents:{de:{patientLabel:"Patient*in / gesetzl. Vertreter*in (Druckbuchstaben)",physicianLabel:"Ärztin/Arzt (Druckbuchstaben)",signHint:"Datum / Unterschrift"},en:{patientLabel:"Patient / Legal Representative (BLOCK LETTERS)",physicianLabel:"Physician (BLOCK LETTERS)",signHint:"Date / Signature"}}}};async function pa(e,t={}){var n,a;let r;r="string"==typeof e?e:Array.isArray(e)||"object"==typeof e?JSON.stringify(e).replace(/\s/g,""):String(e);const o=r.length;Me.debug(`QR code data size: ${o} characters`);const i=function(e,t=100){let n=t;return e>100&&(n=Math.min(t+20,120)),e>200&&(n=Math.min(t+40,140)),e>300&&(n=Math.min(t+60,160)),e>400&&(n=Math.min(t+80,180)),n}(o);let l="M";o>300?l="L":o<100&&(l="H");const s={width:t.width||i,margin:void 0!==t.margin?t.margin:1,color:{dark:(null==(n=t.color)?void 0:n.dark)||"#000000",light:(null==(a=t.color)?void 0:a.light)||"#FFFFFF"},errorCorrectionLevel:t.errorCorrectionLevel||l};try{return await Le.toDataURL(r,s)}catch(d){throw Me.error("Failed to generate QR code:",d),new Error(`QR code generation failed: ${d.message}`)}}async function fa(e,t={}){const n=function(e){if(!e||!Array.isArray(e))return Me.warn("Invalid phenotype data provided for QR encoding"),[];try{return e.map((e=>{if(!e||!e.id)return Me.debug("Skipping phenotype item with no ID"),null;let t;if("string"==typeof e.id&&e.id.startsWith("HP:")){if(t=parseInt(e.id.substring(3),10),isNaN(t))return Me.warn(`Invalid HPO ID format: ${e.id}`),null}else t=e.id;return`${e.present?"+":"-"}${t}`})).filter((e=>null!==e))}catch(t){return Me.error("Error encoding phenotype data:",t),[]}}(e||[]),a=[1,2,n],r=JSON.stringify(a).replace(/\s/g,"");return Me.debug("Phenotype QR data size:",r.length,"characters"),pa(r,t.qrOptions||{})}async function ha(e,t={}){if(!e)return pa("{}",t.qrOptions||{});let n=e;Array.isArray(e)?e.length>=2&&2===e[0]?(Me.debug("[qrService] Using standard PED format"),n=e):(Me.debug("[qrService] Using array format"),n=e):"c"===e.f||"compact"===e.format?(Me.debug("[qrService] Converting legacy object format to array"),n=e):e.h||e.hasImage?(Me.debug("[qrService] Using image reference only"),n=[0]):(Me.debug("[qrService] Unknown format:",typeof e),n=e);try{const e=(Array.isArray(n)?JSON.stringify(n):JSON.stringify([3,n])).replace(/\s/g,""),a=e.length;return Me.debug("[qrService] Final pedigree data size:",a,"chars"),a>4e3?(Me.warn("Pedigree data exceeds limit"),ha([0],{qrOptions:t.qrOptions})):pa(e,t.qrOptions||{})}catch(a){return Me.error("Error generating pedigree QR:",a),pa("{}",t.qrOptions||{})}}const ma={__name:"PdfGenerator",props:{patientData:{type:Object,required:!0},pedigreeDataUrl:{type:String,required:!1,default:""},phenotypeData:{type:Object,required:!1,default:()=>({})}},setup(e,{expose:t}){const r=n(),l=a((()=>r.locale.value)),c=e,u=g("patientData",null);t({generatePdf:D});const p=a((()=>{const e=(null==u?void 0:u.selectedPanels)||[];return Xe.categories.map((t=>({categoryTitle:t.title,id:t.id,tests:t.tests.filter((t=>e.includes(t.id)))}))).filter((e=>e.tests.length>0))})),f=a((()=>{const e=(null==u?void 0:u.selectedPanels)||[];if(null==u?void 0:u.personalInfo){const t=u.personalInfo;return{patient:{firstName:t.firstName||"",lastName:t.lastName||"",birthdate:t.birthdate||"",sex:t.sex||"",insurance:t.insurance||"",insuranceId:t.insuranceId||"",referrer:t.referrer||"",diagnosis:t.diagnosis||""},selectedTests:e}}return{patient:{firstName:c.patientData.givenName||"",lastName:c.patientData.familyName||"",birthdate:c.patientData.birthdate||"",sex:c.patientData.sex||"",insurance:c.patientData.insurance||"",insuranceId:c.patientData.insuranceId||"",referrer:c.patientData.referrer||"",diagnosis:c.patientData.clinicalDiagnosis||""},selectedTests:[]}})),h=a((()=>{if(null==u?void 0:u.phenotypes)return u.phenotypes;if(c.phenotypeData){const e=[];return Object.entries(c.phenotypeData).forEach((([t,n])=>{Object.entries(n).forEach((([n,a])=>{if("no input"===a)return;const r=Xe.categories.find((e=>e.id===t));if(r){const t=r.phenotypes.find((e=>e.id===n));t&&t.hpo&&e.push({id:t.hpo,present:"present"===a||"yes"===a})}}))})),e}return[]})),m=a((()=>{var e,t,n;if(Me.debug("[PdfGenerator] Direct patientData props:",JSON.stringify(c.patientData||{})),null==(t=null==(e=c.patientData)?void 0:e.pedigree)?void 0:t.data){const e=c.patientData.pedigree.data;return Me.debug("[PdfGenerator] Using pedigree data from props:",JSON.stringify(e)),e}if(null==(n=null==u?void 0:u.pedigree)?void 0:n.data){const e=u.pedigree.data;return Me.debug("[PdfGenerator] Using pedigree data from unified model:",JSON.stringify(e)),e}return c.pedigreeDataUrl?(Me.debug("[PdfGenerator] No pedigree data available, using hasImage fallback"),{hasImage:!0}):(Me.debug("[PdfGenerator] No pedigree data or image URL available"),null)}));function b(e,t){return e.replace(/{{\s*([\w]+)\s*}}/g,((e,n)=>n in t?t[n]:""))}function v(e){return"yes"===e?"Ja":"Nein"}function w(e,t,n){t&&t.elements&&t.elements.forEach((t=>{switch(t.type){case"text":!function(e,t,n){let a;a=t.contents&&t.contents[l.value]?b(t.contents[l.value],n):b(t.content,n),t.style&&(e.setFont(t.style.font||"Helvetica",t.style.fontStyle||"normal"),e.setFontSize(t.style.fontSize||12),e.setTextColor(t.style.color||"#000000")),e.text(a,t.position.x,t.position.y)}(e,t,n);break;case"image":!function(e,t,n){const a=b(t.source,n);e.addImage(a,"PNG",t.position.x,t.position.y,t.size.width,t.size.height)}(e,t,n);break;case"rectangle":!function(e,t){const{x:n,y:a}=t.position,{width:r,height:o}=t.size,i=t.style||{};i.fill&&i.fillColor&&e.setFillColor(i.fillColor),i.borderColor&&e.setDrawColor(i.borderColor),e.setLineWidth(i.borderWidth||1);let l="S";i.fill&&i.fillColor&&(l=i.borderWidth?"DF":"F"),e.rect(n,a,r,o,l)}(e,t);break;case"line":!function(e,t){const{x:n,y:a}=t.start,{x:r,y:o}=t.end,i=t.style||{};e.setLineWidth(i.lineWidth||1),i.color&&e.setDrawColor(i.color),e.line(n,a,r,o)}(e,t);break;default:Me.debug("Unknown element type:",t.type)}}))}async function D(){var e,t,n,a,r,o,i,s,d;try{Me.debug("Starting PDF generation process...");const S=new Ne({orientation:"portrait",unit:"pt",format:"A4"}),P={givenName:(null==(e=null==u?void 0:u.personalInfo)?void 0:e.firstName)||c.patientData.givenName||"",familyName:(null==(t=null==u?void 0:u.personalInfo)?void 0:t.lastName)||c.patientData.familyName||"",birthdate:(null==(n=null==u?void 0:u.personalInfo)?void 0:n.birthdate)||c.patientData.birthdate||"",sex:(null==(a=null==u?void 0:u.personalInfo)?void 0:a.sex)||c.patientData.sex||"",insurance:(null==(r=null==u?void 0:u.personalInfo)?void 0:r.insurance)||c.patientData.insurance||"",physicianName:(null==(o=null==u?void 0:u.personalInfo)?void 0:o.referrer)||c.patientData.physicianName||"",...c.patientData,...ua.header,...ua.footer};ua.header&&w(S,ua.header,P),ua.body&&w(S,ua.body,P);const{baseY:k=350,maxHeight:_=600,spacing:C=14,offsetX:A=60,secondPageBaseY:I=50}=ua.panels||{};let F=k;if(p.value.forEach((e=>{F+C>_&&(S.addPage(),F=I),F=function(e,t,n,a,r){e.setFont("Helvetica","bold"),e.setFontSize(12),e.setTextColor("#000000"),e.text(t,n,a);const o=e.getTextWidth(t);return e.line(n,a+2,n+o,a+2),a+r}(S,e.categoryTitle,A,F,C),e.tests.forEach((e=>{let t=C;if(e.genes&&e.genes.length>0){const n=e.genes.join(", "),a=S.internal.pageSize.getWidth()-A-40;t+=S.splitTextToSize(n,a).length*C}F+t>_&&(S.addPage(),F=I),F=function(e,t,n,a,r){if(e.setFont("Helvetica","bold"),e.setFontSize(12),e.setTextColor("#000000"),e.text(t.name,n,a),a+=r,t.genes&&t.genes.length>0){e.setFont("Helvetica","italic"),e.setFontSize(10),e.setTextColor("#000000");const o=t.genes.join(", "),i=e.internal.pageSize.getWidth()-n-40;e.splitTextToSize(o,i).forEach((t=>{e.text(t,n,a),a+=r}))}return e.setFont("Helvetica","normal"),e.setFontSize(12),a}(S,e,A,F,C)}))})),(null==(i=ua.qr)?void 0:i.position)&&(null==(s=ua.qr)?void 0:s.size))try{const e={qrOptions:{width:128,margin:2,color:{dark:"#000000",light:"#ffffff"}}},t=await async function(e,t={}){const n=[1,1,[e.firstName||"",e.lastName||"",e.birthdate||"",e.sex||"",e.insurance||"",e.insuranceId||"",e.referrer||"",e.diagnosis||""],t.selectedTests||[]],a=JSON.stringify(n).replace(/\s/g,"");return Me.debug("Patient QR data size:",a.length,"characters"),pa(a,t.qrOptions||{})}(f.value.patient,{selectedTests:f.value.selectedTests,...e});S.setPage(1),S.setFont("Helvetica","bold"),S.setFontSize(10),S.text("Patient QR Code",ua.qr.position.x+ua.qr.size.width/2-40,ua.qr.position.y-10),S.addImage(t,"PNG",ua.qr.position.x,ua.qr.position.y,ua.qr.size.width,ua.qr.size.height)}catch(g){Me.debug("Failed to generate or add patient QR code:",g)}try{await async function(e){var t,n;let a={},r=!1;const o=(null==u?void 0:u.phenotypeData)||[];var i;if(o.length>0&&(a=(i=o)&&Array.isArray(i)?i.reduce(((e,t)=>(t&&t.status&&"no input"!==t.status&&(e[t.categoryId]||(e[t.categoryId]={}),e[t.categoryId][t.phenotypeId]=t.status),e)),{}):{},r=Object.values(a).some((e=>Object.values(e).some((e=>"no input"!==e)))),o.length>0&&!r&&Me.debug("[PdfGenerator] Unified phenotype data existed but contained only 'no input' entries.")),!r&&c.phenotypeData){Me.debug("[PdfGenerator] Checking legacy props.phenotypeData as unified data was empty or lacked meaningful entries."),a=c.phenotypeData;for(const e in a){for(const t in a[e])if("no input"!==a[e][t]){r=!0;break}if(r)break}}if(!r)return void Me.debug("[PdfGenerator] Skipping phenotype page: No meaningful data found in unified or legacy sources.");Me.debug("[PdfGenerator] Proceeding to render phenotype page."),e.addPage();const s=e.internal.getNumberOfPages();e.setPage(s),e.setFont("Helvetica","bold"),e.setFontSize(16);const d=(null==(n=null==(t=ua.phenotypePage)?void 0:t.titleContents)?void 0:n[l.value])||"Phenotype Data";e.text(d,40,40);let p=70;e.setFont("Helvetica","normal"),e.setFontSize(12);try{const t=[];for(const e in a)for(const n in a[e]){const r=a[e][n];if("no input"!==r){const a=Xe.categories.find((t=>t.id===e));if(a){const o=a.phenotypes.find((e=>e.id===n));if(o&&o.hpo){const e=o.hpo.replace("HP:","");t.push(`${"present"===r?"+":"-"}${e}`)}else Me.warn(`Could not find HPO ID for ${e}/${n} for QR code.`)}}}if(t.length>0){Me.debug("Generating phenotype QR code with",t.length,"meaningful items");const n=h.value&&h.value.length>0?h.value:t;Me.debug(`Using ${n===h.value?"computed":"collected"} phenotype data for QR code with ${n.length} items`);const a=await fa(n,{qrOptions:{width:ua.qr.size.width,margin:1,errorCorrectionLevel:"M"}});e.setFont("Helvetica","bold"),e.setFontSize(10),e.text("Phenotype QR Code",ua.qr.position.x+ua.qr.size.width/2-40,ua.qr.position.y-10),e.addImage(a,"PNG",ua.qr.position.x,ua.qr.position.y,ua.qr.size.width,ua.qr.size.height)}else Me.debug("No meaningful phenotype data available for QR code generation after filtering.")}catch(g){Me.debug("Failed to generate or add phenotype QR code:",g)}e.setFontSize(12),e.setFont("Helvetica","normal"),p=70;for(const l in a){const t=Xe.categories.find((e=>e.id===l));if(!t||!t.phenotypes)continue;const n=t.phenotypes.filter((e=>{var t;return(null==(t=a[l])?void 0:t[e.id])&&"no input"!==a[l][e.id]}));n.length>0&&(e.setFont("Helvetica","bold"),e.text(t.title,40,p),p+=16,e.setFont("Helvetica","normal"),n.forEach((t=>{const n=a[l][t.id],r=`${t.name} (${t.hpo}): ${n}`;e.text(r,40,p),p+=14,p>e.internal.pageSize.getHeight()-40&&(e.addPage(),p=40)})),p+=10)}}(S)}catch(y){Me.debug("Error rendering phenotype page:",y)}if(c.pedigreeDataUrl&&""!==c.pedigreeDataUrl){let e=null;if(m.value)try{Me.debug("[PdfGenerator] Actual pedigree data being sent to QR generator:",JSON.stringify(m.value));const t=JSON.stringify(m.value).length,n=t>1e3?120:t>500?100:80;m.value?e=await ha(m.value,{qrOptions:{width:n,margin:1,errorCorrectionLevel:"M"}}):(Me.debug("[PdfGenerator] Invalid pedigree data format:",m.value),e=await ha([0],{format:"image",qrOptions:{width:80,margin:1,errorCorrectionLevel:"M"}})),Me.debug("Generated pedigree QR code with PED format data")}catch(g){Me.debug("Error generating pedigree QR code:",g);try{e=await ha({hasImage:!0},{format:"image",qrOptions:{width:80,margin:1,errorCorrectionLevel:"M"}}),Me.debug("Generated fallback pedigree QR code (image reference only)")}catch(D){Me.debug("Error generating fallback pedigree QR code:",D)}}await new Promise((t=>{const n=new Image;n.src=c.pedigreeDataUrl,n.onload=()=>{try{S.addPage();const t=S.internal.getNumberOfPages();S.setPage(t),S.setFont("Helvetica","bold"),S.setFontSize(16),S.text("Family Pedigree",40,40);const a=S.internal.pageSize.getWidth(),r=S.internal.pageSize.getHeight(),o=40,i=a-2*o,l=r-2*o-40,s=Math.min(i/n.width,l/n.height,1),d=n.width*s,u=n.height*s,p=(a-d)/2,f=80;S.addImage(c.pedigreeDataUrl,"PNG",p,f,d,u),e&&(S.setFont("Helvetica","bold"),S.setFontSize(10),S.text("Pedigree QR Code",ua.qr.position.x+ua.qr.size.width/2-40,ua.qr.position.y-10),S.addImage(e,"PNG",ua.qr.position.x,ua.qr.position.y,ua.qr.size.width,ua.qr.size.height))}catch(a){Me.debug("Error rendering pedigree:",a)}t()},n.onerror=()=>{Me.debug("Error loading pedigree image."),t()}}))}const E=(null==(d=null==u?void 0:u.consent)?void 0:d.dataProcessing)||c.patientData.genDGConsentData&&"fill"===c.patientData.genDGConsentData.provided;if(Me.debug("generatePdf in PdfGenerator: Checking consent data availability:",E),E){Me.debug("Attempting to render consent page...");try{!function(e){Me.debug("Rendering consent page...");try{if(!c.patientData.genDGConsentData||!c.patientData.genDGConsentData.form)return void Me.debug("Consent form data is missing in PdfGenerator");const t=c.patientData.genDGConsentData.form,n=ua.consent;Me.debug("Consent Form Data:",JSON.stringify(t)),Me.debug("Consent Config:",JSON.stringify(n));const a={consentName:t.consentName||"",zufallsbefundeLabel:v(t.questionSecondaryFindings),materialLabel:v(t.questionMaterial),extendedLabel:v(t.questionExtended),researchLabel:v(t.questionResearch)};e.addPage(),e.setFont("Helvetica","normal"),e.setFontSize(10);let r=n.startY||40;const o=40,i=40,s=e.internal.pageSize.getWidth()-o-i,d=n.lineSpacing||5,u=n.paragraphSpacing||10;if(n.title){e.setFont("Helvetica","bold"),e.setFontSize(n.title.fontSize||14);let t=n.title;n.titleContents&&n.titleContents[l.value]&&(t=n.titleContents[l.value],Me.debug(`Using localized title for ${l.value}`)),e.splitTextToSize(t,s).forEach((t=>{e.text(t,o,r),r+=.5*(n.title.fontSize||14)})),r+=d,e.setFont("Helvetica","normal"),e.setFontSize(10)}Me.debug("Rendering paragraphs...");let p=n.paragraphs;n.paragraphsContents&&n.paragraphsContents[l.value]&&(p=n.paragraphsContents[l.value],Me.debug(`Using localized paragraphs for ${l.value}`)),p.forEach((t=>{const i=b(t,a);e.splitTextToSize(i,s).forEach((t=>{r+d>e.internal.pageSize.getHeight()-60&&(e.addPage(),r=n.startY||40),e.text(t,o,r),r+=1.2*e.getFontSize()})),r+=u}));let f=r+(n.signatureArea.marginTop||20);const h=n.signatureArea.lineStartX||o,m=n.signatureArea.patientLineEndX||h+200,g=n.signatureArea.physicianLineStartX||o+250,y=n.signatureArea.physicianLineEndX||g+200;let w=n.signatureArea;n.signatureAreaContents&&n.signatureAreaContents[l.value]&&(w=n.signatureAreaContents[l.value],Me.debug(`Using localized signature area for ${l.value}`));const D=`${"en"===l.value?"Date":"Datum"}: ${t.consentDate||"___________"}`;e.text(D,h,f),f+=1.4*e.getFontSize();const x=f;e.line(h,x,m,x),w.patientLabel&&e.text(w.patientLabel,h,x+1.2*e.getFontSize());const S=f;e.line(g,S,y,S),w.physicianLabel&&e.text(w.physicianLabel,g,S+1.2*e.getFontSize());const P=Math.max(x,S)+2.4*e.getFontSize();w.signHint&&e.text(w.signHint,h,P),Me.debug("Finished rendering consent page content.")}catch(t){Me.debug("Error during renderConsentPage:",t)}}(S)}catch(x){Me.debug("Caught error during renderConsentPage call:",x)}}const N=S.internal.getNumberOfPages();if(ua.pageNumber&&ua.pageNumber.enabled)for(let e=1;e<=N;e++){S.setPage(e);const{x:t,y:n}=ua.pageNumber.position,a=`Page ${e} of ${N}`;S.setFont(ua.pageNumber.font||"Helvetica",ua.pageNumber.fontStyle||"normal"),S.setFontSize(ua.pageNumber.fontSize||10),S.setTextColor(ua.pageNumber.color||"#000000"),S.text(a,t,n)}const L=`PDF Schema: v${ua.schema.version} | Test Schema: v${Xe.schema.version}`;for(let e=1;e<=N;e++)S.setPage(e),S.setFont("Helvetica","normal"),S.setFontSize(8),S.setTextColor("#000000"),S.text(L,40,S.internal.pageSize.getHeight()-10);S.save("genetic_test_requisition.pdf"),Me.debug("PDF generation process completed.")}catch(S){Me.debug("Error during PDF generation process:",S),alert("An error occurred while generating the PDF. Please check the console for details.")}}return(e,t)=>(o(),y("div",null,[s(B,{onClick:D,color:"primary",dark:""},{default:i((()=>t[0]||(t[0]=[d("\n      Generate PDF\n    ")]))),_:1})]))}};const ga=$e(P({name:"AppDisclaimer",setup(){const{t:e}=n();return{t:e}},data:()=>({dialog:!0}),methods:{acknowledge(){this.dialog=!1,this.$emit("dismiss")}}}),[["render",function(e,t,n,a,u,p){return o(),r(ye,{modelValue:e.dialog,"onUpdate:modelValue":t[0]||(t[0]=t=>e.dialog=t),persistent:"","max-width":"600"},{default:i((()=>[s(he,null,{default:i((()=>[s(pe,{class:"headline"},{default:i((()=>[d(c(e.$t("disclaimer.title")),1)])),_:1}),t[2]||(t[2]=d()),s(fe,null,{default:i((()=>[l("p",null,c(e.$t("disclaimer.body")),1)])),_:1}),t[3]||(t[3]=d()),s(ge,null,{default:i((()=>[s(H),t[1]||(t[1]=d()),s(B,{color:"primary",text:"",onClick:e.acknowledge},{default:i((()=>[d(c(e.$t("disclaimer.acknowledgeButton")),1)])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}],["__scopeId","data-v-f9347362"]]);
/*!
 * pinia v3.0.1
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let ya;const ba=e=>ya=e,va=Symbol();function wa(e){return e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)&&"function"!=typeof e.toJSON}var Da,xa;(xa=Da||(Da={})).direct="direct",xa.patchObject="patch object",xa.patchFunction="patch function";const Sa=()=>{};function Pa(e,t,n,a=Sa){e.push(t);const r=()=>{const n=e.indexOf(t);n>-1&&(e.splice(n,1),a())};return!n&&I()&&F(r),r}function ka(e,...t){e.slice().forEach((e=>{e(...t)}))}const _a=e=>e(),Ca=Symbol(),Aa=Symbol();function Ia(e,t){e instanceof Map&&t instanceof Map?t.forEach(((t,n)=>e.set(n,t))):e instanceof Set&&t instanceof Set&&t.forEach(e.add,e);for(const n in t){if(!t.hasOwnProperty(n))continue;const a=t[n],r=e[n];wa(r)&&wa(a)&&e.hasOwnProperty(n)&&!b(a)&&!C(a)?e[n]=Ia(r,a):e[n]=a}return e}const Fa=Symbol();const{assign:Ea}=Object;function Na(t,n,a={},r,o,i){let l;const s=Ea({actions:{}},a),d={deep:!0};let c,u,p,f=[],g=[];const y=r.state.value[t];let v;function D(e){let n;c=u=!1,"function"==typeof e?(e(r.state.value[t]),n={type:Da.patchFunction,storeId:t,events:p}):(Ia(r.state.value[t],e),n={type:Da.patchObject,payload:e,storeId:t,events:p});const a=v=Symbol();w().then((()=>{v===a&&(c=!0)})),u=!0,ka(f,n,r.state.value[t])}i||y||(r.state.value[t]={}),h({});const x=i?function(){const{state:e}=a,t=e?e():{};this.$patch((e=>{Ea(e,t)}))}:Sa;const S=(e,n="")=>{if(Ca in e)return e[Aa]=n,e;const a=function(){ba(r);const n=Array.from(arguments),o=[],i=[];let l;ka(g,{args:n,name:a[Aa],store:_,after:function(e){o.push(e)},onError:function(e){i.push(e)}});try{l=e.apply(this&&this.$id===t?this:_,n)}catch(s){throw ka(i,s),s}return l instanceof Promise?l.then((e=>(ka(o,e),e))).catch((e=>(ka(i,e),Promise.reject(e)))):(ka(o,l),l)};return a[Ca]=!0,a[Aa]=n,a},P={_p:r,$id:t,$onAction:Pa.bind(null,g),$patch:D,$reset:x,$subscribe(e,n={}){const a=Pa(f,e,n.detached,(()=>o())),o=l.run((()=>m((()=>r.state.value[t]),(a=>{("sync"===n.flush?u:c)&&e({storeId:t,type:Da.direct,events:p},a)}),Ea({},d,n))));return a},$dispose:function(){l.stop(),f=[],g=[],r._s.delete(t)}},_=e(P);r._s.set(t,_);const I=(r._a&&r._a.runWithContext||_a)((()=>r._e.run((()=>(l=k()).run((()=>n({action:S})))))));for(const e in I){const n=I[e];if(b(n)&&(!b(E=n)||!E.effect)||C(n))i||(!y||wa(F=n)&&F.hasOwnProperty(Fa)||(b(n)?n.value=y[e]:Ia(n,y[e])),r.state.value[t][e]=n);else if("function"==typeof n){const t=S(n,e);I[e]=t,s.actions[e]=n}}var F,E;return Ea(_,I),Ea(A(_),I),Object.defineProperty(_,"$state",{get:()=>r.state.value[t],set:e=>{D((t=>{Ea(t,e)}))}}),r._p.forEach((e=>{Ea(_,l.run((()=>e({store:_,app:r._a,pinia:r,options:s}))))})),y&&i&&a.hydrate&&a.hydrate(_.$state,y),c=!0,u=!0,_}
/*! #__NO_SIDE_EFFECTS__ */function La(e,t,n){let r;const o="function"==typeof t;function i(n,i){const l=N();(n=n||(l?g(va,null):null))&&ba(n),(n=ya)._s.has(e)||(o?Na(e,t,r,n):function(e,t,n){const{state:r,actions:o,getters:i}=t,l=n.state.value[e];let s;s=Na(e,(function(){l||(n.state.value[e]=r?r():{});const t=E(n.state.value[e]);return Ea(t,o,Object.keys(i||{}).reduce(((t,r)=>(t[r]=_(a((()=>{ba(n);const t=n._s.get(e);return i[r].call(t,t)}))),t)),{}))}),t,n,0,!0)}(e,r,n));return n._s.get(e)}return r=o?n:t,i.$id=e,i}const Oa=La("ui",(()=>{const e=h(!1),t=h(!1),n=h(""),a=h(!1),r=h(!1),o=h(!1),i=h(!1),l=h(!1),s=h(!1),d=h(!1),c=h(!1),u="requiform_logViewerVisible",p=h("true"===localStorage.getItem(u)),f=h(""),m=h(""),g=h("");return{isDark:e,snackbar:t,snackbarMessage:n,encryptionDialog:a,decryptionDialog:r,showFAQModal:o,resetConfirmationDialog:i,saveDataDialog:l,loadDataDialog:s,pasteDataDialog:d,showDisclaimerModal:c,showLogViewer:p,decryptionError:f,loadDataError:m,pendingEncryptedValue:g,toggleTheme:function(){e.value=!e.value},showSnackbar:function(e){n.value=e,t.value=!0},openEncryptionDialog:function(){a.value=!0},closeEncryptionDialog:function(){a.value=!1},openDecryptionDialog:function(e=""){g.value=e,f.value="",r.value=!0},cancelDecryption:function(){r.value=!1,f.value="",g.value=""},setDecryptionError:function(e){f.value=e},toggleFAQModal:function(e=!0){o.value=e},openResetConfirmationDialog:function(){i.value=!0},closeResetConfirmationDialog:function(){i.value=!1},openSaveDataDialog:function(){l.value=!0},closeSaveDataDialog:function(){l.value=!1},openLoadDataDialog:function(){m.value="",s.value=!0},closeLoadDataDialog:function(){s.value=!1,m.value=""},setLoadDataError:function(e){m.value=e},openPasteDataDialog:function(){d.value=!0},closePasteDataDialog:function(){d.value=!1},openDisclaimerModal:function(){c.value=!0},closeDisclaimerModal:function(){c.value=!1},toggleLogViewer:function(){p.value=!p.value,localStorage.setItem(u,p.value.toString())},openLogViewer:function(){p.value=!0,localStorage.setItem(u,"true")},closeLogViewer:function(){p.value=!1,localStorage.setItem(u,"false")}}})),Va={version:"0.1.0"},Ta={class:"content-wrapper"},Ra={class:"versions flex-grow-1"},za=$e({__name:"AppFooter",props:{disclaimerAcknowledged:{type:Boolean,default:!1},acknowledgmentTime:{type:String,default:""}},emits:["reopen-disclaimer"],setup(e,{emit:t}){D((e=>({"06647272":u(He).styles.footerBackgroundColor})));const{t:h}=n(),m=e,g=t,y=Oa(),b=a((()=>Va.version)),v=a((()=>ua.schema&&ua.schema.version||"N/A")),w=a((()=>Xe.schema&&Xe.schema.version||"N/A"));return(e,t)=>(o(),r(be,{app:"",padless:"",class:"footer"},{default:i((()=>[l("div",Ta,[l("span",Ra,c(u(h)("footer.versions.app"))+" v"+c(b.value)+" | "+c(u(h)("footer.versions.testSchema"))+" v"+c(w.value)+" | "+c(u(h)("footer.versions.pdfSchema"))+" v"+c(v.value),1),t[6]||(t[6]=d()),m.disclaimerAcknowledged?(o(),r(M,{key:0,location:"top"},{activator:i((({props:e})=>[s(B,p({icon:"mdi-shield-check",color:"green",variant:"text",size:"small",class:"ml-2"},e,{onClick:t[0]||(t[0]=e=>g("reopen-disclaimer")),"aria-label":u(h)("footer.ariaLabels.reopenDisclaimer")}),null,16,["aria-label"])])),default:i((()=>[t[1]||(t[1]=d()),l("span",null,c(u(h)("footer.tooltips.disclaimerAcknowledged"))+" "+c(m.acknowledgmentTime),1)])),_:1})):f("",!0),t[7]||(t[7]=d()),s(M,{location:"top"},{activator:i((({props:e})=>[s(B,p({icon:"mdi-math-log",variant:"text",size:"small",class:"ml-2"},e,{onClick:u(y).toggleLogViewer,"aria-label":u(h)("footer.ariaLabels.toggleLogViewer")}),null,16,["onClick","aria-label"])])),default:i((()=>[t[2]||(t[2]=d()),l("span",null,c(u(h)("footer.tooltips.toggleLogViewer")),1)])),_:1}),t[8]||(t[8]=d()),s(M,{location:"top"},{activator:i((({props:e})=>[s(B,p({icon:"mdi-github",variant:"text",size:"small",class:"ml-2",href:"https://github.com/BerntPopp/RequiForm",target:"_blank",rel:"noopener noreferrer","aria-label":u(h)("footer.ariaLabels.githubRepo")},e),null,16,["aria-label"])])),default:i((()=>[t[3]||(t[3]=d()),l("span",null,c(u(h)("footer.tooltips.githubRepo")),1)])),_:1}),t[9]||(t[9]=d()),s(M,{location:"top"},{activator:i((({props:e})=>[s(B,p({icon:"mdi-license",variant:"text",size:"small",class:"ml-2",href:"https://github.com/BerntPopp/RequiForm/blob/main/LICENSE",target:"_blank",rel:"noopener noreferrer","aria-label":u(h)("footer.ariaLabels.licenseInfo")},e),null,16,["aria-label"])])),default:i((()=>[t[4]||(t[4]=d()),l("span",null,c(u(h)("footer.tooltips.license")),1)])),_:1}),t[10]||(t[10]=d()),s(M,{location:"top"},{activator:i((({props:e})=>[s(B,p({icon:"mdi-book-open-variant",variant:"text",size:"small",class:"ml-2",href:"https://github.com/BerntPopp/RequiForm/wiki",target:"_blank",rel:"noopener noreferrer","aria-label":u(h)("footer.ariaLabels.wikiDocs")},e),null,16,["aria-label"])])),default:i((()=>[t[5]||(t[5]=d()),l("span",null,c(u(h)("footer.tooltips.wiki")),1)])),_:1})])])),_:1}))}},[["__scopeId","data-v-f2cbf992"]]);function Ma(e){if(!e||"string"!=typeof e||""===e.trim())return{success:!1,error:"No data provided. Please paste your data into the text area."};try{const n={personalInfo:{},selectedPanels:[],phenotypeData:[],category:"",consent:{}},a=e.split("\n"),r={"first name":{section:"personalInfo",field:"firstName"},firstname:{section:"personalInfo",field:"firstName"},"given name":{section:"personalInfo",field:"firstName"},givenname:{section:"personalInfo",field:"firstName"},"last name":{section:"personalInfo",field:"lastName"},lastname:{section:"personalInfo",field:"lastName"},"family name":{section:"personalInfo",field:"lastName"},familyname:{section:"personalInfo",field:"lastName"},"birth date":{section:"personalInfo",field:"birthdate"},birthdate:{section:"personalInfo",field:"birthdate"},"date of birth":{section:"personalInfo",field:"birthdate"},dob:{section:"personalInfo",field:"birthdate"},sex:{section:"personalInfo",field:"sex"},gender:{section:"personalInfo",field:"sex"},insurance:{section:"personalInfo",field:"insurance"},"insurance provider":{section:"personalInfo",field:"insurance"},"insurance id":{section:"personalInfo",field:"insuranceId"},insuranceid:{section:"personalInfo",field:"insuranceId"},physician:{section:"personalInfo",field:"referrer"},"physician name":{section:"personalInfo",field:"referrer"},doctor:{section:"personalInfo",field:"referrer"},referrer:{section:"personalInfo",field:"referrer"},"referring physician":{section:"personalInfo",field:"referrer"},diagnosis:{section:"personalInfo",field:"diagnosis"},"clinical diagnosis":{section:"personalInfo",field:"diagnosis"},panels:{section:"special",field:"panels"},"selected panels":{section:"special",field:"panels"},tests:{section:"special",field:"panels"},"selected tests":{section:"special",field:"panels"},category:{section:"root",field:"category"},phenotypes:{section:"special",field:"phenotypes"}};for(const e of a){if(!e.trim())continue;const a=e.match(/:(.*)|=(.*)/);if(!a)continue;const o=e.indexOf(a[0]),i=e.substring(0,o).trim().toLowerCase(),l=(a[1]||a[2]||"").trim();if(!l)continue;const s=r[i];if(s)if("root"===s.section)n[s.field]=l;else if("personalInfo"===s.section)n.personalInfo[s.field]=l;else if("special"===s.section)if("panels"===s.field)n.selectedPanels=l.split(",").map((e=>e.trim())).filter(Boolean);else if("phenotypes"===s.field)try{l.startsWith("[")&&l.endsWith("]")&&(n.phenotypeData=JSON.parse(l))}catch(t){}}return 0===Object.keys(n.personalInfo).length?{success:!1,error:"No valid patient data found. Please check the format and try again."}:{success:!0,data:n}}catch(n){return{success:!1,error:"An error occurred while parsing the data. Please check the format and try again."}}}const Ua={class:"mb-4"},qa={class:"mb-1"},Ha={class:"text-body-2"},Ba=$e({__name:"PasteDataModal",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue","close","import"],setup(e,{emit:t}){const{t:p}=n(),g=e,y=t,b=h(""),v=h(null),w=h(""),D=h(!1),x=a((()=>"First Name: Jane\nLast Name: Doe\nBirthdate: 1990-05-15\nSex: female\nInsurance: ABC Health\nPhysician: Dr. Smith\nDiagnosis: Suspected Renal Disease\nPanels: nephronophthise, alport_thin_basement, cystic_kidney_disease")),S=a({get:()=>g.modelValue,set:e=>y("update:modelValue",e)});function P(){b.value.trim()?(Me.debug("PasteDataModal: Parsing data:",b.value.substring(0,100)+"..."),v.value=Ma(b.value),Me.debug("PasteDataModal: Parse result:",v.value),w.value=v.value.success?"":v.value.error||p("pasteDataModal.alerts.parseError")):w.value=p("pasteDataModal.validation.pasteRequired")}function k(){if(v.value&&v.value.success){const e=JSON.stringify(v.value.data);Me.info("PasteDataModal: Sending data for import:",v.value.data),y("import",e),S.value=!1}}function _(){b.value=x.value,v.value=null,w.value=""}return m((()=>g.modelValue),(e=>{!0===e&&(b.value="",v.value=null,w.value="",D.value=!1)})),(e,t)=>(o(),r(ye,{modelValue:S.value,"onUpdate:modelValue":t[3]||(t[3]=e=>S.value=e),"max-width":"700",persistent:""},{default:i((()=>[s(he,null,{default:i((()=>[s(pe,{class:"headline"},{default:i((()=>[d(c(u(p)("pasteDataModal.title")),1)])),_:1}),t[14]||(t[14]=d()),s(fe,null,{default:i((()=>[l("p",Ua,c(u(p)("pasteDataModal.instructions")),1),t[6]||(t[6]=d()),s(ve,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=e=>b.value=e),outlined:"",rows:"10",label:u(p)("pasteDataModal.labels.pasteArea"),placeholder:u(p)("pasteDataModal.placeholders.pasteArea"),"error-messages":w.value,"auto-grow":"",class:"mb-3"},null,8,["modelValue","label","placeholder","error-messages"]),t[7]||(t[7]=d()),D.value?(o(),r(me,{key:0,type:"info",text:"",class:"mb-3"},{default:i((()=>[l("p",qa,[l("strong",null,c(u(p)("pasteDataModal.example.title")),1)]),t[4]||(t[4]=d()),l("pre",Ha,c(x.value),1),t[5]||(t[5]=d()),s(B,{"x-small":"",text:"",color:"primary",onClick:_,class:"mt-2"},{default:i((()=>[d(c(u(p)("pasteDataModal.example.useButton")),1)])),_:1})])),_:1})):f("",!0),t[8]||(t[8]=d()),v.value&&!v.value.success?(o(),r(me,{key:1,type:"error",text:"",class:"mb-3"},{default:i((()=>[d(c(v.value.error),1)])),_:1})):f("",!0),t[9]||(t[9]=d()),v.value&&v.value.success?(o(),r(me,{key:2,type:"success",text:"",class:"mb-3"},{default:i((()=>[d(c(u(p)("pasteDataModal.alerts.parseSuccess")),1)])),_:1})):f("",!0)])),_:1}),t[15]||(t[15]=d()),s(te),t[16]||(t[16]=d()),s(ge,null,{default:i((()=>[s(B,{color:"primary",text:"",onClick:t[1]||(t[1]=e=>D.value=!D.value)},{default:i((()=>[d(c(D.value?u(p)("pasteDataModal.example.hideButton"):u(p)("pasteDataModal.example.showButton")),1)])),_:1}),t[10]||(t[10]=d()),s(H),t[11]||(t[11]=d()),s(B,{text:"",onClick:t[2]||(t[2]=t=>e.$emit("close"))},{default:i((()=>[d(c(u(p)("pasteDataModal.buttons.cancel")),1)])),_:1}),t[12]||(t[12]=d()),s(B,{color:"primary",text:"",onClick:P,disabled:!b.value.trim()},{default:i((()=>[d(c(u(p)("pasteDataModal.buttons.parse")),1)])),_:1},8,["disabled"]),t[13]||(t[13]=d()),s(B,{color:"success",text:"",onClick:k,disabled:!v.value||!v.value.success},{default:i((()=>[d(c(u(p)("pasteDataModal.buttons.import")),1)])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue"]))}},[["__scopeId","data-v-02ff2b53"]]),$a={key:0,class:"selected-panels-summary mt-4"},ja={class:"category-header"},Ga={class:"panel-name"},Ja={key:0,class:"panel-genes"},Ka=$e({__name:"SelectedPanelsSummary",props:{groupedPanelDetails:{type:Array,required:!0}},setup(e){const{t:t}=n(),r=n(),i=a((()=>r.locale.value));return(n,a)=>e.groupedPanelDetails.length?(o(),y("div",$a,[l("h2",null,c(u(t)("selectedPanelsSummary.title")),1),a[2]||(a[2]=d()),(o(!0),y(x,null,S(e.groupedPanelDetails,(e=>{return o(),y("div",{key:e.id||e.categoryTitle},[l("h3",ja,c((t=e,t.titles&&t.titles[i.value]?t.titles[i.value]:t.categoryTitle)),1),a[1]||(a[1]=d()),l("ul",null,[(o(!0),y(x,null,S(e.tests,(e=>{return o(),y("li",{key:e.id,class:"panel-item"},[l("div",Ga,[l("strong",null,c((t=e,t.names&&t.names[i.value]?t.names[i.value]:t.name)),1)]),a[0]||(a[0]=d()),e.genes&&e.genes.length?(o(),y("div",Ja,[l("em",null,c(e.genes.join(", ")),1)])):f("",!0)]);var t})),128))])]);var t})),128))])):f("",!0)}},[["__scopeId","data-v-299f8aeb"]]),Wa={class:"log-header-controls"},Qa={class:"d-flex align-center"},Za={class:"timestamp mr-2"},Ya={class:"level mr-2"},Xa={class:"message flex-grow-1"},er={key:0,class:"log-details mt-1"},tr=$e({__name:"LogViewer",setup(e){const{t:t}=n(),p=Oa(),g=a((()=>Me.entries)),b=()=>{p.toggleLogViewer()},D=()=>{if(g.value&&0!==g.value.length)try{const e=JSON.stringify(g.value,null,2),t=new Blob([e],{type:"application/json"}),n=`requiform-logs-${(new Date).toISOString().replace(/[:.]/g,"-")}.json`,a=document.createElement("a");a.href=URL.createObjectURL(t),a.download=n,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(a.href),Me.info("LogViewer: Logs downloaded successfully.")}catch(e){Me.error("LogViewer: Failed to download logs:",e)}else Me.warn("LogViewer: No logs to download.")},P=()=>{Me.clear()},k=a((()=>[{title:t("logViewer.levels.debug"),value:Ve.DEBUG},{title:t("logViewer.levels.info"),value:Ve.INFO},{title:t("logViewer.levels.warn"),value:Ve.WARN},{title:t("logViewer.levels.error"),value:Ve.ERROR}])),_=a({get:()=>Me.currentLogLevel,set:e=>{Me.setLevel(e)}}),C=a((()=>{switch(_.value){case Ve.DEBUG:return"text-log-debug";case Ve.INFO:return"text-log-info";case Ve.WARN:return"text-log-warn";case Ve.ERROR:return"text-log-error";default:return""}})),A=h(new Set),I=e=>A.value.has(e),F=e=>{try{return JSON.stringify(e,null,2)}catch(t){return`Error formatting data: ${t.message}`}};return m(g,(async()=>{await w();const e=document.querySelector(".log-list");e&&(e.scrollTop=e.scrollHeight)}),{deep:!0}),v((async()=>{await w();const e=document.querySelector(".log-list");e&&(e.scrollTop=e.scrollHeight)})),(e,n)=>(o(),r(he,{class:"log-viewer-card",elevation:"8","max-width":"500","max-height":"400"},{default:i((()=>[s(pe,{class:"d-flex justify-space-between align-center py-2"},{default:i((()=>[l("span",null,c(u(t)("logViewer.title")),1),n[4]||(n[4]=d()),l("div",Wa,[s(X,{modelValue:_.value,"onUpdate:modelValue":n[0]||(n[0]=e=>_.value=e),items:k.value,density:"compact","hide-details":"",variant:"plain",class:L(["log-level-select",C.value])},null,8,["modelValue","items","class"]),n[1]||(n[1]=d()),s(B,{icon:"mdi-download",variant:"text",size:"small",onClick:D,title:u(t)("logViewer.buttons.download"),disabled:!g.value.length},null,8,["title","disabled"]),n[2]||(n[2]=d()),s(B,{icon:"mdi-delete-sweep",variant:"text",size:"small",onClick:P,title:u(t)("logViewer.buttons.clear"),disabled:!g.value.length},null,8,["title","disabled"]),n[3]||(n[3]=d()),s(B,{icon:"mdi-close",variant:"text",size:"small",onClick:b,title:u(t)("logViewer.buttons.close")},null,8,["title"])])])),_:1}),n[10]||(n[10]=d()),s(te),n[11]||(n[11]=d()),s(fe,{class:"log-list pa-0"},{default:i((()=>[s(G,{density:"compact",class:"py-0"},{default:i((()=>[(o(!0),y(x,null,S(g.value,((e,a)=>(o(),r(J,{key:a,class:L([["log-entry",`log-${e.level.toLowerCase()}`],"py-1 px-3"])},{default:i((()=>{return[l("div",Qa,[l("span",Za,c((p=e.timestamp,new Date(p).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}))),1),n[5]||(n[5]=d()),l("span",Ya,"["+c(e.level)+"]",1),n[6]||(n[6]=d()),l("span",Xa,c(e.displayMessage),1),n[7]||(n[7]=d()),null!==e.rawData?(o(),r(B,{key:0,icon:I(a)?"mdi-chevron-up":"mdi-chevron-down",variant:"text",size:"x-small",onClick:e=>(e=>{A.value.has(e)?A.value.delete(e):A.value.add(e)})(a),class:"ml-1",title:u(t)("logViewer.buttons.toggleDetails")},null,8,["icon","onClick","title"])):f("",!0)]),n[8]||(n[8]=d()),s(ue,null,{default:i((()=>[I(a)?(o(),y("div",er,[l("pre",null,c(F(e.rawData)),1)])):f("",!0)])),_:2},1024)];var p})),_:2},1032,["class"])))),128)),n[9]||(n[9]=d()),g.value.length?f("",!0):(o(),r(J,{key:0,class:"text-center text-disabled py-2"},{default:i((()=>[d(c(u(t)("logViewer.emptyState")),1)])),_:1}))])),_:1})])),_:1})])),_:1}))}},[["__scopeId","data-v-ccc42ee4"]]),nr={__name:"EncryptionDialog",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue","cancel","confirm"],setup(e,{emit:t}){const{t:a}=n(),l=e,p=t,f=h(""),g=h(null);function y(){p("cancel"),p("update:modelValue",!1)}function b(){""!==f.value.trim()&&(p("confirm",f.value),p("update:modelValue",!1))}return m((()=>l.modelValue),(e=>{e&&(f.value="",w((()=>{let e=null;g.value&&(g.value.input&&"function"==typeof g.value.input.focus?e=g.value.input:g.value.$el&&"function"==typeof g.value.$el.querySelector?e=g.value.$el.querySelector("input"):"function"==typeof g.value.focus&&(e=g.value)),e&&"function"==typeof e.focus&&e.focus()})))})),(t,n)=>(o(),r(ye,{"model-value":e.modelValue,"max-width":"500","onUpdate:modelValue":n[1]||(n[1]=e=>t.$emit("update:modelValue",e))},{default:i((()=>[s(he,null,{default:i((()=>[s(pe,{class:"headline"},{default:i((()=>[d(c(u(a)("encryptionDialog.title")),1)])),_:1}),n[4]||(n[4]=d()),s(fe,null,{default:i((()=>[s(Y,{ref_key:"passwordInputRef",ref:g,modelValue:f.value,"onUpdate:modelValue":n[0]||(n[0]=e=>f.value=e),type:"password",label:u(a)("encryptionDialog.labels.password"),autocomplete:"off",onKeyup:O(b,["enter"])},null,8,["modelValue","label"])])),_:1}),n[5]||(n[5]=d()),s(ge,null,{default:i((()=>[s(H),n[2]||(n[2]=d()),s(B,{text:"",onClick:y},{default:i((()=>[d(c(u(a)("encryptionDialog.buttons.cancel")),1)])),_:1}),n[3]||(n[3]=d()),s(B,{color:"primary",text:"",onClick:b},{default:i((()=>[d(c(u(a)("encryptionDialog.buttons.confirm")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["model-value"]))}},ar={__name:"DecryptionDialog",props:{modelValue:{type:Boolean,required:!0},error:{type:String,default:""}},emits:["update:modelValue","cancel","confirm"],setup(e,{emit:t}){const{t:a}=n(),l=e,p=t,g=h(""),y=h(null);function b(){p("cancel"),p("update:modelValue",!1)}function v(){""!==g.value.trim()&&p("confirm",g.value)}return m((()=>l.modelValue),(e=>{e&&(g.value="",w((()=>{let e=null;y.value&&(y.value.input&&"function"==typeof y.value.input.focus?e=y.value.input:y.value.$el&&"function"==typeof y.value.$el.querySelector?e=y.value.$el.querySelector("input"):"function"==typeof y.value.focus&&(e=y.value)),e&&"function"==typeof e.focus&&e.focus()})))})),(t,n)=>(o(),r(ye,{"model-value":e.modelValue,"max-width":"500","onUpdate:modelValue":n[1]||(n[1]=e=>t.$emit("update:modelValue",e))},{default:i((()=>[s(he,null,{default:i((()=>[s(pe,{class:"headline"},{default:i((()=>[d(c(u(a)("decryptionDialog.title")),1)])),_:1}),n[5]||(n[5]=d()),s(fe,null,{default:i((()=>[s(Y,{ref_key:"passwordInputRef",ref:y,modelValue:g.value,"onUpdate:modelValue":n[0]||(n[0]=e=>g.value=e),type:"password",label:u(a)("decryptionDialog.labels.password"),autocomplete:"off",onKeyup:O(v,["enter"])},null,8,["modelValue","label"]),n[2]||(n[2]=d()),e.error?(o(),r(me,{key:0,type:"error",class:"mt-3"},{default:i((()=>[d(c(e.error),1)])),_:1})):f("",!0)])),_:1}),n[6]||(n[6]=d()),s(ge,null,{default:i((()=>[s(H),n[3]||(n[3]=d()),s(B,{text:"",onClick:b},{default:i((()=>[d(c(u(a)("decryptionDialog.buttons.cancel")),1)])),_:1}),n[4]||(n[4]=d()),s(B,{color:"primary",text:"",onClick:v},{default:i((()=>[d(c(u(a)("decryptionDialog.buttons.confirm")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["model-value"]))}},rr={key:0,class:"text-h6 my-3"},or=["innerHTML"],ir=$e({__name:"FAQDialog",props:{modelValue:{type:Boolean,required:!0},faqItems:{type:Array,required:!0}},emits:["update:modelValue","close"],setup(e,{emit:t}){const{t:p}=n(),m=e,g=t,b=h(""),v=h([]),w=a((()=>{if(!b.value)return m.faqItems;const e=b.value.toLowerCase();return m.faqItems.filter((t=>t.question.toLowerCase().includes(e)||t.answer.toLowerCase().includes(e)||t.category&&t.category.toLowerCase().includes(e)))})),D=a((()=>w.value.reduce(((e,t)=>{const n=t.category||p("faqDialog.uncategorized");return e[n]||(e[n]=[]),e[n].push(t),e}),{})));function P(){g("close"),g("update:modelValue",!1),b.value="",v.value=[]}return(t,n)=>(o(),r(ye,{"model-value":e.modelValue,"max-width":"800",scrollable:"","onUpdate:modelValue":n[2]||(n[2]=e=>t.$emit("update:modelValue",e))},{default:i((()=>[s(he,null,{default:i((()=>[s(pe,{class:"headline"},{default:i((()=>[d(c(u(p)("faqDialog.title")),1)])),_:1}),n[8]||(n[8]=d()),s(fe,{class:"pt-4"},{default:i((()=>[s(Y,{modelValue:b.value,"onUpdate:modelValue":n[0]||(n[0]=e=>b.value=e),label:u(p)("faqDialog.searchLabel"),"prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"","hide-details":"",class:"mb-4"},null,8,["modelValue","label"]),n[6]||(n[6]=d()),s(we,{modelValue:v.value,"onUpdate:modelValue":n[1]||(n[1]=e=>v.value=e),multiple:""},{default:i((()=>[(o(!0),y(x,null,S(D.value,((e,t)=>(o(),y(x,{key:t},["null"!==t&&e.length>0?(o(),y("h3",rr,c(t),1)):f("",!0),n[4]||(n[4]=d()),(o(!0),y(x,null,S(e,((e,a)=>(o(),r(De,{key:`${t}-${a}`,value:`${t}-${a}`},{default:i((()=>[s(xe,null,{default:i((()=>[s(q,{start:"",icon:"mdi-help-circle-outline"}),d(" "+c(e.question),1)])),_:2},1024),n[3]||(n[3]=d()),s(Se,{class:"faq-answer"},{default:i((()=>[l("p",{innerHTML:e.answer},null,8,or)])),_:2},1024)])),_:2},1032,["value"])))),128))],64)))),128)),n[5]||(n[5]=d()),Object.keys(D.value).length?f("",!0):(o(),r(me,{key:0,type:"info",variant:"tonal",class:"mt-4"},{default:i((()=>[d(c(u(p)("faqDialog.noResults")),1)])),_:1}))])),_:1},8,["modelValue"])])),_:1}),n[9]||(n[9]=d()),s(ge,null,{default:i((()=>[s(H),n[7]||(n[7]=d()),s(B,{text:"",onClick:P},{default:i((()=>[d(c(u(p)("faqDialog.buttons.close")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["model-value"]))}},[["__scopeId","data-v-3b40532a"]]),lr={__name:"ResetConfirmationDialog",props:{modelValue:Boolean},emits:["update:modelValue","cancel","confirm"],setup(e,{emit:t}){const{t:a}=n(),p=t;function f(){p("cancel"),p("update:modelValue",!1)}function h(){p("confirm"),p("update:modelValue",!1)}return(t,n)=>(o(),r(ye,{"model-value":e.modelValue,"max-width":"500","onUpdate:modelValue":n[0]||(n[0]=e=>t.$emit("update:modelValue",e))},{default:i((()=>[s(he,null,{default:i((()=>[s(pe,{class:"headline"},{default:i((()=>[d(c(u(a)("resetConfirmationDialog.title")),1)])),_:1}),n[3]||(n[3]=d()),s(fe,null,{default:i((()=>[l("p",null,c(u(a)("resetConfirmationDialog.confirmationText")),1)])),_:1}),n[4]||(n[4]=d()),s(ge,null,{default:i((()=>[s(H),n[1]||(n[1]=d()),s(B,{text:"",onClick:f},{default:i((()=>[d(c(u(a)("resetConfirmationDialog.buttons.cancel")),1)])),_:1}),n[2]||(n[2]=d()),s(B,{color:"error",text:"",onClick:h},{default:i((()=>[d(c(u(a)("resetConfirmationDialog.buttons.reset")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["model-value"]))}},sr={__name:"SaveDataDialog",props:{modelValue:{type:Boolean,required:!0},defaultFileName:{type:String,default:""}},emits:["update:modelValue","cancel","confirm"],setup(e,{emit:t}){const{t:a}=n(),p=e,f=t,g=h(p.defaultFileName||a("saveDataDialog.defaultFileName"));function y(){f("cancel"),f("update:modelValue",!1)}function b(){f("confirm",g.value),f("update:modelValue",!1)}return m((()=>p.modelValue),(e=>{e&&(g.value=p.defaultFileName||a("saveDataDialog.defaultFileName"))})),(t,n)=>(o(),r(ye,{"model-value":e.modelValue,"max-width":"500","onUpdate:modelValue":n[1]||(n[1]=e=>t.$emit("update:modelValue",e))},{default:i((()=>[s(he,null,{default:i((()=>[s(pe,{class:"headline"},{default:i((()=>[d(c(u(a)("saveDataDialog.title")),1)])),_:1}),n[5]||(n[5]=d()),s(fe,null,{default:i((()=>[l("p",null,c(u(a)("saveDataDialog.instruction")),1),n[2]||(n[2]=d()),s(Y,{modelValue:g.value,"onUpdate:modelValue":n[0]||(n[0]=e=>g.value=e),label:u(a)("saveDataDialog.labels.fileName"),placeholder:u(a)("saveDataDialog.placeholders.fileName"),hint:u(a)("saveDataDialog.hints.fileName"),"persistent-hint":""},null,8,["modelValue","label","placeholder","hint"])])),_:1}),n[6]||(n[6]=d()),s(ge,null,{default:i((()=>[s(H),n[3]||(n[3]=d()),s(B,{text:"",onClick:y},{default:i((()=>[d(c(u(a)("saveDataDialog.buttons.cancel")),1)])),_:1}),n[4]||(n[4]=d()),s(B,{color:"primary",text:"",onClick:b},{default:i((()=>[d(c(u(a)("saveDataDialog.buttons.export")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["model-value"]))}},dr={__name:"LoadDataDialog",props:{modelValue:{type:Boolean,required:!0},error:{type:String,default:""}},emits:["update:modelValue","cancel","confirm"],setup(e,{emit:t}){const{t:a}=n(),p=e,g=t,y=h(null),b=h("");function v(){g("cancel"),g("update:modelValue",!1)}function w(){y.value?g("confirm",y.value):b.value=a("loadDataDialog.validation.fileRequired")}return m((()=>p.modelValue),(e=>{e&&(y.value=null,b.value="")})),(t,n)=>(o(),r(ye,{"model-value":e.modelValue,"max-width":"500","onUpdate:modelValue":n[1]||(n[1]=e=>t.$emit("update:modelValue",e))},{default:i((()=>[s(he,null,{default:i((()=>[s(pe,{class:"headline"},{default:i((()=>[d(c(u(a)("loadDataDialog.title")),1)])),_:1}),n[6]||(n[6]=d()),s(fe,null,{default:i((()=>[l("p",null,c(u(a)("loadDataDialog.instruction")),1),n[2]||(n[2]=d()),s(Pe,{modelValue:y.value,"onUpdate:modelValue":n[0]||(n[0]=e=>y.value=e),label:u(a)("loadDataDialog.labels.fileInput"),accept:".json","prepend-icon":"mdi-file-import","show-size":"","truncate-length":"30","error-messages":b.value},null,8,["modelValue","label","error-messages"]),n[3]||(n[3]=d()),e.error?(o(),r(me,{key:0,type:"error",class:"mt-2"},{default:i((()=>[d(c(e.error),1)])),_:1})):f("",!0)])),_:1}),n[7]||(n[7]=d()),s(ge,null,{default:i((()=>[s(H),n[4]||(n[4]=d()),s(B,{text:"",onClick:v},{default:i((()=>[d(c(u(a)("loadDataDialog.buttons.cancel")),1)])),_:1}),n[5]||(n[5]=d()),s(B,{color:"primary",text:"",onClick:w,disabled:!y.value},{default:i((()=>[d(c(u(a)("loadDataDialog.buttons.import")),1)])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}};function cr(e){return"string"==typeof e&&e.trim().length>0}function ur(e){const t={};let n=!0;var a;return cr(e.firstName)||(t.firstName="validation.required.firstName",n=!1),cr(e.lastName)||(t.lastName="validation.required.lastName",n=!1),function(e){if(!e)return!1;if(!/^\d{4}-\d{2}-\d{2}$/.test(e))return!1;const t=new Date(e);if(isNaN(t.getTime()))return!1;const n=new Date;return n.setHours(0,0,0,0),t<=n}(e.birthdate)||(e.birthdate?t.birthdate="validation.invalid.birthdate":t.birthdate="validation.required.birthdate",n=!1),cr(e.sex)||(t.sex="validation.required.sex",n=!1),cr(e.insurance)||(t.insurance="validation.required.insurance",n=!1),cr(e.referrer)||(t.referrer="validation.required.referrer",n=!1),cr(e.diagnosis)||(t.diagnosis="validation.required.diagnosis",n=!1),e.email&&((a=e.email)&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))&&(t.email="validation.invalid.email",n=!1),{valid:n,errors:t}}function pr(e){const t={};let n=!0;return Array.isArray(e)?(e.forEach(((e,a)=>{const r=`phenotypeData[${a}]`;let o=!0;if(e&&cr(e.id)){/^HP:\d{7}$/.test(e.id)||(t[`${r}.id`]="validation.invalid.hpoIdFormat",o=!1)}else t[`${r}.id`]="validation.required.phenotypeId",o=!1;e&&cr(e.status)||(t[`${r}.status`]="validation.required.phenotypeStatus",o=!1),o||(n=!1)})),{valid:n,errors:t}):{valid:!0,errors:{}}}function fr(e){if(!e)return{valid:!1,errors:{general:"validation.general.missingData"},sections:{personalInfo:!1,selectedPanels:!1,category:!1,consent:!1}};const t=ur(e.personalInfo||{}),n={valid:!0,errors:{}},a=(e.category,{valid:!0,errors:{}}),r=pr(e.phenotypeData||[]),o=(e.consent,{valid:!0,errors:{}}),i={};Object.entries(t.errors).forEach((([e,t])=>{i[e]=t,i["personalInfo."+e]=t})),Object.entries(n.errors).forEach((([e,t])=>{i[e]=t,i["selectedPanels."+e]=t})),Object.entries(a.errors).forEach((([e,t])=>{i[e]=t,i["category."+e]=t})),Object.entries(r.errors).forEach((([e,t])=>{e.startsWith("phenotypeData[")?i[e]=t:(i[e]=t,i["phenotypeData."+e]=t)})),Object.entries(o.errors).forEach((([e,t])=>{i[e]=t,i["consent."+e]=t}));return{valid:t.valid&&n.valid&&r.valid&&o.valid,errors:i,sections:{personalInfo:t.valid,selectedPanels:n.valid,category:a.valid,phenotypeData:r.valid,consent:o.valid}}}function hr(){const t=e({personalInfo:{firstName:"",lastName:"",birthdate:"",sex:"",insurance:"",insuranceId:"",referrer:"",diagnosis:""},selectedPanels:[],phenotypeData:[],category:"",consent:{dataProcessing:!1,incidentalFindings:!1}}),n=h(!1),r=e({touched:!1,results:fr(t),showErrors:!1}),o=a((()=>r.results.valid)),i=a((()=>r.results.errors)),l=a((()=>r.results.sections));function s(e=!1){return r.touched=!0,r.showErrors=e,r.results=fr(t),r.results.valid}function d(e){if(Object.assign(t.personalInfo,e),r.touched){const e=ur(t.personalInfo);return s(r.showErrors),e}return{valid:!0,errors:{}}}function c(e){if(t.selectedPanels=[...e],r.touched){const e=(t.selectedPanels,{valid:!0,errors:{}});return s(r.showErrors),e}return{valid:!0,errors:{}}}function u(e){if(t.phenotypeData=[...e],r.touched){const e=pr(t.phenotypeData);return s(r.showErrors),e}return{valid:!0,errors:{}}}function p(e){if(t.category=e,r.touched){const e=(t.category,{valid:!0,errors:{}});return s(r.showErrors),e}return{valid:!0,errors:{}}}function f(e){if(Object.assign(t.consent,e),r.touched){const e=(t.consent,{valid:!0,errors:{}});return s(r.showErrors),e}return{valid:!0,errors:{}}}function m(){const e={personalInfo:{firstName:"",lastName:"",birthdate:"",sex:"",insurance:"",insuranceId:"",referrer:"",diagnosis:""},selectedPanels:[],phenotypeData:[],category:"",consent:{dataProcessing:!1,incidentalFindings:!1}};Object.keys(e).forEach((n=>{t[n]=e[n]})),n.value=!1,r.touched=!1,r.showErrors=!1,r.results=fr(t)}return{patientData:t,initializedFromUrl:n,updatePersonalInfo:d,updateSelectedPanels:c,updatePhenotypeData:u,updateCategory:p,updateConsent:f,resetPatientData:m,initializeFromExternalData:function(e,a=!1){if(a)m(),e.personalInfo&&d(e.personalInfo),e.selectedPanels&&c(e.selectedPanels),e.phenotypeData&&u(e.phenotypeData),e.category&&p(e.category),e.consent&&f(e.consent);else{const n=function(e,t){const n=JSON.parse(JSON.stringify(e));return t.personalInfo&&Object.entries(t.personalInfo).forEach((([e,t])=>{null!=t&&""!==t&&(n.personalInfo[e]=t)})),t.selectedPanels&&t.selectedPanels.length>0&&(n.selectedPanels=[...t.selectedPanels]),t.phenotypeData&&t.phenotypeData.length>0&&(n.phenotypeData=[...t.phenotypeData]),t.category&&(n.category=t.category),t.consent&&Object.entries(t.consent).forEach((([e,t])=>{void 0!==t&&(n.consent[e]=t)})),n}(t,e);d(n.personalInfo),c(n.selectedPanels),u(n.phenotypeData),p(n.category),f(n.consent)}n.value=!0},exportPatientData:function(){return JSON.parse(JSON.stringify(t))},isValid:o,validationErrors:i,sectionValidation:l,validateForm:s,getFieldErrors:function(e){if(!r.showErrors)return{};const t={},n="personalInfo"===e?"personalInfo.":"";return Object.entries(r.results.errors).forEach((([a,r])=>{if(a.startsWith(n)){const e=a.replace(n,"");t[e]=r}else"root"!==e||a.includes(".")||(t[a]=r)})),t}}}const mr=La("form",(()=>{const{patientData:e,updatePersonalInfo:t,updateSelectedPanels:n,updatePhenotypeData:r,updateCategory:o,updateConsent:i,resetPatientData:l,exportPatientData:s,isValid:d,validationErrors:c,sectionValidation:u,validateForm:p}=hr(),f=h({}),m=h(!1),g=h(""),y=h(!1),b=a((()=>`requiform-data-${(new Date).toISOString().split("T")[0]}.json`));function v(){Me.debug("Syncing legacy → unified data model"),t({firstName:e.personalInfo.givenName||e.personalInfo.firstName||"",lastName:e.personalInfo.familyName||e.personalInfo.lastName||"",birthdate:e.personalInfo.birthdate||"",sex:e.personalInfo.sex||"",insurance:e.personalInfo.insurance||"",referrer:e.personalInfo.physicianName||e.personalInfo.referrer||"",diagnosis:e.personalInfo.diagnosis||""}),r(f.value?Object.values(f.value):[]);const n=e.category||e.personalInfo.category||"";n&&(Me.debug("Syncing category:",n),o(n))}function w(){if(Me.debug("Syncing unified → legacy data model"),e.personalInfo.givenName=e.personalInfo.firstName||"",e.personalInfo.familyName=e.personalInfo.lastName||"",e.personalInfo.birthdate=e.personalInfo.birthdate||"",e.personalInfo.sex=e.personalInfo.sex||"",e.personalInfo.insurance=e.personalInfo.insurance||"",e.personalInfo.physicianName=e.personalInfo.referrer||"",e.personalInfo.diagnosis=e.personalInfo.diagnosis||"",e.category?e.personalInfo.category=e.category:e.personalInfo.category&&(e.category=e.personalInfo.category),e.phenotypeData&&e.phenotypeData.length>0){const t={};e.phenotypeData.forEach((e=>{e.id&&(t[e.id]=e)})),f.value=t}e.personalInfo={...e.personalInfo}}function D(e){f.value={...e},v()}function x(e){m.value=e}function S(){l(),f.value={},m.value=!1,g.value="",y.value=!1}function P(e){return e?Object.values(e).filter((e=>e&&e.id)):[]}return{patientData:e,isValid:d,validationErrors:c,sectionValidation:u,phenotypeDataObj:f,showPedigree:m,pedigreeDataUrl:g,showValidation:y,saveDataName:b,validateForm:function(e=!0){return y.value=e,p(e)},updateConsent:i,getFieldErrors:(e=null)=>{if(!y.value||!c.value)return{};if(!e)return c.value;const t={};return Object.entries(c.value).forEach((([n,a])=>{if(n.startsWith(e+".")){const r=n.substring(e.length+1);t[r]=a}else if(!n.includes(".")){const r=`${e}.${n}`;c.value[r]&&(t[n]=a)}})),t},updatePatientData:function(t){Object.assign(e.personalInfo,t),v()},updatePhenotypeDataObj:D,updatePedigreeDataUrl:function(e){g.value=e},setShowPedigree:x,resetValidation:function(){y.value=!1},setShowValidation:function(e=!0){y.value=e},resetForm:S,syncUnifiedPatientData:v,syncLegacyPatientData:w,exportFormData:function(){v();const t=e.category||"";return{patientData:s(),selectedPanels:e.selectedPanels||[],phenotypeData:P(f.value),showPedigree:m.value,category:t}},importFormData:function(e,a=!0){if(Me.debug("formStore: Starting importFormData",{data:JSON.stringify(e).substring(0,200)+"...",overwrite:a}),!e||"object"!=typeof e)return Me.error("formStore: Invalid input data for import.",e),!1;try{a&&(Me.debug("formStore: Resetting form before import (overwrite=true)"),S());const r=e.patientData&&"object"==typeof e.patientData?e.patientData:e;Me.debug("formStore: Determined sourcePatientData for import.",r);const i={},l=r.personalInfo&&"object"==typeof r.personalInfo?r.personalInfo:{},s=["firstName","lastName","birthdate","sex","insurance","referrer","diagnosis"];!l.firstName&&l.givenName&&(l.firstName=l.givenName),!l.lastName&&l.familyName&&(l.lastName=l.familyName),!l.referrer&&l.physicianName&&(l.referrer=l.physicianName),s.forEach((e=>{l[e]&&"string"==typeof l[e]?i[e]=l[e].substring(0,1e3):i[e]=""})),Me.debug("formStore: Mapped newPersonalInfo:",i),t(i);let d="";e.category&&"string"==typeof e.category?d=e.category:r.category&&"string"==typeof r.category?d=r.category:l.category&&"string"==typeof l.category&&(d=l.category),!d&&e.selectedTests&&e.selectedTests.includes("nephronophthise")&&(d="nephrology"),d&&(Me.debug("formStore: Setting category:",d.substring(0,100)),o(d.substring(0,100)));let c=[];if(Array.isArray(r.selectedPanels)?c=r.selectedPanels:Array.isArray(e.selectedTests)&&(c=e.selectedTests),c.length>0){const e=c.filter((e=>"string"==typeof e)).map((e=>e.substring(0,100)));Me.debug("formStore: Setting selected panels:",e),n(e)}let u=null;if(r.phenotypeData?u=r.phenotypeData:e.phenotypeData&&(u=e.phenotypeData),u){const e={};Array.isArray(u)?(Me.debug("formStore: Importing phenotype data from ARRAY format"),u.forEach((t=>{if(t&&"object"==typeof t&&t.id&&"string"==typeof t.id){let n="no_input";"string"==typeof t.status&&["present","absent"].includes(t.status.toLowerCase())&&(n=t.status.toLowerCase()),e[t.id.substring(0,50)]={id:t.id.substring(0,50),label:"string"==typeof t.label?t.label.substring(0,200):"",status:n}}}))):"object"==typeof u&&(Me.debug("formStore: Importing phenotype data from OBJECT format"),Object.entries(u).forEach((([t,n])=>{if(n&&"object"==typeof n&&t&&"string"==typeof t){let a="no_input";"string"==typeof n.status&&["present","absent"].includes(n.status.toLowerCase())&&(a=n.status.toLowerCase()),e[t.substring(0,50)]={id:t.substring(0,50),label:"string"==typeof n.label?n.label.substring(0,200):"",status:a}}}))),Me.debug("formStore: Setting phenotype data object:",e),D(e)}return"boolean"==typeof e.showPedigree&&(Me.debug("formStore: Setting show pedigree:",e.showPedigree),x(e.showPedigree)),Me.debug("formStore: Synchronizing data models post-import"),v(),w(),Me.info("formStore: Data import successful."),!0}catch(r){return Me.error("formStore: Error during importFormData:",r),!1}},convertPhenotypeDataToUnifiedFormat:P}})),gr=La("settings",(()=>{const e=h("true"===localStorage.getItem("disclaimerAcknowledged")),t=h(localStorage.getItem("acknowledgmentTime")||"");return{disclaimerAcknowledged:e,acknowledgmentTime:t,acknowledgeDisclaimer:function(){const n=(new Date).toISOString().split("T")[0];e.value=!0,t.value=n,localStorage.setItem("disclaimerAcknowledged","true"),localStorage.setItem("acknowledgmentTime",n)},resetDisclaimerAcknowledgment:function(){e.value=!1,t.value="",localStorage.removeItem("disclaimerAcknowledged"),localStorage.removeItem("acknowledgmentTime")}}}));function yr(){var e;try{if(function(e){const t=new URLSearchParams(window.location.search);if(t.has(e))return t.get(e);if(window.location.hash&&window.location.hash.length>1){const t=new URLSearchParams(window.location.hash.substring(1));if(t.has(e))return t.get(e)}return null}("encrypted"))return{};let n={},a=!1;const r=new URLSearchParams(window.location.search);if(r.toString()){Me.debug("Found query parameters:",window.location.search);for(const[e,t]of r.entries())if("encrypted"!==e)try{n[e]=JSON.parse(decodeURIComponent(t)),a=!0}catch{n[e]=decodeURIComponent(t),a=!0}}if(window.location.hash&&window.location.hash.length>1){const r=new URLSearchParams(window.location.hash.substring(1)),o=r.get("data");if(o)try{const t=JSON.parse(decodeURIComponent(o));if("object"==typeof t){if(Me.debug("Found JSON data in URL hash:",t),t.patientData&&t.patientData.selectedPanels?(Me.debug("Hash data contains nested selectedPanels:",t.patientData.selectedPanels),t.selectedTests||(t.selectedTests=[...t.patientData.selectedPanels],Me.debug("Added top-level selectedTests from nested data:",t.selectedTests))):t.selectedTests&&!(null==(e=t.patientData)?void 0:e.selectedPanels)&&(t.patientData||(t.patientData={}),t.patientData.selectedPanels=[...t.selectedTests],Me.debug("Added nested selectedPanels from top-level data:",t.patientData.selectedPanels)),t.phenotypeData){if(t.patientData&&!t.patientData.phenotypeData&&(t.patientData.phenotypeData=Array.isArray(t.phenotypeData)?[...t.phenotypeData]:[t.phenotypeData],Me.debug("Added nested phenotypeData from top-level:",t.patientData.phenotypeData)),t.category&&"object"==typeof t.phenotypeData&&!Array.isArray(t.phenotypeData)&&!t.phenotypeData[t.category]&&Object.keys(t.phenotypeData).length>0){const e={};e[t.category]=t.phenotypeData,t.phenotypeData=e,Me.debug("Categorized phenotype data by category:",t.category)}}else if(t.patientData&&t.patientData.phenotypeData&&Array.isArray(t.patientData.phenotypeData)){const e=t.patientData.phenotypeData[0]||{};if(t.category){const n={};n[t.category]=e,t.phenotypeData=n}else t.phenotypeData=e;Me.debug("Added top-level phenotypeData from nested array:",t.phenotypeData)}return t}}catch(t){Me.error("Error parsing JSON data from URL:",t)}for(const[e,t]of r.entries())if("data"!==e)try{n[e]=JSON.parse(decodeURIComponent(t)),a=!0}catch{n[e]=decodeURIComponent(t),a=!0}}if(n.personalInfo||n.phenotypeData||n.selectedPanels)return n;if(a){Me.debug("Converting legacy format data:",n);return{personalInfo:{firstName:n.givenName||"",lastName:n.familyName||"",birthdate:n.birthdate||"",sex:n.sex||"",diagnosis:n.diagnosis||"",insurance:n.insurance||"",referrer:n.physicianName||""},selectedPanels:Array.isArray(n.selectedTests)?n.selectedTests:n.selectedPanels?[n.selectedPanels]:[],phenotypeData:n.phenotypeData||[],category:n.category||""}}return{}}catch(n){return Me.error("Error parsing URL parameters:",n),{}}}function br(){!function(){try{const e=window.location.protocol+"//"+window.location.host+window.location.pathname;window.history.replaceState(null,document.title,e),(window.location.search||window.location.hash)&&(Me.warn("First attempt to clear parameters failed, trying alternate method..."),window.location.hash&&history.pushState("",document.title,window.location.pathname+window.location.search),window.location.search&&history.pushState("",document.title,window.location.pathname),window.history.replaceState(null,document.title,e)),Me.debug("URL parameters cleared successfully")}catch(e){Me.error("Error clearing URL parameters:",e);const t=window.location.protocol+"//"+window.location.host+window.location.pathname;window.location.href!==t&&(window.location.href=t)}}()}const vr="AES-GCM";async function wr(e,t){const n=(new TextEncoder).encode(e),a=await crypto.subtle.importKey("raw",n,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},a,{name:vr,length:256},!1,["encrypt","decrypt"])}async function Dr(e,t){if(!t)throw Me.warn("encryptData called without a password."),new Error("Password is required for encryption.");if("string"!=typeof e)throw Me.warn("encryptData called with non-string input."),new Error("Input data must be a string.");try{const n=crypto.getRandomValues(new Uint8Array(16)),a=crypto.getRandomValues(new Uint8Array(12)),r=await wr(t,n),o=(new TextEncoder).encode(e),i=await crypto.subtle.encrypt({name:vr,iv:a},r,o),l=new Uint8Array(n.length+a.length+i.byteLength);l.set(n,0),l.set(a,n.length),l.set(new Uint8Array(i),n.length+a.length);const s=function(e){let t="";const n=new Uint8Array(e),a=n.byteLength;for(let o=0;o<a;o++)t+=String.fromCharCode(n[o]);try{return window.btoa(t)}catch(r){throw Me.error("Base64 encoding failed:",r),new Error("Failed to encode data to Base64.")}}(l.buffer);return s.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}catch(n){throw Me.error("Encryption failed:",n),new Error("Encryption process failed.")}}async function xr(e,t){if(!t)throw Me.warn("decryptData called without a password."),new Error("Password is required for decryption.");if("string"!=typeof e||0===e.length)throw Me.warn("decryptData called with invalid encrypted data input."),new Error("Invalid encrypted data provided.");const n=10485760;if(e.length>n)throw new Error("Encrypted data exceeds maximum allowed size of 10MB.");let a;try{a=function(e){try{let t=e.replace(/-/g,"+").replace(/_/g,"/");for(;t.length%4;)t+="=";const n=window.atob(t),a=n.length,r=new Uint8Array(a);for(let e=0;e<a;e++)r[e]=n.charCodeAt(e);return r.buffer}catch(t){throw Me.error("Base64 decoding failed:",t),t instanceof DOMException&&"InvalidCharacterError"===t.name?new Error("Failed to decode Base64 data: Invalid characters detected."):new Error("Failed to decode Base64 data. It might be corrupted.")}}(e)}catch(o){throw Me.error("Base64 decoding failed during decryption attempt:",o),new Error("Decryption failed: Invalid data format.")}const r=new Uint8Array(a);if(r.length<28)throw Me.error(`Decryption failed: Data length (${r.length}) is less than minimum required (28).`),new Error("Decryption failed: Data appears incomplete or corrupted.");try{const e=r.slice(0,16),n=r.slice(16,28),a=r.slice(28),o=await wr(t,e),i=await crypto.subtle.decrypt({name:vr,iv:n},o,a),l=new TextDecoder;return l.decode(i)}catch(o){throw Me.error("Decryption failed during crypto operation:",o),new Error("Decryption failed. Please check the password or the link may be corrupted.")}}const Sr=102400;function Pr(){const e=h(""),t=Oa(),n=mr();function a(e){if(window.location.hash&&window.location.hash.length>1){const t=new URLSearchParams(window.location.hash.substring(1));if(t.has(e)){const n=window.location.hash.substring(1).split("&");for(const t of n){const[n,a]=t.split("=");if(n===e)return a}return t.get(e)}}return null}function r(){try{const e=o(n.exportFormData());Me.debug("Creating URL with compact data format");const a=JSON.stringify(e),r=window.location.protocol+"//"+window.location.host+window.location.pathname,i=`${r}#data=${encodeURIComponent(a)}`;return Me.debug(`Generated URL length: ${i.length} characters`),i.length>2e3&&(Me.warn(`[URL Handler] Generated plain data URL length (${i.length}) exceeds 2000 characters. This may cause issues in some browsers or tools.`),t.showSnackbar("Warning: Generated URL is very long and might not work everywhere.","warning",{timeout:7e3})),i}catch(e){return Me.error("Error creating shareable URL:",e),t.showSnackbar("Error creating shareable URL."),window.location.href}}function o(e){if(null==e||"object"!=typeof e)return e;if(Array.isArray(e))return e.filter((e=>{if("object"!=typeof e)return!0;const t=o(e);return Object.keys(t).length>0})).map((e=>o(e)));const t={};for(const[n,a]of Object.entries(e))if(null!=a&&""!==a&&(!Array.isArray(a)||0!==a.length))if("object"==typeof a){const e=o(a);Object.keys(e).length>0&&(t[n]=e)}else t[n]=a;return t}async function i(e){try{const a=n.exportFormData(),r={patientData:a.patientData,phenotypeData:a.phenotypeData,showPedigree:a.showPedigree},o=JSON.stringify(r);Me.debug(`JSON data length before encryption: ${o.length} characters`);const i=await Dr(o,e),l=`${window.location.protocol+"//"+window.location.host+window.location.pathname}#encrypted=${encodeURIComponent(i)}`;return Me.debug(`Encrypted URL (hash) length: ${l.length} characters`),l.length>2e3&&(Me.warn(`[URL Handler] Generated encrypted URL length (${l.length}) exceeds 2000 characters. This may cause issues in some browsers or tools.`),t.showSnackbar("Warning: Generated encrypted URL is very long and might not work everywhere.","warning",{timeout:7e3})),l}catch(a){throw t.showSnackbar("error",`Encryption failed: ${a.message||"Unknown error"}`),new Error("Failed to create encrypted URL.")}}async function l(e,n){if(!e||!n)return t.setDecryptionError("Missing data or password."),null;t.setDecryptionError(null);try{const t=await xr(e,n),a=JSON.parse(t);if(Ue(a),"object"!=typeof a||null===a||!a.patientData||!a.phenotypeData)throw new Error("Decrypted data has an invalid structure.");return a}catch(a){return t.setDecryptionError(a.message||"Decryption failed. Check password or link."),null}}const s=async a=>{if(e.value&&a){Me.debug("Password submitted. Attempting decryption.");const r=await l(e.value,a);r?(Me.debug("Decryption successful, importing data."),n.importFormData(r,!0),e.value=null,br(),t.cancelDecryption(),t.showSnackbar("Data decrypted and loaded successfully!")):Me.warn("Decryption attempt failed with submitted password.")}else Me.warn("Password submission handler called without pending encrypted data or password.")};return{pendingEncryptedValue:e,initializeFromUrl:async function(){if(window.location.href.length>20480)return Me.warn(`[URL Handler] Incoming URL length (${window.location.href.length}) exceeds maximum allowed (20480). Aborting initialization.`),void t.showSnackbar("Error: URL is too long to process.","error");const r=a("data"),o=a("encrypted");if(r){if(r.length>Sr)return Me.warn(`[URL Handler] Incoming 'data' parameter length (${r.length}) exceeds maximum allowed (102400). Aborting processing.`),t.showSnackbar("Error: Input data is too large.","error"),void br();Me.debug('Found "data" parameter in URL hash.');try{const e=decodeURIComponent(r);if(e.length>Sr)return Me.warn(`[URL Handler] Incoming 'data' parameter length (${e.length}) exceeds maximum allowed (102400). Aborting processing.`),t.showSnackbar("Error: Input data is too large.","error"),void br();let a=JSON.parse(e);a=Ue(a),Me.debug('Sanitized JSON data from "data" parameter.'),n.importFormData(a,!0),br(),t.showSnackbar("Data loaded successfully from URL!")}catch(i){Me.error('Error processing "data" parameter from URL:',i),t.showSnackbar("Error loading data from URL. The data might be corrupted.","error"),br()}}else if(o){if(o.length>Sr)return Me.warn(`[URL Handler] Incoming 'encrypted' parameter length (${o.length}) exceeds maximum allowed (102400). Aborting decryption.`),t.showSnackbar("Error: Encrypted data is too large.","error"),void br();Me.debug('Found "encrypted" parameter in URL hash. Prompting for password.');const n=o,r=a("password");r?(Me.debug("Found password parameter. Attempting direct decryption."),await s(r)):(Me.debug("Password not found in URL. Showing password dialog."),t.openDecryptionDialog(),e.value=n)}else{const e=yr();Object.keys(e).length>0?(Me.debug("Found legacy query parameters. Importing..."),n.importFormData(e,!0),br(),t.showSnackbar("Legacy data loaded successfully from URL!")):Me.debug("No relevant data parameters found in URL.")}},createShareableUrl:r,copyShareableUrl:async function(){try{const e=r();return await navigator.clipboard.writeText(e),t.showSnackbar("URL copied to clipboard!"),!0}catch(e){return Me.error("Error copying URL to clipboard:",e),t.showSnackbar("Error copying URL to clipboard."),!1}},createEncryptedUrl:i,copyEncryptedUrl:async function(e){try{const n=await i(e);return!!n&&(await navigator.clipboard.writeText(n),t.showSnackbar("Encrypted URL copied to clipboard!"),!0)}catch(n){return!1}},decryptUrlData:l,handlePasswordSubmit:s}}function kr(){const e=h(null),t=Oa(),n=mr();function a(e){try{if(!e||"string"!=typeof e)return Me.error("Process error: No valid data provided"),t.showSnackbar("No valid data provided."),!1;Me.debug("Processing pasted data:",e.substring(0,100)+"...");const a=Ma(e);return Me.debug("Parse result:",a),a.success?(Me.debug("Importing parsed data:",a.data),n.importFormData(a.data,!0),n.syncLegacyPatientData(),n.syncUnifiedPatientData(),Me.debug("Form state after import:",{patientData:n.patientData,selectedTests:n.selectedTests,phenotypeDataObj:n.phenotypeDataObj}),t.showSnackbar("Data imported successfully!"),!0):(Me.error("Parse failed:",a.error),t.showSnackbar(a.error||"Invalid data format."),!1)}catch(a){return Me.error("Error processing pasted data:",a),t.showSnackbar("Error processing pasted data. Please check the format."),!1}}function r(e){return!(!e||"object"!=typeof e)&&(e.patientData&&"object"==typeof e.patientData||e.selectedTests&&Array.isArray(e.selectedTests)||e.phenotypeData&&"object"==typeof e.phenotypeData)}return{importedFile:e,saveToFile:function(e){try{const a=function(e,t="requiform-data"){try{const n=JSON.stringify(e,null,2),a=new Blob([n],{type:"application/json"}),r=document.createElement("a");return r.href=URL.createObjectURL(a),r.download=`${t}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href),!0}catch(n){return!1}}(n.exportFormData(),e);return a?(t.showSnackbar("Data saved successfully!"),Me.debug("Data saved successfully to",e),!0):(t.showSnackbar("Error saving data to file."),Me.error("Error saving data to file."),!1)}catch(a){return Me.error("Error saving data to file:",a),t.showSnackbar("Error saving data to file."),!1}},loadFromFile:async function(a){try{if(!a)return t.setLoadDataError("No file selected."),!1;e.value=a;let o=await function(e){return new Promise(((t,n)=>{if(!e)return void n(new Error("No file provided"));const a=new FileReader;a.onload=e=>{try{const n=JSON.parse(e.target.result);t(n)}catch{n(new Error("Invalid JSON format"))}},a.onerror=()=>{n(new Error("Error reading file"))},a.readAsText(e)}))}(a);return o=Ue(o),Me.debug("Sanitized JSON data from file."),r(o)?(n.importFormData(o,!0),t.showSnackbar("Data loaded successfully!"),Me.debug("Data loaded from file:",a.name,o),!0):(t.setLoadDataError("Invalid data format. The file does not contain valid RequiForm data."),!1)}catch(o){return Me.error("Error loading data from file:",o),t.setLoadDataError(`Error loading data: ${o.message}`),!1}},processPastedData:a,importFromJson:async function(e){if(!e||"string"!=typeof e)return Me.error("Import error: No valid data provided",e),t.showSnackbar("No valid data provided."),!1;Me.debug("Attempting to import data:",e.substring(0,100)+"...");try{let a=JSON.parse(e);if(Me.debug("Successfully parsed as JSON:",a),a=Ue(a),Me.debug("Sanitized JSON data from pasted input."),r(a)){Me.debug("Valid form data format detected, importing directly");const e=n.importFormData(a,!0);return Me.debug("Import result:",e,"Current form state:",{patientData:n.patientData,selectedTests:n.selectedTests,phenotypeDataObj:n.phenotypeDataObj}),n.syncLegacyPatientData(),n.syncUnifiedPatientData(),t.showSnackbar("Data imported successfully!"),!0}return Me.error("Invalid data format:",a),t.showSnackbar("Invalid data format. The JSON does not contain valid RequiForm data."),!1}catch(o){return Me.debug("Not valid JSON, trying formatted text processing:",o.message),a(e)}},isValidFormData:r}}function _r(e){return e instanceof HTMLElement}function Cr(e){return"function"==typeof e}function Ar(e){return"string"==typeof e}function Ir(e){return void 0===e}class Fr{on(e,t,n,a=!1){var r;return Ir(this.bindings)&&(this.bindings={}),Ir(this.bindings[e])&&(this.bindings[e]=[]),null==(r=this.bindings[e])||r.push({handler:t,ctx:n,once:a}),this}once(e,t,n){return this.on(e,t,n,!0)}off(e,t){if(Ir(this.bindings)||Ir(this.bindings[e]))return this;var n;Ir(t)?delete this.bindings[e]:null==(n=this.bindings[e])||n.forEach(((n,a)=>{var r;n.handler===t&&(null==(r=this.bindings[e])||r.splice(a,1))}));return this}trigger(e,...t){var n;!Ir(this.bindings)&&this.bindings[e]&&(null==(n=this.bindings[e])||n.forEach(((n,a)=>{const{ctx:r,handler:o,once:i}=n,l=r||this;var s;(o.apply(l,t),i)&&(null==(s=this.bindings[e])||s.splice(a,1))})));return this}}function Er(){return Er=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Er.apply(null,arguments)}function Nr(e,t){if(null==e)return{};var n={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(t.includes(a))continue;n[a]=e[a]}return n}const Lr={defaultMerge:Symbol("deepmerge-ts: default merge"),skip:Symbol("deepmerge-ts: skip")};function Or(e,t){return t}function Vr(e,t){return e.filter((e=>void 0!==e))}var Tr,Rr;function zr(e){return"object"!=typeof e||null===e?0:Array.isArray(e)?2:function(e){if(!Ur.has(Object.prototype.toString.call(e)))return!1;const{constructor:t}=e;if(void 0===t)return!0;const n=t.prototype;if(null===n||"object"!=typeof n||!Ur.has(Object.prototype.toString.call(n)))return!1;if(!n.hasOwnProperty("isPrototypeOf"))return!1;return!0}(e)?1:e instanceof Set?3:e instanceof Map?4:5}function Mr(e){return{*[Symbol.iterator](){for(const t of e)for(const e of t)yield e}}}(Rr=Tr||(Tr={}))[Rr.NOT=0]="NOT",Rr[Rr.RECORD=1]="RECORD",Rr[Rr.ARRAY=2]="ARRAY",Rr[Rr.SET=3]="SET",Rr[Rr.MAP=4]="MAP",Rr[Rr.OTHER=5]="OTHER";const Ur=new Set(["[object Object]","[object Module]"]);const qr={mergeRecords:function(e,t,n){const a={};for(const i of function(e){const t=new Set;for(const n of e)for(const e of[...Object.keys(n),...Object.getOwnPropertySymbols(n)])t.add(e);return t}(e)){const l=[];for(const t of e)o=i,"object"==typeof(r=t)&&Object.prototype.propertyIsEnumerable.call(r,o)&&l.push(t[i]);if(0===l.length)continue;const s=t.metaDataUpdater(n,{key:i,parents:e}),d=Br(l,t,s);d!==Lr.skip&&("__proto__"===i?Object.defineProperty(a,i,{value:d,configurable:!0,enumerable:!0,writable:!0}):a[i]=d)}var r,o;return a},mergeArrays:function(e){return e.flat()},mergeSets:function(e){return new Set(Mr(e))},mergeMaps:function(e){return new Map(Mr(e))},mergeOthers:function(e){return e.at(-1)}};function Hr(...e){return function(e,t){const n=function(e,t){var n,a,r;return{defaultMergeFunctions:qr,mergeFunctions:Er({},qr,Object.fromEntries(Object.entries(e).filter((([e,t])=>Object.hasOwn(qr,e))).map((([e,t])=>!1===t?[e,qr.mergeOthers]:[e,t])))),metaDataUpdater:null!=(n=e.metaDataUpdater)?n:Or,deepmerge:t,useImplicitDefaultMerging:null!=(a=e.enableImplicitDefaultMerging)&&a,filterValues:!1===e.filterValues?void 0:null!=(r=e.filterValues)?r:Vr,actions:Lr}}(e,a);function a(...e){return Br(e,n,t)}return a}({})(...e)}function Br(e,t,n){var a;const r=null!=(a=null==t.filterValues?void 0:t.filterValues(e,n))?a:e;if(0===r.length)return;if(1===r.length)return $r(r,t,n);const o=zr(r[0]);if(0!==o&&5!==o)for(let i=1;i<r.length;i++)if(zr(r[i])!==o)return $r(r,t,n);switch(o){case 1:return function(e,t,n){const a=t.mergeFunctions.mergeRecords(e,t,n);if(a===Lr.defaultMerge||t.useImplicitDefaultMerging&&void 0===a&&t.mergeFunctions.mergeRecords!==t.defaultMergeFunctions.mergeRecords)return t.defaultMergeFunctions.mergeRecords(e,t,n);return a}(r,t,n);case 2:return function(e,t,n){const a=t.mergeFunctions.mergeArrays(e,t,n);if(a===Lr.defaultMerge||t.useImplicitDefaultMerging&&void 0===a&&t.mergeFunctions.mergeArrays!==t.defaultMergeFunctions.mergeArrays)return t.defaultMergeFunctions.mergeArrays(e);return a}(r,t,n);case 3:return function(e,t,n){const a=t.mergeFunctions.mergeSets(e,t,n);if(a===Lr.defaultMerge||t.useImplicitDefaultMerging&&void 0===a&&t.mergeFunctions.mergeSets!==t.defaultMergeFunctions.mergeSets)return t.defaultMergeFunctions.mergeSets(e);return a}(r,t,n);case 4:return function(e,t,n){const a=t.mergeFunctions.mergeMaps(e,t,n);if(a===Lr.defaultMerge||t.useImplicitDefaultMerging&&void 0===a&&t.mergeFunctions.mergeMaps!==t.defaultMergeFunctions.mergeMaps)return t.defaultMergeFunctions.mergeMaps(e);return a}(r,t,n);default:return $r(r,t,n)}}function $r(e,t,n){const a=t.mergeFunctions.mergeOthers(e,t,n);return a===Lr.defaultMerge||t.useImplicitDefaultMerging&&void 0===a&&t.mergeFunctions.mergeOthers!==t.defaultMergeFunctions.mergeOthers?t.defaultMergeFunctions.mergeOthers(e):a}function jr(e){const t=Object.getOwnPropertyNames(e.constructor.prototype);for(let n=0;n<t.length;n++){const a=t[n],r=e[a];"constructor"!==a&&"function"==typeof r&&(e[a]=r.bind(e))}return e}function Gr(e){const{event:t,selector:n}=e.options.advanceOn||{};if(t){const a=function(e,t){return n=>{if(e.isOpen()){const a=e.el&&n.currentTarget===e.el;(!Ir(t)&&n.currentTarget.matches(t)||a)&&e.tour.next()}}}(e,n);let r=null;if(!Ir(n)&&(r=document.querySelector(n),!r))return;r?(r.addEventListener(t,a),e.on("destroy",(()=>r.removeEventListener(t,a)))):(document.body.addEventListener(t,a,!0),e.on("destroy",(()=>document.body.removeEventListener(t,a,!0))))}}function Jr(e){return Ar(e)&&""!==e?"-"!==e.charAt(e.length-1)?`${e}-`:e:""}function Kr(e){return null==e||(!e.element||!e.on)}function Wr(){let e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)}))}const Qr=["start","end"],Zr=["top","right","bottom","left"].reduce(((e,t)=>e.concat(t,t+"-"+Qr[0],t+"-"+Qr[1])),[]),Yr=Math.min,Xr=Math.max,eo=Math.round,to=Math.floor,no=e=>({x:e,y:e}),ao={left:"right",right:"left",bottom:"top",top:"bottom"},ro={start:"end",end:"start"};function oo(e,t,n){return Xr(e,Yr(t,n))}function io(e,t){return"function"==typeof e?e(t):e}function lo(e){return e.split("-")[0]}function so(e){return e.split("-")[1]}function co(e){return"x"===e?"y":"x"}function uo(e){return"y"===e?"height":"width"}function po(e){return["top","bottom"].includes(lo(e))?"y":"x"}function fo(e){return co(po(e))}function ho(e,t,n){void 0===n&&(n=!1);const a=so(e),r=fo(e),o=uo(r);let i="x"===r?a===(n?"end":"start")?"right":"left":"start"===a?"bottom":"top";return t.reference[o]>t.floating[o]&&(i=go(i)),[i,go(i)]}function mo(e){return e.replace(/start|end/g,(e=>ro[e]))}function go(e){return e.replace(/left|right|bottom|top/g,(e=>ao[e]))}function yo(e){return"number"!=typeof e?function(e){return Er({top:0,right:0,bottom:0,left:0},e)}(e):{top:e,right:e,bottom:e,left:e}}function bo(e){const{x:t,y:n,width:a,height:r}=e;return{width:a,height:r,top:n,left:t,right:t+a,bottom:n+r,x:t,y:n}}const vo=["crossAxis","alignment","allowedPlacements","autoAlignment"],wo=["mainAxis","crossAxis","fallbackPlacements","fallbackStrategy","fallbackAxisSideDirection","flipAlignment"],Do=["mainAxis","crossAxis","limiter"];function xo(e,t,n){let{reference:a,floating:r}=e;const o=po(t),i=fo(t),l=uo(i),s=lo(t),d="y"===o,c=a.x+a.width/2-r.width/2,u=a.y+a.height/2-r.height/2,p=a[l]/2-r[l]/2;let f;switch(s){case"top":f={x:c,y:a.y-r.height};break;case"bottom":f={x:c,y:a.y+a.height};break;case"right":f={x:a.x+a.width,y:u};break;case"left":f={x:a.x-r.width,y:u};break;default:f={x:a.x,y:a.y}}switch(so(t)){case"start":f[i]-=p*(n&&d?-1:1);break;case"end":f[i]+=p*(n&&d?-1:1)}return f}async function So(e,t){var n;void 0===t&&(t={});const{x:a,y:r,platform:o,rects:i,elements:l,strategy:s}=e,{boundary:d="clippingAncestors",rootBoundary:c="viewport",elementContext:u="floating",altBoundary:p=!1,padding:f=0}=io(t,e),h=yo(f),m=l[p?"floating"===u?"reference":"floating":u],g=bo(await o.getClippingRect({element:null==(n=await(null==o.isElement?void 0:o.isElement(m)))||n?m:m.contextElement||await(null==o.getDocumentElement?void 0:o.getDocumentElement(l.floating)),boundary:d,rootBoundary:c,strategy:s})),y="floating"===u?{x:a,y:r,width:i.floating.width,height:i.floating.height}:i.reference,b=await(null==o.getOffsetParent?void 0:o.getOffsetParent(l.floating)),v=await(null==o.isElement?void 0:o.isElement(b))&&await(null==o.getScale?void 0:o.getScale(b))||{x:1,y:1},w=bo(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:y,offsetParent:b,strategy:s}):y);return{top:(g.top-w.top+h.top)/v.y,bottom:(w.bottom-g.bottom+h.bottom)/v.y,left:(g.left-w.left+h.left)/v.x,right:(w.right-g.right+h.right)/v.x}}function Po(){return"undefined"!=typeof window}function ko(e){return Ao(e)?(e.nodeName||"").toLowerCase():"#document"}function _o(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function Co(e){var t;return null==(t=(Ao(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function Ao(e){return!!Po()&&(e instanceof Node||e instanceof _o(e).Node)}function Io(e){return!!Po()&&(e instanceof Element||e instanceof _o(e).Element)}function Fo(e){return!!Po()&&(e instanceof HTMLElement||e instanceof _o(e).HTMLElement)}function Eo(e){return!(!Po()||"undefined"==typeof ShadowRoot)&&(e instanceof ShadowRoot||e instanceof _o(e).ShadowRoot)}function No(e){const{overflow:t,overflowX:n,overflowY:a,display:r}=zo(e);return/auto|scroll|overlay|hidden|clip/.test(t+a+n)&&!["inline","contents"].includes(r)}function Lo(e){return["table","td","th"].includes(ko(e))}function Oo(e){return[":popover-open",":modal"].some((t=>{try{return e.matches(t)}catch(n){return!1}}))}function Vo(e){const t=To(),n=Io(e)?zo(e):e;return"none"!==n.transform||"none"!==n.perspective||!!n.containerType&&"normal"!==n.containerType||!t&&!!n.backdropFilter&&"none"!==n.backdropFilter||!t&&!!n.filter&&"none"!==n.filter||["transform","perspective","filter"].some((e=>(n.willChange||"").includes(e)))||["paint","layout","strict","content"].some((e=>(n.contain||"").includes(e)))}function To(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function Ro(e){return["html","body","#document"].includes(ko(e))}function zo(e){return _o(e).getComputedStyle(e)}function Mo(e){return Io(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Uo(e){if("html"===ko(e))return e;const t=e.assignedSlot||e.parentNode||Eo(e)&&e.host||Co(e);return Eo(t)?t.host:t}function qo(e){const t=Uo(e);return Ro(t)?e.ownerDocument?e.ownerDocument.body:e.body:Fo(t)&&No(t)?t:qo(t)}function Ho(e,t,n){var a;void 0===t&&(t=[]),void 0===n&&(n=!0);const r=qo(e),o=r===(null==(a=e.ownerDocument)?void 0:a.body),i=_o(r);if(o){const e=Bo(i);return t.concat(i,i.visualViewport||[],No(r)?r:[],e&&n?Ho(e):[])}return t.concat(r,Ho(r,[],n))}function Bo(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function $o(e){const t=zo(e);let n=parseFloat(t.width)||0,a=parseFloat(t.height)||0;const r=Fo(e),o=r?e.offsetWidth:n,i=r?e.offsetHeight:a,l=eo(n)!==o||eo(a)!==i;return l&&(n=o,a=i),{width:n,height:a,$:l}}function jo(e){return Io(e)?e:e.contextElement}function Go(e){const t=jo(e);if(!Fo(t))return no(1);const n=t.getBoundingClientRect(),{width:a,height:r,$:o}=$o(t);let i=(o?eo(n.width):n.width)/a,l=(o?eo(n.height):n.height)/r;return i&&Number.isFinite(i)||(i=1),l&&Number.isFinite(l)||(l=1),{x:i,y:l}}const Jo=no(0);function Ko(e){const t=_o(e);return To()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:Jo}function Wo(e,t,n,a){void 0===t&&(t=!1),void 0===n&&(n=!1);const r=e.getBoundingClientRect(),o=jo(e);let i=no(1);t&&(a?Io(a)&&(i=Go(a)):i=Go(e));const l=function(e,t,n){return void 0===t&&(t=!1),!(!n||t&&n!==_o(e))&&t}(o,n,a)?Ko(o):no(0);let s=(r.left+l.x)/i.x,d=(r.top+l.y)/i.y,c=r.width/i.x,u=r.height/i.y;if(o){const e=_o(o),t=a&&Io(a)?_o(a):a;let n=e,r=Bo(n);for(;r&&a&&t!==n;){const e=Go(r),t=r.getBoundingClientRect(),a=zo(r),o=t.left+(r.clientLeft+parseFloat(a.paddingLeft))*e.x,i=t.top+(r.clientTop+parseFloat(a.paddingTop))*e.y;s*=e.x,d*=e.y,c*=e.x,u*=e.y,s+=o,d+=i,n=_o(r),r=Bo(n)}}return bo({width:c,height:u,x:s,y:d})}function Qo(e,t){const n=Mo(e).scrollLeft;return t?t.left+n:Wo(Co(e)).left+n}function Zo(e,t,n){void 0===n&&(n=!1);const a=e.getBoundingClientRect();return{x:a.left+t.scrollLeft-(n?0:Qo(e,a)),y:a.top+t.scrollTop}}function Yo(e,t,n){let a;if("viewport"===t)a=function(e,t){const n=_o(e),a=Co(e),r=n.visualViewport;let o=a.clientWidth,i=a.clientHeight,l=0,s=0;if(r){o=r.width,i=r.height;const e=To();(!e||e&&"fixed"===t)&&(l=r.offsetLeft,s=r.offsetTop)}return{width:o,height:i,x:l,y:s}}(e,n);else if("document"===t)a=function(e){const t=Co(e),n=Mo(e),a=e.ownerDocument.body,r=Xr(t.scrollWidth,t.clientWidth,a.scrollWidth,a.clientWidth),o=Xr(t.scrollHeight,t.clientHeight,a.scrollHeight,a.clientHeight);let i=-n.scrollLeft+Qo(e);const l=-n.scrollTop;return"rtl"===zo(a).direction&&(i+=Xr(t.clientWidth,a.clientWidth)-r),{width:r,height:o,x:i,y:l}}(Co(e));else if(Io(t))a=function(e,t){const n=Wo(e,!0,"fixed"===t),a=n.top+e.clientTop,r=n.left+e.clientLeft,o=Fo(e)?Go(e):no(1);return{width:e.clientWidth*o.x,height:e.clientHeight*o.y,x:r*o.x,y:a*o.y}}(t,n);else{const n=Ko(e);a={x:t.x-n.x,y:t.y-n.y,width:t.width,height:t.height}}return bo(a)}function Xo(e,t){const n=Uo(e);return!(n===t||!Io(n)||Ro(n))&&("fixed"===zo(n).position||Xo(n,t))}function ei(e,t,n){const a=Fo(t),r=Co(t),o="fixed"===n,i=Wo(e,!0,o,t);let l={scrollLeft:0,scrollTop:0};const s=no(0);if(a||!a&&!o)if(("body"!==ko(t)||No(r))&&(l=Mo(t)),a){const e=Wo(t,!0,o,t);s.x=e.x+t.clientLeft,s.y=e.y+t.clientTop}else r&&(s.x=Qo(r));const d=!r||a||o?no(0):Zo(r,l);return{x:i.left+l.scrollLeft-s.x-d.x,y:i.top+l.scrollTop-s.y-d.y,width:i.width,height:i.height}}function ti(e){return"static"===zo(e).position}function ni(e,t){if(!Fo(e)||"fixed"===zo(e).position)return null;if(t)return t(e);let n=e.offsetParent;return Co(e)===n&&(n=n.ownerDocument.body),n}function ai(e,t){const n=_o(e);if(Oo(e))return n;if(!Fo(e)){let t=Uo(e);for(;t&&!Ro(t);){if(Io(t)&&!ti(t))return t;t=Uo(t)}return n}let a=ni(e,t);for(;a&&Lo(a)&&ti(a);)a=ni(a,t);return a&&Ro(a)&&ti(a)&&!Vo(a)?n:a||function(e){let t=Uo(e);for(;Fo(t)&&!Ro(t);){if(Vo(t))return t;if(Oo(t))return null;t=Uo(t)}return null}(e)||n}const ri={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{elements:t,rect:n,offsetParent:a,strategy:r}=e;const o="fixed"===r,i=Co(a),l=!!t&&Oo(t.floating);if(a===i||l&&o)return n;let s={scrollLeft:0,scrollTop:0},d=no(1);const c=no(0),u=Fo(a);if((u||!u&&!o)&&(("body"!==ko(a)||No(i))&&(s=Mo(a)),Fo(a))){const e=Wo(a);d=Go(a),c.x=e.x+a.clientLeft,c.y=e.y+a.clientTop}const p=!i||u||o?no(0):Zo(i,s,!0);return{width:n.width*d.x,height:n.height*d.y,x:n.x*d.x-s.scrollLeft*d.x+c.x+p.x,y:n.y*d.y-s.scrollTop*d.y+c.y+p.y}},getDocumentElement:Co,getClippingRect:function(e){let{element:t,boundary:n,rootBoundary:a,strategy:r}=e;const o=[..."clippingAncestors"===n?Oo(t)?[]:function(e,t){const n=t.get(e);if(n)return n;let a=Ho(e,[],!1).filter((e=>Io(e)&&"body"!==ko(e))),r=null;const o="fixed"===zo(e).position;let i=o?Uo(e):e;for(;Io(i)&&!Ro(i);){const t=zo(i),n=Vo(i);n||"fixed"!==t.position||(r=null),(o?!n&&!r:!n&&"static"===t.position&&r&&["absolute","fixed"].includes(r.position)||No(i)&&!n&&Xo(e,i))?a=a.filter((e=>e!==i)):r=t,i=Uo(i)}return t.set(e,a),a}(t,this._c):[].concat(n),a],i=o[0],l=o.reduce(((e,n)=>{const a=Yo(t,n,r);return e.top=Xr(a.top,e.top),e.right=Yr(a.right,e.right),e.bottom=Yr(a.bottom,e.bottom),e.left=Xr(a.left,e.left),e}),Yo(t,i,r));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}},getOffsetParent:ai,getElementRects:async function(e){const t=this.getOffsetParent||ai,n=this.getDimensions,a=await n(e.floating);return{reference:ei(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:a.width,height:a.height}}},getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){const{width:t,height:n}=$o(e);return{width:t,height:n}},getScale:Go,isElement:Io,isRTL:function(e){return"rtl"===zo(e).direction}};function oi(e,t,n,a){void 0===a&&(a={});const{ancestorScroll:r=!0,ancestorResize:o=!0,elementResize:i="function"==typeof ResizeObserver,layoutShift:l="function"==typeof IntersectionObserver,animationFrame:s=!1}=a,d=jo(e),c=r||o?[...d?Ho(d):[],...Ho(t)]:[];c.forEach((e=>{r&&e.addEventListener("scroll",n,{passive:!0}),o&&e.addEventListener("resize",n)}));const u=d&&l?function(e,t){let n,a=null;const r=Co(e);function o(){var e;clearTimeout(n),null==(e=a)||e.disconnect(),a=null}return function i(l,s){void 0===l&&(l=!1),void 0===s&&(s=1),o();const{left:d,top:c,width:u,height:p}=e.getBoundingClientRect();if(l||t(),!u||!p)return;const f={rootMargin:-to(c)+"px "+-to(r.clientWidth-(d+u))+"px "+-to(r.clientHeight-(c+p))+"px "+-to(d)+"px",threshold:Xr(0,Yr(1,s))||1};let h=!0;function m(e){const t=e[0].intersectionRatio;if(t!==s){if(!h)return i();t?i(!1,t):n=setTimeout((()=>{i(!1,1e-7)}),1e3)}h=!1}try{a=new IntersectionObserver(m,Er({},f,{root:r.ownerDocument}))}catch(g){a=new IntersectionObserver(m,f)}a.observe(e)}(!0),o}(d,n):null;let p,f=-1,h=null;i&&(h=new ResizeObserver((e=>{let[a]=e;a&&a.target===d&&h&&(h.unobserve(t),cancelAnimationFrame(f),f=requestAnimationFrame((()=>{var e;null==(e=h)||e.observe(t)}))),n()})),d&&!s&&h.observe(d),h.observe(t));let m=s?Wo(e):null;return s&&function t(){const a=Wo(e);!m||a.x===m.x&&a.y===m.y&&a.width===m.width&&a.height===m.height||n();m=a,p=requestAnimationFrame(t)}(),n(),()=>{var e;c.forEach((e=>{r&&e.removeEventListener("scroll",n),o&&e.removeEventListener("resize",n)})),null==u||u(),null==(e=h)||e.disconnect(),h=null,s&&cancelAnimationFrame(p)}}const ii=function(e){return void 0===e&&(e={}),{name:"autoPlacement",options:e,async fn(t){var n,a,r;const{rects:o,middlewareData:i,placement:l,platform:s,elements:d}=t,c=io(e,t),{crossAxis:u=!1,alignment:p,allowedPlacements:f=Zr,autoAlignment:h=!0}=c,m=Nr(c,vo),g=void 0!==p||f===Zr?function(e,t,n){return(e?[...n.filter((t=>so(t)===e)),...n.filter((t=>so(t)!==e))]:n.filter((e=>lo(e)===e))).filter((n=>!e||so(n)===e||!!t&&mo(n)!==n))}(p||null,h,f):f,y=await So(t,m),b=(null==(n=i.autoPlacement)?void 0:n.index)||0,v=g[b];if(null==v)return{};const w=ho(v,o,await(null==s.isRTL?void 0:s.isRTL(d.floating)));if(l!==v)return{reset:{placement:g[0]}};const D=[y[lo(v)],y[w[0]],y[w[1]]],x=[...(null==(a=i.autoPlacement)?void 0:a.overflows)||[],{placement:v,overflows:D}],S=g[b+1];if(S)return{data:{index:b+1,overflows:x},reset:{placement:S}};const P=x.map((e=>{const t=so(e.placement);return[e.placement,t&&u?e.overflows.slice(0,2).reduce(((e,t)=>e+t),0):e.overflows[0],e.overflows]})).sort(((e,t)=>e[1]-t[1])),k=(null==(r=P.filter((e=>e[2].slice(0,so(e[0])?2:3).every((e=>e<=0))))[0])?void 0:r[0])||P[0][0];return k!==l?{data:{index:b+1,overflows:x},reset:{placement:k}}:{}}}},li=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:a,placement:r}=t,o=io(e,t),{mainAxis:i=!0,crossAxis:l=!1,limiter:s={fn:e=>{let{x:t,y:n}=e;return{x:t,y:n}}}}=o,d=Nr(o,Do),c={x:n,y:a},u=await So(t,d),p=po(lo(r)),f=co(p);let h=c[f],m=c[p];if(i){const e="y"===f?"bottom":"right";h=oo(h+u["y"===f?"top":"left"],h,h-u[e])}if(l){const e="y"===p?"bottom":"right";m=oo(m+u["y"===p?"top":"left"],m,m-u[e])}const g=s.fn(Er({},t,{[f]:h,[p]:m}));return Er({},g,{data:{x:g.x-n,y:g.y-a}})}}},si=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var n,a;const{placement:r,middlewareData:o,rects:i,initialPlacement:l,platform:s,elements:d}=t,c=io(e,t),{mainAxis:u=!0,crossAxis:p=!0,fallbackPlacements:f,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:g=!0}=c,y=Nr(c,wo);if(null!=(n=o.arrow)&&n.alignmentOffset)return{};const b=lo(r),v=po(l),w=lo(l)===l,D=await(null==s.isRTL?void 0:s.isRTL(d.floating)),x=f||(w||!g?[go(l)]:function(e){const t=go(e);return[mo(e),t,mo(t)]}(l)),S="none"!==m;!f&&S&&x.push(...function(e,t,n,a){const r=so(e);let o=function(e,t,n){const a=["left","right"],r=["right","left"],o=["top","bottom"],i=["bottom","top"];switch(e){case"top":case"bottom":return n?t?r:a:t?a:r;case"left":case"right":return t?o:i;default:return[]}}(lo(e),"start"===n,a);return r&&(o=o.map((e=>e+"-"+r)),t&&(o=o.concat(o.map(mo)))),o}(l,g,m,D));const P=[l,...x],k=await So(t,y),_=[];let C=(null==(a=o.flip)?void 0:a.overflows)||[];if(u&&_.push(k[b]),p){const e=ho(r,i,D);_.push(k[e[0]],k[e[1]])}if(C=[...C,{placement:r,overflows:_}],!_.every((e=>e<=0))){var A,I;const e=((null==(A=o.flip)?void 0:A.index)||0)+1,t=P[e];if(t)return{data:{index:e,overflows:C},reset:{placement:t}};let n=null==(I=C.filter((e=>e.overflows[0]<=0)).sort(((e,t)=>e.overflows[1]-t.overflows[1]))[0])?void 0:I.placement;if(!n)switch(h){case"bestFit":{var F;const e=null==(F=C.filter((e=>{if(S){const t=po(e.placement);return t===v||"y"===t}return!0})).map((e=>[e.placement,e.overflows.filter((e=>e>0)).reduce(((e,t)=>e+t),0)])).sort(((e,t)=>e[1]-t[1]))[0])?void 0:F[0];e&&(n=e);break}case"initialPlacement":n=l}if(r!==n)return{reset:{placement:n}}}return{}}}},di=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:a,placement:r,rects:o,platform:i,elements:l,middlewareData:s}=t,{element:d,padding:c=0}=io(e,t)||{};if(null==d)return{};const u=yo(c),p={x:n,y:a},f=fo(r),h=uo(f),m=await i.getDimensions(d),g="y"===f,y=g?"top":"left",b=g?"bottom":"right",v=g?"clientHeight":"clientWidth",w=o.reference[h]+o.reference[f]-p[f]-o.floating[h],D=p[f]-o.reference[f],x=await(null==i.getOffsetParent?void 0:i.getOffsetParent(d));let S=x?x[v]:0;S&&await(null==i.isElement?void 0:i.isElement(x))||(S=l.floating[v]||o.floating[h]);const P=w/2-D/2,k=S/2-m[h]/2-1,_=Yr(u[y],k),C=Yr(u[b],k),A=_,I=S-m[h]-C,F=S/2-m[h]/2+P,E=oo(A,F,I),N=!s.arrow&&null!=so(r)&&F!==E&&o.reference[h]/2-(F<A?_:C)-m[h]/2<0,L=N?F<A?F-A:F-I:0;return{[f]:p[f]+L,data:Er({[f]:E,centerOffset:F-E-L},N&&{alignmentOffset:L}),reset:N}}}),ci=function(e){return void 0===e&&(e={}),{options:e,fn(t){const{x:n,y:a,placement:r,rects:o,middlewareData:i}=t,{offset:l=0,mainAxis:s=!0,crossAxis:d=!0}=io(e,t),c={x:n,y:a},u=po(r),p=co(u);let f=c[p],h=c[u];const m=io(l,t),g="number"==typeof m?{mainAxis:m,crossAxis:0}:Er({mainAxis:0,crossAxis:0},m);if(s){const e="y"===p?"height":"width",t=o.reference[p]-o.floating[e]+g.mainAxis,n=o.reference[p]+o.reference[e]-g.mainAxis;f<t?f=t:f>n&&(f=n)}if(d){var y,b;const e="y"===p?"width":"height",t=["top","left"].includes(lo(r)),n=o.reference[u]-o.floating[e]+(t&&(null==(y=i.offset)?void 0:y[u])||0)+(t?0:g.crossAxis),a=o.reference[u]+o.reference[e]+(t?0:(null==(b=i.offset)?void 0:b[u])||0)-(t?g.crossAxis:0);h<n?h=n:h>a&&(h=a)}return{[p]:f,[u]:h}}}},ui=(e,t,n)=>{const a=new Map,r=Er({platform:ri},n),o=Er({},r.platform,{_c:a});return(async(e,t,n)=>{const{placement:a="bottom",strategy:r="absolute",middleware:o=[],platform:i}=n,l=o.filter(Boolean),s=await(null==i.isRTL?void 0:i.isRTL(t));let d=await i.getElementRects({reference:e,floating:t,strategy:r}),{x:c,y:u}=xo(d,a,s),p=a,f={},h=0;for(let m=0;m<l.length;m++){const{name:n,fn:o}=l[m],{x:g,y:y,data:b,reset:v}=await o({x:c,y:u,initialPlacement:a,placement:p,strategy:r,middlewareData:f,rects:d,platform:i,elements:{reference:e,floating:t}});c=null!=g?g:c,u=null!=y?y:u,f=Er({},f,{[n]:Er({},f[n],b)}),v&&h<=50&&(h++,"object"==typeof v&&(v.placement&&(p=v.placement),v.rects&&(d=!0===v.rects?await i.getElementRects({reference:e,floating:t,strategy:r}):v.rects),({x:c,y:u}=xo(d,p,s))),m=-1)}return{x:c,y:u,placement:p,strategy:r,middlewareData:f}})(e,t,Er({},r,{platform:o}))};function pi(e){e.cleanup&&e.cleanup();const t=e._getResolvedAttachToOptions();let n=t.element;const a=function(e,t){var n,a,r;const o={strategy:"absolute",middleware:[]},i=function(e){if(e.options.arrow&&e.el)return e.el.querySelector(".shepherd-arrow");return!1}(t),l=Kr(e),s=null==(n=e.on)?void 0:n.includes("auto"),d=(null==e||null==(a=e.on)?void 0:a.includes("-start"))||(null==e||null==(r=e.on)?void 0:r.includes("-end"));if(!l){var c;if(s)o.middleware.push(ii({crossAxis:!0,alignment:d?null==e||null==(c=e.on)?void 0:c.split("-").pop():null}));else o.middleware.push(si());if(o.middleware.push(li({limiter:ci(),crossAxis:!0})),i){const e="object"==typeof t.options.arrow?t.options.arrow:{padding:4};o.middleware.push(di({element:i,padding:d?e.padding:0}))}s||(o.placement=e.on)}return Hr(o,t.options.floatingUIOptions||{})}(t,e),r=Kr(t);if(r){n=document.body;e.shepherdElementComponent.getElement().classList.add("shepherd-centered")}return e.cleanup=oi(n,e.el,(()=>{e.el?function(e,t,n,a){ui(e,t.el,n).then(function(e,t){return({x:n,y:a,placement:r,middlewareData:o})=>e.el?(t?Object.assign(e.el.style,{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}):Object.assign(e.el.style,{position:"absolute",left:`${n}px`,top:`${a}px`}),e.el.dataset.popperPlacement=r,function(e,t){const n=e.querySelector(".shepherd-arrow");if(_r(n)&&t.arrow){const{x:e,y:a}=t.arrow;Object.assign(n.style,{left:null!=e?`${e}px`:"",top:null!=a?`${a}px`:""})}}(e.el,o),e):e}(t,a)).then((e=>new Promise((t=>{setTimeout((()=>t(e)),300)})))).then((e=>{null!=e&&e.el&&e.el.focus({preventScroll:!0})}))}(n,e,a,r):null==e.cleanup||e.cleanup()})),e.target=t.element,a}function fi(){}function hi(e,t){for(const n in t)e[n]=t[n];return e}function mi(e){return e()}function gi(){return Object.create(null)}function yi(e){e.forEach(mi)}function bi(e){return"function"==typeof e}function vi(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function wi(e,t){e.appendChild(t)}function Di(e,t,n){e.insertBefore(t,n||null)}function xi(e){e.parentNode&&e.parentNode.removeChild(e)}function Si(e){return document.createElement(e)}function Pi(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function ki(e){return document.createTextNode(e)}function _i(){return ki(" ")}function Ci(e,t,n,a){return e.addEventListener(t,n,a),()=>e.removeEventListener(t,n,a)}function Ai(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}const Ii=["width","height"];function Fi(e,t){const n=Object.getOwnPropertyDescriptors(e.__proto__);for(const a in t)null==t[a]?e.removeAttribute(a):"style"===a?e.style.cssText=t[a]:"__value"===a?e.value=e[a]=t[a]:n[a]&&n[a].set&&-1===Ii.indexOf(a)?e[a]=t[a]:Ai(e,a,t[a])}function Ei(e,t,n){e.classList.toggle(t,!!n)}let Ni;function Li(e){Ni=e}function Oi(){if(!Ni)throw new Error("Function called outside component initialization");return Ni}function Vi(e){Oi().$$.after_update.push(e)}const Ti=[],Ri=[];let zi=[];const Mi=[],Ui=Promise.resolve();let qi=!1;function Hi(e){zi.push(e)}const Bi=new Set;let $i=0;function ji(){if(0!==$i)return;const e=Ni;do{try{for(;$i<Ti.length;){const e=Ti[$i];$i++,Li(e),Gi(e.$$)}}catch(t){throw Ti.length=0,$i=0,t}for(Li(null),Ti.length=0,$i=0;Ri.length;)Ri.pop()();for(let e=0;e<zi.length;e+=1){const t=zi[e];Bi.has(t)||(Bi.add(t),t())}zi.length=0}while(Ti.length);for(;Mi.length;)Mi.pop()();qi=!1,Bi.clear(),Li(e)}function Gi(e){if(null!==e.fragment){e.update(),yi(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Hi)}}const Ji=new Set;let Ki;function Wi(){Ki={r:0,c:[],p:Ki}}function Qi(){Ki.r||yi(Ki.c),Ki=Ki.p}function Zi(e,t){e&&e.i&&(Ji.delete(e),e.i(t))}function Yi(e,t,n,a){if(e&&e.o){if(Ji.has(e))return;Ji.add(e),Ki.c.push((()=>{Ji.delete(e),a&&(n&&e.d(1),a())})),e.o(t)}else a&&a()}function Xi(e){return void 0!==(null==e?void 0:e.length)?e:Array.from(e)}function el(e){e&&e.c()}function tl(e,t,n){const{fragment:a,after_update:r}=e.$$;a&&a.m(t,n),Hi((()=>{const t=e.$$.on_mount.map(mi).filter(bi);e.$$.on_destroy?e.$$.on_destroy.push(...t):yi(t),e.$$.on_mount=[]})),r.forEach(Hi)}function nl(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];zi.forEach((a=>-1===e.indexOf(a)?t.push(a):n.push(a))),n.forEach((e=>e())),zi=t}(n.after_update),yi(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function al(e,t){-1===e.$$.dirty[0]&&(Ti.push(e),qi||(qi=!0,Ui.then(ji)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function rl(e,t,n,a,r,o,i=null,l=[-1]){const s=Ni;Li(e);const d=e.$$={fragment:null,ctx:[],props:o,update:fi,not_equal:r,bound:gi(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(s?s.$$.context:[])),callbacks:gi(),dirty:l,skip_bound:!1,root:t.target||s.$$.root};i&&i(d.root);let c=!1;if(d.ctx=n?n(e,t.props||{},((t,n,...a)=>{const o=a.length?a[0]:n;return d.ctx&&r(d.ctx[t],d.ctx[t]=o)&&(!d.skip_bound&&d.bound[t]&&d.bound[t](o),c&&al(e,t)),n})):[],d.update(),c=!0,yi(d.before_update),d.fragment=!!a&&a(d.ctx),t.target){if(t.hydrate){const e=(u=t.target,Array.from(u.childNodes));d.fragment&&d.fragment.l(e),e.forEach(xi)}else d.fragment&&d.fragment.c();t.intro&&Zi(e.$$.fragment),tl(e,t.target,t.anchor),ji()}var u;Li(s)}class ol{constructor(){this.$$=void 0,this.$$set=void 0}$destroy(){nl(this,1),this.$destroy=fi}$on(e,t){if(!bi(t))return fi;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function il(e){let t,n,a,r,o;return{c(){t=Si("button"),Ai(t,"aria-label",n=e[3]?e[3]:null),Ai(t,"class",a=`${e[1]||""} shepherd-button ${e[4]?"shepherd-button-secondary":""}`),t.disabled=e[2],Ai(t,"tabindex","0"),Ai(t,"type","button")},m(n,a){Di(n,t,a),t.innerHTML=e[5],r||(o=Ci(t,"click",(function(){bi(e[0])&&e[0].apply(this,arguments)})),r=!0)},p(r,[o]){e=r,32&o&&(t.innerHTML=e[5]),8&o&&n!==(n=e[3]?e[3]:null)&&Ai(t,"aria-label",n),18&o&&a!==(a=`${e[1]||""} shepherd-button ${e[4]?"shepherd-button-secondary":""}`)&&Ai(t,"class",a),4&o&&(t.disabled=e[2])},i:fi,o:fi,d(e){e&&xi(t),r=!1,o()}}}function ll(e,t,n){let a,r,o,i,l,s,{config:d,step:c}=t;function u(e){return Cr(e)?e.call(c):e}return e.$$set=e=>{"config"in e&&n(6,d=e.config),"step"in e&&n(7,c=e.step)},e.$$.update=()=>{192&e.$$.dirty&&(n(0,a=d.action?d.action.bind(c.tour):null),n(1,r=d.classes),n(2,o=!!d.disabled&&u(d.disabled)),n(3,i=d.label?u(d.label):null),n(4,l=d.secondary),n(5,s=d.text?u(d.text):null))},[a,r,o,i,l,s,d,c]}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");class sl extends ol{constructor(e){super(),rl(this,e,ll,il,vi,{config:6,step:7})}}function dl(e,t,n){const a=e.slice();return a[2]=t[n],a}function cl(e){let t,n,a=Xi(e[1]),r=[];for(let i=0;i<a.length;i+=1)r[i]=ul(dl(e,a,i));const o=e=>Yi(r[e],1,1,(()=>{r[e]=null}));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=ki("")},m(e,a){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,a);Di(e,t,a),n=!0},p(e,n){if(3&n){let i;for(a=Xi(e[1]),i=0;i<a.length;i+=1){const o=dl(e,a,i);r[i]?(r[i].p(o,n),Zi(r[i],1)):(r[i]=ul(o),r[i].c(),Zi(r[i],1),r[i].m(t.parentNode,t))}for(Wi(),i=a.length;i<r.length;i+=1)o(i);Qi()}},i(e){if(!n){for(let e=0;e<a.length;e+=1)Zi(r[e]);n=!0}},o(e){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)Yi(r[t]);n=!1},d(e){e&&xi(t),function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(r,e)}}}function ul(e){let t,n;return t=new sl({props:{config:e[2],step:e[0]}}),{c(){el(t.$$.fragment)},m(e,a){tl(t,e,a),n=!0},p(e,n){const a={};2&n&&(a.config=e[2]),1&n&&(a.step=e[0]),t.$set(a)},i(e){n||(Zi(t.$$.fragment,e),n=!0)},o(e){Yi(t.$$.fragment,e),n=!1},d(e){nl(t,e)}}}function pl(e){let t,n,a=e[1]&&cl(e);return{c(){t=Si("footer"),a&&a.c(),Ai(t,"class","shepherd-footer")},m(e,r){Di(e,t,r),a&&a.m(t,null),n=!0},p(e,[n]){e[1]?a?(a.p(e,n),2&n&&Zi(a,1)):(a=cl(e),a.c(),Zi(a,1),a.m(t,null)):a&&(Wi(),Yi(a,1,1,(()=>{a=null})),Qi())},i(e){n||(Zi(a),n=!0)},o(e){Yi(a),n=!1},d(e){e&&xi(t),a&&a.d()}}}function fl(e,t,n){let a,{step:r}=t;return e.$$set=e=>{"step"in e&&n(0,r=e.step)},e.$$.update=()=>{1&e.$$.dirty&&n(1,a=r.options.buttons)},[r,a]}class hl extends ol{constructor(e){super(),rl(this,e,fl,pl,vi,{step:0})}}function ml(e){let t,n,a,r,o;return{c(){t=Si("button"),n=Si("span"),n.textContent="×",Ai(n,"aria-hidden","true"),Ai(t,"aria-label",a=e[0].label?e[0].label:"Close Tour"),Ai(t,"class","shepherd-cancel-icon"),Ai(t,"type","button")},m(a,i){Di(a,t,i),wi(t,n),r||(o=Ci(t,"click",e[1]),r=!0)},p(e,[n]){1&n&&a!==(a=e[0].label?e[0].label:"Close Tour")&&Ai(t,"aria-label",a)},i:fi,o:fi,d(e){e&&xi(t),r=!1,o()}}}function gl(e,t,n){let{cancelIcon:a,step:r}=t;return e.$$set=e=>{"cancelIcon"in e&&n(0,a=e.cancelIcon),"step"in e&&n(2,r=e.step)},[a,e=>{e.preventDefault(),r.cancel()},r]}class yl extends ol{constructor(e){super(),rl(this,e,gl,ml,vi,{cancelIcon:0,step:2})}}function bl(e){let t;return{c(){t=Si("h3"),Ai(t,"id",e[1]),Ai(t,"class","shepherd-title")},m(n,a){Di(n,t,a),e[3](t)},p(e,[n]){2&n&&Ai(t,"id",e[1])},i:fi,o:fi,d(n){n&&xi(t),e[3](null)}}}function vl(e,t,n){let{labelId:a,element:r,title:o}=t;return Vi((()=>{Cr(o)&&n(2,o=o()),n(0,r.innerHTML=o,r)})),e.$$set=e=>{"labelId"in e&&n(1,a=e.labelId),"element"in e&&n(0,r=e.element),"title"in e&&n(2,o=e.title)},[r,a,o,function(e){Ri[e?"unshift":"push"]((()=>{r=e,n(0,r)}))}]}class wl extends ol{constructor(e){super(),rl(this,e,vl,bl,vi,{labelId:1,element:0,title:2})}}function Dl(e){let t,n;return t=new wl({props:{labelId:e[0],title:e[2]}}),{c(){el(t.$$.fragment)},m(e,a){tl(t,e,a),n=!0},p(e,n){const a={};1&n&&(a.labelId=e[0]),4&n&&(a.title=e[2]),t.$set(a)},i(e){n||(Zi(t.$$.fragment,e),n=!0)},o(e){Yi(t.$$.fragment,e),n=!1},d(e){nl(t,e)}}}function xl(e){let t,n;return t=new yl({props:{cancelIcon:e[3],step:e[1]}}),{c(){el(t.$$.fragment)},m(e,a){tl(t,e,a),n=!0},p(e,n){const a={};8&n&&(a.cancelIcon=e[3]),2&n&&(a.step=e[1]),t.$set(a)},i(e){n||(Zi(t.$$.fragment,e),n=!0)},o(e){Yi(t.$$.fragment,e),n=!1},d(e){nl(t,e)}}}function Sl(e){let t,n,a,r=e[2]&&Dl(e),o=e[3]&&e[3].enabled&&xl(e);return{c(){t=Si("header"),r&&r.c(),n=_i(),o&&o.c(),Ai(t,"class","shepherd-header")},m(e,i){Di(e,t,i),r&&r.m(t,null),wi(t,n),o&&o.m(t,null),a=!0},p(e,[a]){e[2]?r?(r.p(e,a),4&a&&Zi(r,1)):(r=Dl(e),r.c(),Zi(r,1),r.m(t,n)):r&&(Wi(),Yi(r,1,1,(()=>{r=null})),Qi()),e[3]&&e[3].enabled?o?(o.p(e,a),8&a&&Zi(o,1)):(o=xl(e),o.c(),Zi(o,1),o.m(t,null)):o&&(Wi(),Yi(o,1,1,(()=>{o=null})),Qi())},i(e){a||(Zi(r),Zi(o),a=!0)},o(e){Yi(r),Yi(o),a=!1},d(e){e&&xi(t),r&&r.d(),o&&o.d()}}}function Pl(e,t,n){let a,r,{labelId:o,step:i}=t;return e.$$set=e=>{"labelId"in e&&n(0,o=e.labelId),"step"in e&&n(1,i=e.step)},e.$$.update=()=>{2&e.$$.dirty&&(n(2,a=i.options.title),n(3,r=i.options.cancelIcon))},[o,i,a,r]}class kl extends ol{constructor(e){super(),rl(this,e,Pl,Sl,vi,{labelId:0,step:1})}}function _l(e){let t;return{c(){t=Si("div"),Ai(t,"class","shepherd-text"),Ai(t,"id",e[1])},m(n,a){Di(n,t,a),e[3](t)},p(e,[n]){2&n&&Ai(t,"id",e[1])},i:fi,o:fi,d(n){n&&xi(t),e[3](null)}}}function Cl(e,t,n){let{descriptionId:a,element:r,step:o}=t;return Vi((()=>{let{text:e}=o.options;Cr(e)&&(e=e.call(o)),_r(e)?r.appendChild(e):n(0,r.innerHTML=e,r)})),e.$$set=e=>{"descriptionId"in e&&n(1,a=e.descriptionId),"element"in e&&n(0,r=e.element),"step"in e&&n(2,o=e.step)},[r,a,o,function(e){Ri[e?"unshift":"push"]((()=>{r=e,n(0,r)}))}]}class Al extends ol{constructor(e){super(),rl(this,e,Cl,_l,vi,{descriptionId:1,element:0,step:2})}}function Il(e){let t,n;return t=new kl({props:{labelId:e[1],step:e[2]}}),{c(){el(t.$$.fragment)},m(e,a){tl(t,e,a),n=!0},p(e,n){const a={};2&n&&(a.labelId=e[1]),4&n&&(a.step=e[2]),t.$set(a)},i(e){n||(Zi(t.$$.fragment,e),n=!0)},o(e){Yi(t.$$.fragment,e),n=!1},d(e){nl(t,e)}}}function Fl(e){let t,n;return t=new Al({props:{descriptionId:e[0],step:e[2]}}),{c(){el(t.$$.fragment)},m(e,a){tl(t,e,a),n=!0},p(e,n){const a={};1&n&&(a.descriptionId=e[0]),4&n&&(a.step=e[2]),t.$set(a)},i(e){n||(Zi(t.$$.fragment,e),n=!0)},o(e){Yi(t.$$.fragment,e),n=!1},d(e){nl(t,e)}}}function El(e){let t,n;return t=new hl({props:{step:e[2]}}),{c(){el(t.$$.fragment)},m(e,a){tl(t,e,a),n=!0},p(e,n){const a={};4&n&&(a.step=e[2]),t.$set(a)},i(e){n||(Zi(t.$$.fragment,e),n=!0)},o(e){Yi(t.$$.fragment,e),n=!1},d(e){nl(t,e)}}}function Nl(e){let t,n,a,r,o=!Ir(e[2].options.title)||e[2].options.cancelIcon&&e[2].options.cancelIcon.enabled,i=!Ir(e[2].options.text),l=Array.isArray(e[2].options.buttons)&&e[2].options.buttons.length,s=o&&Il(e),d=i&&Fl(e),c=l&&El(e);return{c(){t=Si("div"),s&&s.c(),n=_i(),d&&d.c(),a=_i(),c&&c.c(),Ai(t,"class","shepherd-content")},m(e,o){Di(e,t,o),s&&s.m(t,null),wi(t,n),d&&d.m(t,null),wi(t,a),c&&c.m(t,null),r=!0},p(e,[r]){4&r&&(o=!Ir(e[2].options.title)||e[2].options.cancelIcon&&e[2].options.cancelIcon.enabled),o?s?(s.p(e,r),4&r&&Zi(s,1)):(s=Il(e),s.c(),Zi(s,1),s.m(t,n)):s&&(Wi(),Yi(s,1,1,(()=>{s=null})),Qi()),4&r&&(i=!Ir(e[2].options.text)),i?d?(d.p(e,r),4&r&&Zi(d,1)):(d=Fl(e),d.c(),Zi(d,1),d.m(t,a)):d&&(Wi(),Yi(d,1,1,(()=>{d=null})),Qi()),4&r&&(l=Array.isArray(e[2].options.buttons)&&e[2].options.buttons.length),l?c?(c.p(e,r),4&r&&Zi(c,1)):(c=El(e),c.c(),Zi(c,1),c.m(t,null)):c&&(Wi(),Yi(c,1,1,(()=>{c=null})),Qi())},i(e){r||(Zi(s),Zi(d),Zi(c),r=!0)},o(e){Yi(s),Yi(d),Yi(c),r=!1},d(e){e&&xi(t),s&&s.d(),d&&d.d(),c&&c.d()}}}function Ll(e,t,n){let{descriptionId:a,labelId:r,step:o}=t;return e.$$set=e=>{"descriptionId"in e&&n(0,a=e.descriptionId),"labelId"in e&&n(1,r=e.labelId),"step"in e&&n(2,o=e.step)},[a,r,o]}class Ol extends ol{constructor(e){super(),rl(this,e,Ll,Nl,vi,{descriptionId:0,labelId:1,step:2})}}function Vl(e){let t;return{c(){t=Si("div"),Ai(t,"class","shepherd-arrow"),Ai(t,"data-popper-arrow","")},m(e,n){Di(e,t,n)},d(e){e&&xi(t)}}}function Tl(e){let t,n,a,r,o,i,l,s,d=e[4].options.arrow&&e[4].options.attachTo&&e[4].options.attachTo.element&&e[4].options.attachTo.on&&Vl();a=new Ol({props:{descriptionId:e[2],labelId:e[3],step:e[4]}});let c=[{"aria-describedby":r=Ir(e[4].options.text)?null:e[2]},{"aria-labelledby":o=e[4].options.title?e[3]:null},e[1],{open:"true"}],u={};for(let p=0;p<c.length;p+=1)u=hi(u,c[p]);return{c(){t=Si("dialog"),d&&d.c(),n=_i(),el(a.$$.fragment),Fi(t,u),Ei(t,"shepherd-has-cancel-icon",e[5]),Ei(t,"shepherd-has-title",e[6]),Ei(t,"shepherd-element",!0)},m(r,o){Di(r,t,o),d&&d.m(t,null),wi(t,n),tl(a,t,null),e[13](t),i=!0,l||(s=Ci(t,"keydown",e[7]),l=!0)},p(e,[l]){e[4].options.arrow&&e[4].options.attachTo&&e[4].options.attachTo.element&&e[4].options.attachTo.on?d||(d=Vl(),d.c(),d.m(t,n)):d&&(d.d(1),d=null);const s={};4&l&&(s.descriptionId=e[2]),8&l&&(s.labelId=e[3]),16&l&&(s.step=e[4]),a.$set(s),Fi(t,u=function(e,t){const n={},a={},r={$$scope:1};let o=e.length;for(;o--;){const i=e[o],l=t[o];if(l){for(const e in i)e in l||(a[e]=1);for(const e in l)r[e]||(n[e]=l[e],r[e]=1);e[o]=l}else for(const e in i)r[e]=1}for(const i in a)i in n||(n[i]=void 0);return n}(c,[(!i||20&l&&r!==(r=Ir(e[4].options.text)?null:e[2]))&&{"aria-describedby":r},(!i||24&l&&o!==(o=e[4].options.title?e[3]:null))&&{"aria-labelledby":o},2&l&&e[1],{open:"true"}])),Ei(t,"shepherd-has-cancel-icon",e[5]),Ei(t,"shepherd-has-title",e[6]),Ei(t,"shepherd-element",!0)},i(e){i||(Zi(a.$$.fragment,e),i=!0)},o(e){Yi(a.$$.fragment,e),i=!1},d(n){n&&xi(t),d&&d.d(),nl(a),e[13](null),l=!1,s()}}}function Rl(e){return e.split(" ").filter((e=>!!e.length))}function zl(e,t,n){let a,r,o,{classPrefix:i,element:l,descriptionId:s,firstFocusableElement:d,focusableElements:c,labelId:u,lastFocusableElement:p,step:f,dataStepId:h}=t;var m;m=()=>{n(1,h={[`data-${i}shepherd-step-id`]:f.id}),n(9,c=l.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]')),n(8,d=c[0]),n(10,p=c[c.length-1])},Oi().$$.on_mount.push(m),Vi((()=>{o!==f.options.classes&&(function(e){if(Ar(e)){const t=Rl(e);t.length&&l.classList.remove(...t)}}(o),o=f.options.classes,function(e){if(Ar(e)){const t=Rl(e);t.length&&l.classList.add(...t)}}(o))}));return e.$$set=e=>{"classPrefix"in e&&n(11,i=e.classPrefix),"element"in e&&n(0,l=e.element),"descriptionId"in e&&n(2,s=e.descriptionId),"firstFocusableElement"in e&&n(8,d=e.firstFocusableElement),"focusableElements"in e&&n(9,c=e.focusableElements),"labelId"in e&&n(3,u=e.labelId),"lastFocusableElement"in e&&n(10,p=e.lastFocusableElement),"step"in e&&n(4,f=e.step),"dataStepId"in e&&n(1,h=e.dataStepId)},e.$$.update=()=>{16&e.$$.dirty&&(n(5,a=f.options&&f.options.cancelIcon&&f.options.cancelIcon.enabled),n(6,r=f.options&&f.options.title))},[l,h,s,u,f,a,r,e=>{const{tour:t}=f;switch(e.keyCode){case 9:if(0===c.length){e.preventDefault();break}e.shiftKey?(document.activeElement===d||document.activeElement.classList.contains("shepherd-element"))&&(e.preventDefault(),p.focus()):document.activeElement===p&&(e.preventDefault(),d.focus());break;case 27:t.options.exitOnEsc&&(e.preventDefault(),e.stopPropagation(),f.cancel());break;case 37:t.options.keyboardNavigation&&(e.preventDefault(),e.stopPropagation(),t.back());break;case 39:t.options.keyboardNavigation&&(e.preventDefault(),e.stopPropagation(),t.next())}},d,c,p,i,()=>l,function(e){Ri[e?"unshift":"push"]((()=>{l=e,n(0,l)}))}]}class Ml extends ol{constructor(e){super(),rl(this,e,zl,Tl,vi,{classPrefix:11,element:0,descriptionId:2,firstFocusableElement:8,focusableElements:9,labelId:3,lastFocusableElement:10,step:4,dataStepId:1,getElement:12})}get getElement(){return this.$$.ctx[12]}}class Ul extends Fr{constructor(e,t={}){return super(),this._resolvedAttachTo=void 0,this._resolvedExtraHighlightElements=void 0,this.classPrefix=void 0,this.el=void 0,this.target=void 0,this.tour=void 0,this.tour=e,this.classPrefix=this.tour.options?Jr(this.tour.options.classPrefix):"",this.styles=e.styles,this._resolvedAttachTo=null,jr(this),this._setOptions(t),this}cancel(){this.tour.cancel(),this.trigger("cancel")}complete(){this.tour.complete(),this.trigger("complete")}destroy(){var e;(e=this).cleanup&&e.cleanup(),e.cleanup=null,_r(this.el)&&(this.el.remove(),this.el=null),this._updateStepTargetOnHide(),this.trigger("destroy")}getTour(){return this.tour}hide(){var e;null==(e=this.tour.modal)||e.hide(),this.trigger("before-hide"),this.el&&(this.el.hidden=!0),this._updateStepTargetOnHide(),this.trigger("hide")}_resolveExtraHiglightElements(){var e;return this._resolvedExtraHighlightElements=(e=this).options.extraHighlights?e.options.extraHighlights.flatMap((e=>Array.from(document.querySelectorAll(e)))):[],this._resolvedExtraHighlightElements}_resolveAttachToOptions(){return this._resolvedAttachTo=function(e){const t=e.options.attachTo||{},n=Object.assign({},t);if(Cr(n.element)&&(n.element=n.element.call(e)),Ar(n.element)){try{n.element=document.querySelector(n.element)}catch(a){}n.element}return n}(this),this._resolvedAttachTo}_getResolvedAttachToOptions(){return null===this._resolvedAttachTo?this._resolveAttachToOptions():this._resolvedAttachTo}isOpen(){return Boolean(this.el&&!this.el.hidden)}show(){return Cr(this.options.beforeShowPromise)?Promise.resolve(this.options.beforeShowPromise()).then((()=>this._show())):Promise.resolve(this._show())}updateStepOptions(e){Object.assign(this.options,e),this.shepherdElementComponent&&this.shepherdElementComponent.$set({step:this})}getElement(){return this.el}getTarget(){return this.target}_createTooltipContent(){const e=`${this.id}-description`,t=`${this.id}-label`;return this.shepherdElementComponent=new Ml({target:this.tour.options.stepsContainer||document.body,props:{classPrefix:this.classPrefix,descriptionId:e,labelId:t,step:this,styles:this.styles}}),this.shepherdElementComponent.getElement()}_scrollTo(e){const{element:t}=this._getResolvedAttachToOptions();Cr(this.options.scrollToHandler)?this.options.scrollToHandler(t):t instanceof Element&&"function"==typeof t.scrollIntoView&&t.scrollIntoView(e)}_getClassOptions(e){const t=this.tour&&this.tour.options&&this.tour.options.defaultStepOptions,n=e.classes?e.classes:"",a=t&&t.classes?t.classes:"",r=[...n.split(" "),...a.split(" ")],o=new Set(r);return Array.from(o).join(" ").trim()}_setOptions(e={}){let t=this.tour&&this.tour.options&&this.tour.options.defaultStepOptions;t=Hr({},t||{}),this.options=Object.assign({arrow:!0},t,e,function(e,t){return{floatingUIOptions:Hr(e.floatingUIOptions||{},t.floatingUIOptions||{})}}(t,e));const{when:n}=this.options;this.options.classes=this._getClassOptions(e),this.destroy(),this.id=this.options.id||`step-${Wr()}`,n&&Object.keys(n).forEach((e=>{this.on(e,n[e],this)}))}_setupElements(){Ir(this.el)||this.destroy(),this.el=this._createTooltipContent(),this.options.advanceOn&&Gr(this),pi(this)}_show(){var e;this.trigger("before-show"),this._resolveAttachToOptions(),this._resolveExtraHiglightElements(),this._setupElements(),this.tour.modal||this.tour.setupModal(),null==(e=this.tour.modal)||e.setupForStep(this),this._styleTargetElementForStep(this),this.el&&(this.el.hidden=!1),this.options.scrollTo&&setTimeout((()=>{this._scrollTo(this.options.scrollTo)})),this.el&&(this.el.hidden=!1);const t=this.shepherdElementComponent.getElement(),n=this.target||document.body,a=this._resolvedExtraHighlightElements;n.classList.add(`${this.classPrefix}shepherd-enabled`),n.classList.add(`${this.classPrefix}shepherd-target`),t.classList.add("shepherd-enabled"),null==a||a.forEach((e=>{e.classList.add(`${this.classPrefix}shepherd-enabled`),e.classList.add(`${this.classPrefix}shepherd-target`)})),this.trigger("show")}_styleTargetElementForStep(e){const t=e.target,n=e._resolvedExtraHighlightElements;if(!t)return;const a=e.options.highlightClass;a&&(t.classList.add(a),null==n||n.forEach((e=>e.classList.add(a)))),t.classList.remove("shepherd-target-click-disabled"),null==n||n.forEach((e=>e.classList.remove("shepherd-target-click-disabled"))),!1===e.options.canClickTarget&&(t.classList.add("shepherd-target-click-disabled"),null==n||n.forEach((e=>e.classList.add("shepherd-target-click-disabled"))))}_updateStepTargetOnHide(){const e=this.target||document.body,t=this._resolvedExtraHighlightElements,n=this.options.highlightClass;n&&(e.classList.remove(n),null==t||t.forEach((e=>e.classList.remove(n)))),e.classList.remove("shepherd-target-click-disabled",`${this.classPrefix}shepherd-enabled`,`${this.classPrefix}shepherd-target`),null==t||t.forEach((e=>{e.classList.remove("shepherd-target-click-disabled",`${this.classPrefix}shepherd-enabled`,`${this.classPrefix}shepherd-target`)}))}}function ql(e){let t,n,a,r,o;return{c(){t=Pi("svg"),n=Pi("path"),Ai(n,"d",e[2]),Ai(t,"class",a=(e[1]?"shepherd-modal-is-visible":"")+" shepherd-modal-overlay-container")},m(a,i){Di(a,t,i),wi(t,n),e[11](t),r||(o=Ci(t,"touchmove",e[3]),r=!0)},p(e,[r]){4&r&&Ai(n,"d",e[2]),2&r&&a!==(a=(e[1]?"shepherd-modal-is-visible":"")+" shepherd-modal-overlay-container")&&Ai(t,"class",a)},i:fi,o:fi,d(n){n&&xi(t),e[11](null),r=!1,o()}}}function Hl(e){if(!e)return null;const t=e instanceof HTMLElement&&window.getComputedStyle(e).overflowY;return"hidden"!==t&&"visible"!==t&&e.scrollHeight>=e.clientHeight?e:Hl(e.parentElement)}function Bl(e,t){const n=e.getBoundingClientRect();let a=n.y||n.top,r=n.bottom||a+n.height;if(t){const e=t.getBoundingClientRect(),n=e.y||e.top,o=e.bottom||n+e.height;a=Math.max(a,n),r=Math.min(r,o)}return{y:a,height:Math.max(r-a,0)}}function $l(e,t,n){let a,r,{element:o,openingProperties:i}=t,l=!1;s();function s(){n(4,i=[{width:0,height:0,x:0,y:0,r:0}])}function d(){n(1,l=!1),f()}function c(e=0,t=0,a=0,r=0,o,l,d){if(l){const s=[l,...d||[]];n(4,i=[]);for(const n of s){if(!n)continue;if(s.indexOf(n)!==s.lastIndexOf(n))continue;const{y:l,height:d}=Bl(n,o),{x:c,width:u,left:p}=n.getBoundingClientRect();s.some((e=>{if(e===n)return!1;const t=e.getBoundingClientRect();return c>=t.left&&c+u<=t.right&&l>=t.top&&l+d<=t.bottom}))||i.push({width:u+2*e,height:d+2*e,x:(c||p)+a-e,y:l+r-e,r:t})}}else s()}function u(){n(1,l=!0)}const p=e=>{e.preventDefault()};function f(){a&&(cancelAnimationFrame(a),a=void 0),window.removeEventListener("touchmove",p,{passive:!1})}return e.$$set=e=>{"element"in e&&n(0,o=e.element),"openingProperties"in e&&n(4,i=e.openingProperties)},e.$$.update=()=>{16&e.$$.dirty&&n(2,r=function(e){let t="";const{innerWidth:n,innerHeight:a}=window;return e.forEach((e=>{const{width:n,height:a,x:r=0,y:o=0,r:i=0}=e,{topLeft:l=0,topRight:s=0,bottomRight:d=0,bottomLeft:c=0}="number"==typeof i?{topLeft:i,topRight:i,bottomRight:i,bottomLeft:i}:i;t+=`M${r+l},${o}      a${l},${l},0,0,0-${l},${l}      V${a+o-c}      a${c},${c},0,0,0,${c},${c}      H${n+r-d}      a${d},${d},0,0,0,${d}-${d}      V${o+s}      a${s},${s},0,0,0-${s}-${s}      Z`})),`M${n},${a}          H0          V0          H${n}          V${a}          Z          ${t}`.replace(/\s/g,"")}(i))},[o,l,r,e=>{e.stopPropagation()},i,()=>o,s,d,c,function(e){f(),e.tour.options.useModalOverlay?(!function(e){const{modalOverlayOpeningPadding:t,modalOverlayOpeningRadius:n,modalOverlayOpeningXOffset:r=0,modalOverlayOpeningYOffset:o=0}=e.options,i=function(e){let t={top:0,left:0};if(!e)return t;let n=e.ownerDocument.defaultView;for(;n!==window.top;){var a;const e=null==(a=n)?void 0:a.frameElement;if(e){var r,o;const n=e.getBoundingClientRect();t.top+=n.top+(null!=(r=n.scrollTop)?r:0),t.left+=n.left+(null!=(o=n.scrollLeft)?o:0)}n=n.parent}return t}(e.target),l=Hl(e.target),s=()=>{a=void 0,c(t,n,r+i.left,o+i.top,l,e.target,e._resolvedExtraHighlightElements),a=requestAnimationFrame(s)};s(),window.addEventListener("touchmove",p,{passive:!1})}(e),u()):d()},u,function(e){Ri[e?"unshift":"push"]((()=>{o=e,n(0,o)}))}]}class jl extends ol{constructor(e){super(),rl(this,e,$l,ql,vi,{element:0,openingProperties:4,getElement:5,closeModalOpening:6,hide:7,positionModal:8,setupForStep:9,show:10})}get getElement(){return this.$$.ctx[5]}get closeModalOpening(){return this.$$.ctx[6]}get hide(){return this.$$.ctx[7]}get positionModal(){return this.$$.ctx[8]}get setupForStep(){return this.$$.ctx[9]}get show(){return this.$$.ctx[10]}}const Gl=new class extends Fr{constructor(){super(),this.activeTour=void 0,jr(this)}},Jl="undefined"==typeof window;Gl.Step=Jl?class{constructor(e){}}:Ul,Gl.Tour=Jl?class{constructor(e,t){}}:class extends Fr{constructor(e={}){super(),this.trackedEvents=["active","cancel","complete","show"],this.classPrefix=void 0,this.currentStep=void 0,this.focusedElBeforeOpen=void 0,this.id=void 0,this.modal=void 0,this.options=void 0,this.steps=void 0,jr(this);this.options=Object.assign({},{exitOnEsc:!0,keyboardNavigation:!0},e),this.classPrefix=Jr(this.options.classPrefix),this.steps=[],this.addSteps(this.options.steps);return["active","cancel","complete","inactive","show","start"].map((e=>{(e=>{this.on(e,(t=>{(t=t||{}).tour=this,Gl.trigger(e,t)}))})(e)})),this._setTourID(e.id),this}addStep(e,t){let n=e;return n instanceof Ul?n.tour=this:n=new Ul(this,n),Ir(t)?this.steps.push(n):this.steps.splice(t,0,n),n}addSteps(e){return Array.isArray(e)&&e.forEach((e=>{this.addStep(e)})),this}back(){const e=this.steps.indexOf(this.currentStep);this.show(e-1,!1)}async cancel(){if(this.options.confirmCancel){const e=this.options.confirmCancelMessage||"Are you sure you want to stop the tour?";let t;t=Cr(this.options.confirmCancel)?await this.options.confirmCancel():window.confirm(e),t&&this._done("cancel")}else this._done("cancel")}complete(){this._done("complete")}getById(e){return this.steps.find((t=>t.id===e))}getCurrentStep(){return this.currentStep}hide(){const e=this.getCurrentStep();if(e)return e.hide()}isActive(){return Gl.activeTour===this}next(){const e=this.steps.indexOf(this.currentStep);e===this.steps.length-1?this.complete():this.show(e+1,!0)}removeStep(e){const t=this.getCurrentStep();this.steps.some(((t,n)=>{if(t.id===e)return t.isOpen()&&t.hide(),t.destroy(),this.steps.splice(n,1),!0})),t&&t.id===e&&(this.currentStep=void 0,this.steps.length?this.show(0):this.cancel())}show(e=0,t=!0){const n=Ar(e)?this.getById(e):this.steps[e];if(n){this._updateStateBeforeShow();Cr(n.options.showOn)&&!n.options.showOn()?this._skipStep(n,t):(this.currentStep=n,this.trigger("show",{step:n,previous:this.currentStep}),n.show())}}async start(){this.trigger("start"),this.focusedElBeforeOpen=document.activeElement,this.currentStep=null,this.setupModal(),this._setupActiveTour(),this.next()}_done(e){const t=this.steps.indexOf(this.currentStep);if(Array.isArray(this.steps)&&this.steps.forEach((e=>e.destroy())),function(e){if(e){const{steps:t}=e;t.forEach((e=>{e.options&&!1===e.options.canClickTarget&&e.options.attachTo&&(_r(e.target)&&e.target.classList.remove("shepherd-target-click-disabled"),e._resolvedExtraHighlightElements&&e._resolvedExtraHighlightElements.forEach((e=>{_r(e)&&e.classList.remove("shepherd-target-click-disabled")})))}))}}(this),this.trigger(e,{index:t}),Gl.activeTour=null,this.trigger("inactive",{tour:this}),this.modal&&this.modal.hide(),("cancel"===e||"complete"===e)&&this.modal){const e=document.querySelector(".shepherd-modal-overlay-container");e&&(e.remove(),this.modal=null)}_r(this.focusedElBeforeOpen)&&this.focusedElBeforeOpen.focus()}_setupActiveTour(){this.trigger("active",{tour:this}),Gl.activeTour=this}setupModal(){this.modal=new jl({target:this.options.modalContainer||document.body,props:{styles:this.styles}})}_skipStep(e,t){const n=this.steps.indexOf(e);if(n===this.steps.length-1)this.complete();else{const e=t?n+1:n-1;this.show(e,t)}}_updateStateBeforeShow(){this.currentStep&&this.currentStep.hide(),this.isActive()||this._setupActiveTour()}_setTourID(e){const t=this.options.tourName||"tour",n=e||Wr();this.id=`${t}--${n}`}};const Kl={topbar:{appSubtitle:"Secure requisition form builder",aria:{themeToggleLight:"Switch to Light Theme",themeToggleDark:"Switch to Dark Theme",reset:"Reset Application",faq:"Open FAQ",tour:"Start Guided Tour",copyUrl:"Copy URL",copyEncryptedUrl:"Copy Encrypted URL",pasteData:"Paste and Import Data",saveData:"Save Data",loadData:"Load Data",generatePdf:"Generate PDF",moreActions:"More Actions",toggleLanguage:"Switch Language between German and English"},tooltips:{themeToggleLight:"Switch to Light Theme",themeToggleDark:"Switch to Dark Theme",reset:"Reset Application",faq:"FAQ",tour:"Start Guided Tour",copyUrl:"Copy URL",copyEncryptedUrl:"Copy Encrypted URL",pasteData:"Paste Data",saveData:"Save Data",loadData:"Load Data",generatePdf:"Generate PDF",toggleLanguage:"Switch Language (DE/EN)"},menu:{reset:"Reset Application",faq:"FAQ",tour:"Start Guided Tour",copyUrl:"Copy URL",copyEncryptedUrl:"Copy Encrypted URL",pasteData:"Paste Data",saveData:"Save Data",loadData:"Load Data",generatePdf:"Generate PDF",toggleLanguage:"Switch Language"}},patientForm:{title:"Patient Details",labels:{givenName:"Given Name *",familyName:"Family Name *",birthdate:"Birthdate *",sex:"Sex *",insurance:"Insurance *",physicianName:"Physician Name *",familyHistory:"Family History",parentalConsanguinity:"Parental Consanguinity",diagnosis:"Diagnosis / Suspicion *",orderingDate:"Ordering Date",consent:"Consent",consentGivenBy:"Consent Given By",consentDate:"Consent Date",consentSecondaryFindings:"Consent to receive secondary findings?",consentMaterial:"Allow use of material for quality assurance?",consentExtendedStorage:"Store results beyond 10 years (max. 30 years)?",consentResearch:"Use for research/quality assurance purposes?",requestVariantSegregation:"Request Variant Segregation",variantDetails:"Variant Details"},hints:{variantDetails:"Provide details for the variant segregation request"},options:{sex:{male:"Male",female:"Female",undetermined:"Undetermined"},familyHistory:{conspicuous:"Conspicuous",inconspicuous:"Inconspicuous",unknown:"Unknown"},consanguinity:{yes:"Yes",no:"No"},consent:{provided:"Already Provided",fill:"Fill Form"},yesNo:{yes:"Yes",no:"No"}}},phenotypeSelector:{toggleButton:{hide:"Hide Phenotype Options",add:"Add Phenotypes"},panelTitle:"Select Phenotype States",radioLabels:{noInput:"No Input",present:"Present",absent:"Absent"},noPhenotypesMessage:"No predefined phenotypes available for this category."},selectedPanelsSummary:{title:"Selected Panels:"},testSelector:{title:"Select Panels / Tests",tabs:{categorySelection:"Category Selection",search:"Search"},labels:{category:"Category",selectPanels:"Select Panels",searchPlaceholder:"Type a panel or gene name"}},footer:{versions:{app:"App:",testSchema:"Test schema:",pdfSchema:"PDF schema:"},tooltips:{disclaimerAcknowledged:"Disclaimer Acknowledged:",toggleLogViewer:"Toggle Log Viewer",githubRepo:"GitHub Repository",license:"License (MIT)",wiki:"Wiki / Documentation"},ariaLabels:{reopenDisclaimer:"Disclaimer Acknowledged - Click to reopen",toggleLogViewer:"Toggle Log Viewer",githubRepo:"GitHub Repository",licenseInfo:"License Information",wikiDocs:"Wiki Documentation"}},pasteDataModal:{title:"Paste and Import Data",instructions:"Paste your data in the text area below. The data should be formatted as key-value pairs, with each pair on a new line and separated by a colon.",labels:{pasteArea:"Paste your data here"},placeholders:{pasteArea:'First Name: John\nLast Name: Doe\nBirthdate: 1990-01-01\n...\n\nClick "Show Example" for a complete example.'},example:{title:"Example format:",useButton:"Use Example Data",showButton:"Show Example",hideButton:"Hide Example"},alerts:{parseSuccess:'Data successfully parsed! Click "Import Data" to apply these changes.',parseError:"Data could not be parsed. Please check the format."},buttons:{cancel:"Cancel",parse:"Parse Data",import:"Import"},validation:{pasteRequired:"Please paste data before parsing."}},decryptionDialog:{title:"Enter Password for Decryption",labels:{password:"Password"},buttons:{cancel:"Cancel",confirm:"Confirm"}},encryptionDialog:{title:"Enter Password for Encryption",labels:{password:"Password"},buttons:{cancel:"Cancel",confirm:"Confirm"}},faqDialog:{title:"Frequently Asked Questions",searchLabel:"Search FAQs",noResults:"No FAQs match your search criteria.",uncategorized:"Uncategorized",buttons:{close:"Close"}},loadDataDialog:{title:"Load Form Data",instruction:"Select a JSON file to import:",labels:{fileInput:"Select file"},validation:{fileRequired:"Please select a file"},buttons:{cancel:"Cancel",import:"Import"}},resetConfirmationDialog:{title:"Reset Application",confirmationText:"Are you sure you want to reset the entire application? This will clear all form data and cannot be undone.",buttons:{cancel:"Cancel",reset:"Reset"}},saveDataDialog:{title:"Export Form Data",instruction:"Save your form data for later use. You can name the file to identify it easily.",labels:{fileName:"File Name"},placeholders:{fileName:"requiform-data"},hints:{fileName:"Filename will be appended with .json"},buttons:{cancel:"Cancel",export:"Export"},defaultFileName:"requiform-data"},logViewer:{title:"Application Logs",emptyState:"No log entries yet.",levels:{debug:"Debug",info:"Info",warn:"Warn",error:"Error"},buttons:{download:"Download Logs",clear:"Clear Logs",close:"Close Logs",toggleDetails:"Toggle Details"}},disclaimer:{title:"Disclaimer",body:"This tool is for non-medical use only. It is not intended to provide medical advice or diagnosis. Please do not enter sensitive personal data.",acknowledgeButton:"I Acknowledge"},pedigreeDrawer:{title:"Pedigree Chart"},app:{includePedigreeChart:"Include Pedigree Chart"},tour:{buttons:{back:"Back",next:"Next",skip:"Skip",start:"Start Tour",finish:"Finish"},welcome:{text:"Welcome to RequiForm! This tour will guide you through the main features."},patientForm:{text:"Start by entering the patient information in this section."},testSelector:{text:"Select the required genetic tests here."},phenotypes:{text:"Add relevant HPO phenotypes for the patient."},topBarActions:{text:"Use the top bar actions like Generate PDF, Copy URL, etc."},generatePdf:{text:"Once the form is complete, generate the PDF request form using this button."},complete:{text:"You have completed the tour! You can restart it anytime from the Help menu."},completed:"Tour completed!",cancelled:"Tour cancelled."},validation:{required:{firstName:"First name is required.",lastName:"Last name is required.",birthdate:"Birthdate is required.",sex:"Sex is required.",insurance:"Insurance information is required.",referrer:"Referring physician is required.",diagnosis:"Diagnosis/Suspicion is required.",phenotypeId:"Phenotype ID is required.",phenotypeStatus:"Phenotype status is required."},invalid:{email:"Invalid email format.",birthdate:"Birthdate must be a valid date (YYYY-MM-DD) not in the future.",hpoIdFormat:"Invalid HPO ID format."},general:{missingData:"Patient data is missing."}}},Wl={topbar:{appSubtitle:"Sicherer Anforderungsformular-Generator",aria:{themeToggleLight:"Zu hellem Design wechseln",themeToggleDark:"Zu dunklem Design wechseln",reset:"Anwendung zurücksetzen",faq:"FAQ öffnen",tour:"Geführte Tour starten",copyUrl:"URL kopieren",copyEncryptedUrl:"Verschlüsselte URL kopieren",pasteData:"Daten einfügen und importieren",saveData:"Daten speichern",loadData:"Daten laden",generatePdf:"PDF generieren",moreActions:"Weitere Aktionen",toggleLanguage:"Sprache zwischen Deutsch und Englisch wechseln"},tooltips:{themeToggleLight:"Zu hellem Design wechseln",themeToggleDark:"Zu dunklem Design wechseln",reset:"Anwendung zurücksetzen",faq:"FAQ",tour:"Geführte Tour starten",copyUrl:"URL kopieren",copyEncryptedUrl:"Verschlüsselte URL kopieren",pasteData:"Daten einfügen",saveData:"Daten speichern",loadData:"Daten laden",generatePdf:"PDF generieren",toggleLanguage:"Sprache wechseln (DE/EN)"},menu:{reset:"Anwendung zurücksetzen",faq:"FAQ",tour:"Geführte Tour starten",copyUrl:"URL kopieren",copyEncryptedUrl:"Verschlüsselte URL kopieren",pasteData:"Daten einfügen",saveData:"Daten speichern",loadData:"Daten laden",generatePdf:"PDF generieren",toggleLanguage:"Sprache wechseln"}},patientForm:{title:"Patientendetails",labels:{givenName:"Vorname *",familyName:"Familienname *",birthdate:"Geburtsdatum *",sex:"Geschlecht *",insurance:"Versicherung *",physicianName:"Arztname *",familyHistory:"Familienanamnese",parentalConsanguinity:"Elterliche Konsanguinität",diagnosis:"Diagnose / Verdacht *",orderingDate:"Bestelldatum",consent:"Einwilligung",consentGivenBy:"Einwilligung gegeben von",consentDate:"Datum der Einwilligung",consentSecondaryFindings:"Einwilligung zum Erhalt von Sekundärbefunden?",consentMaterial:"Nutzung des Materials zur Qualitätssicherung erlauben?",consentExtendedStorage:"Ergebnisse länger als 10 Jahre speichern (max. 30 Jahre)?",consentResearch:"Nutzung für Forschungs-/Qualitätssicherungszwecke?",requestVariantSegregation:"Variantensegregation anfordern",variantDetails:"Variantendetails"},hints:{variantDetails:"Details zur Anforderung der Variantensegregation angeben"},options:{sex:{male:"Männlich",female:"Weiblich",undetermined:"Unbestimmt"},familyHistory:{conspicuous:"Auffällig",inconspicuous:"Unauffällig",unknown:"Unbekannt"},consanguinity:{yes:"Ja",no:"Nein"},consent:{provided:"Bereits vorhanden",fill:"Formular ausfüllen"},yesNo:{yes:"Ja",no:"Nein"}}},phenotypeSelector:{toggleButton:{hide:"Phänotyp-Optionen ausblenden",add:"Phänotypen hinzufügen"},panelTitle:"Phänotyp-Zustände auswählen",radioLabels:{noInput:"Keine Angabe",present:"Vorhanden",absent:"Fehlend"},noPhenotypesMessage:"Für diese Kategorie sind keine vordefinierten Phänotypen verfügbar."},selectedPanelsSummary:{title:"Ausgewählte Panels:"},testSelector:{title:"Panels / Tests auswählen",tabs:{categorySelection:"Kategorieauswahl",search:"Suche"},labels:{category:"Kategorie",selectPanels:"Panels auswählen",searchPlaceholder:"Panel- oder Gen-Namen eingeben"}},footer:{versions:{app:"App:",testSchema:"Testschema:",pdfSchema:"PDF-Schema:"},tooltips:{disclaimerAcknowledged:"Haftungsausschluss bestätigt:",toggleLogViewer:"Log-Anzeige umschalten",githubRepo:"GitHub-Repository",license:"Lizenz (MIT)",wiki:"Wiki / Dokumentation"},ariaLabels:{reopenDisclaimer:"Haftungsausschluss bestätigt - Zum erneuten Öffnen klicken",toggleLogViewer:"Log-Anzeige umschalten",githubRepo:"GitHub-Repository",licenseInfo:"Lizenzinformationen",wikiDocs:"Wiki-Dokumentation"}},pasteDataModal:{title:"Daten einfügen und importieren",instructions:"Fügen Sie Ihre Daten in das Textfeld unten ein. Die Daten sollten als Schlüssel-Wert-Paare formatiert sein, wobei jedes Paar in einer neuen Zeile steht und durch einen Doppelpunkt getrennt ist.",labels:{pasteArea:"Fügen Sie Ihre Daten hier ein"},placeholders:{pasteArea:'Vorname: Max\nNachname: Mustermann\nGeburtsdatum: 1990-01-01\n...\n\nKlicken Sie auf "Beispiel anzeigen" für ein vollständiges Beispiel.'},example:{title:"Beispielformat:",useButton:"Beispieldaten verwenden",showButton:"Beispiel anzeigen",hideButton:"Beispiel ausblenden"},alerts:{parseSuccess:'Daten erfolgreich geparst! Klicken Sie auf "Daten importieren", um diese Änderungen anzuwenden.',parseError:"Daten konnten nicht geparst werden. Bitte überprüfen Sie das Format."},buttons:{cancel:"Abbrechen",parse:"Daten parsen",import:"Daten importieren"},validation:{pasteRequired:"Bitte fügen Sie Daten vor dem Parsen ein."}},decryptionDialog:{title:"Passwort zur Entschlüsselung eingeben",labels:{password:"Passwort"},buttons:{cancel:"Abbrechen",confirm:"Bestätigen"}},encryptionDialog:{title:"Passwort zur Verschlüsselung eingeben",labels:{password:"Passwort"},buttons:{cancel:"Abbrechen",confirm:"Bestätigen"}},faqDialog:{title:"Häufig gestellte Fragen",searchLabel:"FAQs durchsuchen",noResults:"Keine FAQs entsprechen Ihren Suchkriterien.",uncategorized:"Unkategorisiert",buttons:{close:"Schließen"}},loadDataDialog:{title:"Formulardaten laden",instruction:"Wählen Sie eine zuvor gespeicherte JSON-Datei aus, um die Formulardaten zu laden.",labels:{fileInput:"JSON-Datei auswählen"},buttons:{cancel:"Abbrechen",import:"Importieren"},validation:{fileRequired:"Bitte wählen Sie eine Datei zum Importieren aus."}},resetConfirmationDialog:{title:"Anwendung zurücksetzen",confirmationText:"Sind Sie sicher, dass Sie die gesamte Anwendung zurücksetzen möchten? Dies löscht alle Formulardaten und kann nicht rückgängig gemacht werden.",buttons:{cancel:"Abbrechen",reset:"Zurücksetzen"}},saveDataDialog:{title:"Formulardaten exportieren",instruction:"Speichern Sie Ihre Formulardaten zur späteren Verwendung. Sie können die Datei benennen, um sie leicht zu identifizieren.",labels:{fileName:"Dateiname"},placeholders:{fileName:"requiform-daten"},hints:{fileName:"An den Dateinamen wird .json angehängt"},buttons:{cancel:"Abbrechen",export:"Exportieren"},defaultFileName:"requiform-daten"},logViewer:{title:"Anwendungsprotokolle",emptyState:"Noch keine Protokolleinträge.",levels:{debug:"Debug",info:"Info",warn:"Warnung",error:"Fehler"},buttons:{download:"Protokolle herunterladen",clear:"Protokolle löschen",close:"Protokolle schließen",toggleDetails:"Details umschalten"}},disclaimer:{title:"Haftungsausschluss",body:"Dieses Werkzeug ist nur für nicht-medizinische Zwecke bestimmt. Es ist nicht dafür gedacht, medizinischen Rat oder Diagnosen zu liefern. Bitte geben Sie keine sensiblen persönlichen Daten ein.",acknowledgeButton:"Ich bestätige"},pedigreeDrawer:{title:"Stammbaumdiagramm"},app:{includePedigreeChart:"Stammbaumdiagramm einschließen"},tour:{buttons:{back:"Zurück",next:"Weiter",skip:"Überspringen",start:"Tour starten",finish:"Beenden"},welcome:{text:"Willkommen bei RequiForm! Diese Tour führt Sie durch die Hauptfunktionen."},patientForm:{text:"Beginnen Sie mit der Eingabe der Patienteninformationen in diesem Abschnitt."},testSelector:{text:"Wählen Sie hier die erforderlichen Gentests aus."},phenotypes:{text:"Fügen Sie relevante HPO-Phänotypen für den Patienten hinzu."},topBarActions:{text:"Nutzen Sie die Aktionen in der oberen Leiste wie PDF generieren, URL kopieren usw."},generatePdf:{text:"Sobald das Formular vollständig ist, generieren Sie das PDF-Anforderungsformular mit dieser Schaltfläche."},complete:{text:"Sie haben die Tour abgeschlossen! Sie können sie jederzeit über das Hilfe-Menü neu starten."},completed:"Tour abgeschlossen!",cancelled:"Tour abgebrochen."},validation:{required:{firstName:"Vorname ist erforderlich.",lastName:"Nachname ist erforderlich.",birthdate:"Geburtsdatum ist erforderlich.",sex:"Geschlecht ist erforderlich.",insurance:"Versicherungsinformationen sind erforderlich.",referrer:"Überweisender Arzt ist erforderlich.",diagnosis:"Diagnose/Verdacht ist erforderlich.",phenotypeId:"Phänotyp-ID ist erforderlich.",phenotypeStatus:"Phänotyp-Status ist erforderlich."},invalid:{email:"Ungültiges E-Mail-Format.",birthdate:"Geburtsdatum muss ein gültiges Datum (JJJJ-MM-TT) sein und darf nicht in der Zukunft liegen.",hpoIdFormat:"Ungültiges HPO-ID-Format."},general:{missingData:"Patientendaten fehlen."}}};const Ql={en:JSON.parse(JSON.stringify(Kl)),de:JSON.parse(JSON.stringify(Wl))};Ue(Ql.en),Ue(Ql.de);const Zl=V({locale:function(){try{const e=localStorage.getItem("userLanguage");if(e&&["en","de"].includes(e))return e;const t=navigator.language.split("-")[0];return["en","de"].includes(t)?t:"en"}catch{return"en"}}(),fallbackLocale:"en",messages:Ql,warnHtmlMessage:!1,escapeParameter:!0});function Yl(){const e=h(null);function t(){e.value?(Me.info("Starting application tour..."),e.value.start()):Me.error("App Tour: Could not start, tour instance not available.")}return{tourInstance:e,initialize:function(){e.value=function(){const e=new Gl.Tour({useModalOverlay:!0,defaultStepOptions:{classes:"shepherd-theme-arrows shepherd-custom",scrollTo:{behavior:"smooth",block:"center"},cancelIcon:{enabled:!0},buttons:[{action(){return this.back()},secondary:!0,text:Zl.global.t("tour.buttons.back")},{action(){return this.next()},text:Zl.global.t("tour.buttons.next")}]}});return e.addStep({id:"welcome",text:Zl.global.t("tour.welcome.text"),attachTo:{element:"#app",on:"center"},buttons:[{action(){return localStorage.setItem("requiformTourCompleted","true"),this.cancel()},secondary:!0,text:Zl.global.t("tour.buttons.skip")},{action(){return this.next()},text:Zl.global.t("tour.buttons.start")}]}),e.addStep({id:"patient-form",text:Zl.global.t("tour.patientForm.text"),attachTo:{element:"#patient-form-component",on:"bottom"},when:{show:()=>document.querySelector("#patient-form-component")}}),e.addStep({id:"test-selector",text:Zl.global.t("tour.testSelector.text"),attachTo:{element:"#test-selector-component",on:"bottom"},when:{show:()=>document.querySelector("#test-selector-component")}}),e.addStep({id:"phenotypes",text:Zl.global.t("tour.phenotypes.text"),attachTo:{element:"#phenotype-selector-component",on:"bottom"},when:{show:()=>document.querySelector("#phenotype-selector-component")}}),e.addStep({id:"top-bar-actions",text:Zl.global.t("tour.topBarActions.text"),attachTo:{element:"#top-bar-actions",on:"bottom"},when:{show:()=>document.querySelector("#top-bar-actions")}}),e.addStep({id:"generate-pdf",text:Zl.global.t("tour.generatePdf.text"),attachTo:{element:"#generate-pdf-btn",on:"left"},when:{show:()=>document.querySelector("#generate-pdf-btn")}}),e.addStep({id:"tour-complete",text:Zl.global.t("tour.complete.text"),buttons:[{action(){return this.complete()},text:Zl.global.t("tour.buttons.finish")}]}),e.on("complete",(()=>{Me.info(Zl.global.t("tour.completed")),localStorage.setItem("requiformTourCompleted","true")})),e.on("cancel",(()=>{Me.info(Zl.global.t("tour.cancelled"))})),e}(),localStorage.getItem("requiformTourCompleted")||t()},startTour:t}}const Xl={en:[{category:"General",question:"What is RequiForm?",answer:"RequiForm is a web application designed to help clinicians and researchers easily generate standardized clinical data requisitions, particularly for genetic testing. It focuses on privacy, usability, and adherence to standards like HPO."},{category:"General",question:"Which browsers are supported?",answer:"RequiForm is tested on the latest versions of modern browsers like <strong>Chrome</strong>, <strong>Firefox</strong>, <strong>Edge</strong>, and <strong>Safari</strong>. While it may work on others, using an up-to-date version of these recommended browsers ensures the best experience."},{category:"Data Handling & Security",question:"How is my data handled? Is it secure?",answer:"<strong>All data processing happens entirely in your browser.</strong> Your data <strong>never leaves your device</strong>, and no information is stored on any servers. This client-side approach ensures maximum privacy and security for sensitive information. When using sharing features, data is either encoded directly in the URL or saved locally as a file."},{category:"Data Handling & Security",question:"What encryption is used for sharing?",answer:'The "Share Encrypted Link" option uses <strong>AES-GCM encryption</strong> with a key derived from your chosen password using <strong>PBKDF2</strong>. This is a strong, standard-based encryption method. <em>Remember: the security relies on the strength of your password and keeping it confidential.</em> The specific implementation details can be reviewed in the source code.'},{category:"Data Handling & Security",question:"What data format is used for file import/export?",answer:"The application uses a structured <strong>JSON format</strong> for saving and loading data. This format includes patient information, selected panels, and phenotype data. The exact structure can be inspected by saving the data to a file."},{category:"Data Handling & Security",question:"Can I use RequiForm offline?",answer:"Yes, once the application is loaded in your browser, it can function offline. However, features requiring external resources (like fetching HPO terms if not cached) might be limited without an internet connection."},{category:"Features",question:"How does the HPO term search work?",answer:"You can search for Human Phenotype Ontology (HPO) terms by typing keywords or HPO IDs. The search uses an integrated HPO database to suggest relevant terms. Selecting a term adds it to the patient's phenotype profile."},{category:"Features",question:"Can I customize the generated PDF?",answer:"The PDF layout and content are standardized. While direct customization isn't currently supported, the application includes fields for common requirements. Future versions may offer more branding or layout options."},{category:"Features",question:"How do I share the form data?",answer:"You can share the data in several ways:\n<ul>\n  <li><strong>Copy URL:</strong> Generates a link with the data encoded directly in it (can be long).</li>\n  <li><strong>Copy Encrypted URL:</strong> Generates a link with the data encrypted using a password you provide.</li>\n  <li><strong>Save Data:</strong> Downloads the data as a JSON file.</li>\n</ul>"},{category:"Troubleshooting",question:"The application seems slow or unresponsive.",answer:"Ensure you are using a supported browser and that it's up-to-date. Try clearing your browser's cache or restarting the browser. If the issue persists, check your system's resource usage or contact support if applicable."},{category:"Troubleshooting",question:"I encountered an error message.",answer:"Note down the error message and the steps you took leading up to it. Try refreshing the page. If the error persists, consult the browser's developer console (usually opened with F12) for more details, which might be helpful for debugging."}],de:[{category:"Allgemein",question:"Was ist RequiForm?",answer:"RequiForm ist eine Webanwendung, die Klinikern und Forschern hilft, standardisierte klinische Datenanforderungen, insbesondere für Gentests, einfach zu generieren. Der Fokus liegt auf Datenschutz, Benutzerfreundlichkeit und der Einhaltung von Standards wie HPO."},{category:"Allgemein",question:"Welche Browser werden unterstützt?",answer:"RequiForm wird mit den neuesten Versionen moderner Browser wie <strong>Chrome</strong>, <strong>Firefox</strong>, <strong>Edge</strong> und <strong>Safari</strong> getestet. Obwohl es möglicherweise auch in anderen Browsern funktioniert, gewährleistet die Verwendung einer aktuellen Version dieser empfohlenen Browser das beste Erlebnis."},{category:"Datenverarbeitung & Sicherheit",question:"Wie werden meine Daten gehandhabt? Sind sie sicher?",answer:"<strong>Die gesamte Datenverarbeitung findet ausschließlich in Ihrem Browser statt.</strong> Ihre Daten <strong>verlassen niemals Ihr Gerät</strong>, und es werden keine Informationen auf Servern gespeichert. Dieser clientseitige Ansatz gewährleistet maximale Privatsphäre und Sicherheit für sensible Informationen. Bei der Nutzung von Freigabefunktionen werden Daten entweder direkt in der URL kodiert oder lokal als Datei gespeichert."},{category:"Datenverarbeitung & Sicherheit",question:"Welche Verschlüsselung wird für die Freigabe verwendet?",answer:'Die Option "Verschlüsselten Link teilen" verwendet <strong>AES-GCM-Verschlüsselung</strong> mit einem Schlüssel, der mittels <strong>PBKDF2</strong> aus Ihrem gewählten Passwort abgeleitet wird. Dies ist eine starke, standardbasierte Verschlüsselungsmethode. <em>Denken Sie daran: Die Sicherheit hängt von der Stärke Ihres Passworts und dessen Geheimhaltung ab.</em> Die spezifischen Implementierungsdetails können im Quellcode eingesehen werden.'},{category:"Datenverarbeitung & Sicherheit",question:"Welches Datenformat wird für den Datei-Import/Export verwendet?",answer:"Die Anwendung verwendet ein strukturiertes <strong>JSON-Format</strong> zum Speichern und Laden von Daten. Dieses Format enthält Patienteninformationen, ausgewählte Panels und Phänotypdaten. Die genaue Struktur kann durch Speichern der Daten in eine Datei überprüft werden."},{category:"Datenverarbeitung & Sicherheit",question:"Kann ich RequiForm offline verwenden?",answer:"Ja, sobald die Anwendung in Ihrem Browser geladen ist, kann sie offline funktionieren. Funktionen, die externe Ressourcen erfordern (wie das Abrufen von HPO-Begriffen, wenn nicht zwischengespeichert), können jedoch ohne Internetverbindung eingeschränkt sein."},{category:"Funktionen",question:"Wie funktioniert die HPO-Begriffssuche?",answer:"Sie können nach Begriffen der Human Phenotype Ontology (HPO) suchen, indem Sie Schlüsselwörter oder HPO-IDs eingeben. Die Suche verwendet eine integrierte HPO-Datenbank, um relevante Begriffe vorzuschlagen. Die Auswahl eines Begriffs fügt ihn dem Phänotypprofil des Patienten hinzu."},{category:"Funktionen",question:"Kann ich das generierte PDF anpassen?",answer:"Das PDF-Layout und der Inhalt sind standardisiert. Obwohl eine direkte Anpassung derzeit nicht unterstützt wird, enthält die Anwendung Felder für gängige Anforderungen. Zukünftige Versionen könnten mehr Branding- oder Layout-Optionen bieten."},{category:"Funktionen",question:"Wie teile ich die Formulardaten?",answer:"Sie können die Daten auf verschiedene Arten teilen:\n<ul>\n  <li><strong>URL kopieren:</strong> Generiert einen Link, in dem die Daten direkt kodiert sind (kann lang sein).</li>\n  <li><strong>Verschlüsselte URL kopieren:</strong> Generiert einen Link, in dem die Daten mit einem von Ihnen angegebenen Passwort verschlüsselt sind.</li>\n  <li><strong>Daten speichern:</strong> Lädt die Daten als JSON-Datei herunter.</li>\n</ul>"},{category:"Fehlerbehebung",question:"Die Anwendung scheint langsam oder reagiert nicht.",answer:"Stellen Sie sicher, dass Sie einen unterstützten Browser verwenden und dieser aktuell ist. Versuchen Sie, den Cache Ihres Browsers zu leeren oder den Browser neu zu starten. Wenn das Problem weiterhin besteht, überprüfen Sie die Ressourcennutzung Ihres Systems oder wenden Sie sich gegebenenfalls an den Support."},{category:"Fehlerbehebung",question:"Ich habe eine Fehlermeldung erhalten.",answer:"Notieren Sie sich die Fehlermeldung und die Schritte, die Sie unternommen haben, bevor der Fehler auftrat. Versuchen Sie, die Seite neu zu laden. Wenn der Fehler weiterhin besteht, konsultieren Sie die Entwicklerkonsole des Browsers (normalerweise mit F12 geöffnet) für weitere Details, die bei der Fehlersuche hilfreich sein könnten."}]};function es(){const e=Oa(),{localizedFaqContent:t}=function(){const{locale:e}=n();return{localizedFaqContent:a((()=>{const t=Xl[e.value]||Xl.en||[];return Array.isArray(t)?t:[]}))}}();return{faqItems:t,openFaq:function(){e.toggleFAQModal(!0)},closeFaq:function(){e.toggleFAQModal(!1)}}}const ts=Xe.categories||[],ns={key:0,class:"mb-4"},as={style:{display:"none"}},rs=$e({__name:"App",setup(e){const{t:t,locale:g}=n(),b=Oa(),w=mr(),D=gr(),x=Pr(),S=kr(),P=function(){const e=h(null),t=Oa();return{setPdfGeneratorRef:function(t){e.value=t},generatePdf:async function(){if(!e.value)return t.showSnackbar("Could not generate PDF. Please try again."),!1;try{return await e.value.generatePdf(),!0}catch(n){return t.showSnackbar("Error generating PDF. Please try again."),!1}}}}
/*! shepherd.js 14.5.0 */(),k=Yl(),_=es(),C=function(){const e=Oa(),t=mr();return{initiateReset:function(){e.openResetConfirmationDialog()},cancelReset:function(){e.closeResetConfirmationDialog()},confirmReset:function(){e.closeResetConfirmationDialog(),t.resetForm(),e.showSnackbar("Form has been reset!")},toggleTheme:function(){e.toggleTheme()}}}();T("ui",b),T("form",w),T("settings",D),T("isValid",w.isValid),T("validationErrors",w.validationErrors),T("sectionValidation",w.sectionValidation),T("validateForm",w.validateForm),T("getFieldErrors",w.getFieldErrors),T("patientData",w.patientData),T("updatePersonalInfo",w.updatePatientData),T("updatePhenotypeData",w.updatePhenotypeData),T("updateSelectedPanels",w.updateSelectedPanels);const A=h(ua),I=a((()=>w&&w.patientData?ts?ts.map((e=>({id:e.id,categoryTitle:e.title,tests:e.tests.filter((e=>{var t;return null==(t=w.patientData.selectedPanels)?void 0:t.includes(e.id)}))}))).filter((e=>e.tests.length>0)):(Me.warn("groupedPanelDetails: testsData.categories not available yet."),[]):(Me.warn("groupedPanelDetails: formStore or patientData not available yet."),[])));function F(){D.acknowledgeDisclaimer(),b.closeDisclaimerModal()}function E(e){x.copyEncryptedUrl(e).then((e=>{e&&b.closeEncryptionDialog()}))}function N(e){x.handlePasswordSubmit(e)}function L(e){S.saveToFile(e).then((e=>{e&&b.closeSaveDataDialog()}))}function O(e){S.loadFromFile(e).then((e=>{e&&b.closeLoadDataDialog()}))}async function V(e){try{Me.debug("App: Received data for import, length:",(null==e?void 0:e.length)||0);await S.importFromJson(e)?(b.closePasteDataDialog(),b.showSnackbar("Data imported successfully!"),setTimeout((()=>{Me.debug("App: Current form state after import:",{personalInfo:w.patientData.personalInfo,selectedPanels:w.patientData.selectedPanels.length,phenotypeData:w.patientData.phenotypeData.length})}),0)):Me.error("App: Failed to import data")}catch(t){Me.error("App: Error importing data:",t),b.showSnackbar("Error importing data. Please try again.")}}const R=h(null),z=h(null);async function M(){const e=w.validateForm(!0);if(w.setShowValidation(!0),Me.debug("Validation errors:",w.validationErrors),Me.debug("Validation sections:",w.sectionValidation),e){if(w.showPedigree&&z.value)try{const e=await z.value.getPedigreeDataUrl();w.updatePedigreeDataUrl(e);const t=z.value.getPedigreeData();t&&Me.debug("Updated pedigree data:",t),Me.debug("Pedigree data updated successfully for PDF generation")}catch(t){Me.error("Error updating pedigree data for PDF:",t)}await P.generatePdf()}else{Me.debug("Form validation failed. Please correct the errors before generating PDF."),b.showSnackbar("Please correct the form errors before generating PDF."),w.setShowValidation(!0),window.scrollTo({top:0,behavior:"smooth"});const e=document.querySelector(".validation-summary");e&&(e.setAttribute("tabindex","-1"),e.focus(),e.classList.add("highlight-animation"),setTimeout((()=>{e.classList.remove("highlight-animation")}),1500))}}v((()=>{k.initialize(),x.initializeFromUrl()})),m(R,(e=>{e&&(Me.debug("PDF generator reference connected"),P.setPdfGeneratorRef(e))}),{immediate:!0});const U=()=>{const e="en"===g.value?"de":"en";g.value=e,document.documentElement.lang=e,localStorage.setItem("userLanguage",e),Me.info(`Language switched to ${e.toUpperCase()}`)},H=()=>{b.toggleLogViewer()};return(e,n)=>(o(),r(ke,{theme:u(b).isDark?"dark":"light",id:"app"},{default:i((()=>[s(We,{isDark:u(b).isDark,onToggleTheme:u(C).toggleTheme,onResetForm:u(C).initiateReset,onOpenFaq:u(_).openFaq,onGeneratePdf:M,onCopyUrl:u(x).copyShareableUrl,onCopyEncryptedUrl:u(b).openEncryptionDialog,onStartTour:u(k).startTour,onSaveData:u(b).openSaveDataDialog,onLoadData:u(b).openLoadDataDialog,onOpenPasteData:u(b).openPasteDataDialog,onToggleLanguage:U,onToggleLogViewer:H},null,8,["isDark","onToggleTheme","onResetForm","onOpenFaq","onCopyUrl","onCopyEncryptedUrl","onStartTour","onSaveData","onLoadData","onOpenPasteData"]),n[27]||(n[27]=d()),!u(D).disclaimerAcknowledged||u(b).showDisclaimerModal?(o(),r(ga,{key:0,onDismiss:F})):f("",!0),n[28]||(n[28]=d()),s(_e,null,{default:i((()=>[s(Ce,{class:"main-content-container"},{default:i((()=>[u(w).showValidation?(o(),y("div",ns,[s(ca,{showValidation:u(w).showValidation,isValid:u(w).isValid,validationErrors:u(w).validationErrors},null,8,["showValidation","isValid","validationErrors"])])):f("",!0),n[11]||(n[11]=d()),s(Ye,{patientData:u(w).patientData.personalInfo,"onUpdate:patientData":u(w).updatePatientData,pdfConfig:A.value,id:"patient-form-component"},null,8,["patientData","onUpdate:patientData","pdfConfig"]),n[12]||(n[12]=d()),s(ne,{modelValue:u(w).showPedigree,"onUpdate:modelValue":n[0]||(n[0]=e=>u(w).showPedigree=e),label:u(t)("app.includePedigreeChart"),class:"mb-4"},null,8,["modelValue","label"]),n[13]||(n[13]=d()),u(w).showPedigree?(o(),r(da,{key:1,ref_key:"pedigreeDrawerRef",ref:z,"onUpdate:pedigreeDataUrl":u(w).updatePedigreeDataUrl},null,8,["onUpdate:pedigreeDataUrl"])):f("",!0),n[14]||(n[14]=d()),s(tt,{id:"test-selector-component"}),n[15]||(n[15]=d()),s(ct,{groupedPanelDetails:I.value,modelValue:u(w).phenotypeDataObj,"onUpdate:modelValue":n[1]||(n[1]=e=>u(w).phenotypeDataObj=e),id:"phenotype-selector-component"},null,8,["groupedPanelDetails","modelValue"]),n[16]||(n[16]=d()),l("div",as,[s(ma,{ref_key:"pdfGeneratorRef",ref:R,patientData:u(w).patientData.personalInfo,pedigreeDataUrl:u(w).pedigreeDataUrl,phenotypeData:u(w).phenotypeDataObj,pdfConfig:A.value},null,8,["patientData","pedigreeDataUrl","phenotypeData","pdfConfig"])]),n[17]||(n[17]=d()),s(Ka,{groupedPanelDetails:I.value},null,8,["groupedPanelDetails"])])),_:1}),n[19]||(n[19]=d()),s(Ae,{modelValue:u(b).snackbar,"onUpdate:modelValue":n[3]||(n[3]=e=>u(b).snackbar=e),timeout:"3000",top:"",right:"",transition:"scale-transition"},{action:i((({attrs:e})=>[s(B,p({color:"red",text:""},e,{onClick:n[2]||(n[2]=e=>u(b).snackbar=!1)}),{default:i((()=>[s(q,null,{default:i((()=>n[18]||(n[18]=[d("mdi-close")]))),_:1})])),_:2},1040)])),default:i((()=>[d(c(u(b).snackbarMessage)+" ",1)])),_:1},8,["modelValue"]),n[20]||(n[20]=d()),s(nr,{modelValue:u(b).encryptionDialog,"onUpdate:modelValue":n[4]||(n[4]=e=>u(b).encryptionDialog=e),onCancel:u(b).closeEncryptionDialog,onConfirm:E},null,8,["modelValue","onCancel"]),n[21]||(n[21]=d()),s(ar,{modelValue:u(b).decryptionDialog,"onUpdate:modelValue":n[5]||(n[5]=e=>u(b).decryptionDialog=e),error:u(b).decryptionError,onCancel:u(b).cancelDecryption,onConfirm:N},null,8,["modelValue","error","onCancel"]),n[22]||(n[22]=d()),s(ir,{modelValue:u(b).showFAQModal,"onUpdate:modelValue":n[6]||(n[6]=e=>u(b).showFAQModal=e),faqItems:u(_).faqItems.value,onClose:u(_).closeFaq},null,8,["modelValue","faqItems","onClose"]),n[23]||(n[23]=d()),s(lr,{modelValue:u(b).resetConfirmationDialog,"onUpdate:modelValue":n[7]||(n[7]=e=>u(b).resetConfirmationDialog=e),onCancel:u(C).cancelReset,onConfirm:u(C).confirmReset},null,8,["modelValue","onCancel","onConfirm"]),n[24]||(n[24]=d()),s(sr,{modelValue:u(b).saveDataDialog,"onUpdate:modelValue":n[8]||(n[8]=e=>u(b).saveDataDialog=e),defaultFileName:u(w).saveDataName,onCancel:u(b).closeSaveDataDialog,onConfirm:L},null,8,["modelValue","defaultFileName","onCancel"]),n[25]||(n[25]=d()),s(dr,{modelValue:u(b).loadDataDialog,"onUpdate:modelValue":n[9]||(n[9]=e=>u(b).loadDataDialog=e),error:u(b).loadDataError,onCancel:u(b).closeLoadDataDialog,onConfirm:O},null,8,["modelValue","error","onCancel"]),n[26]||(n[26]=d()),s(Ba,{modelValue:u(b).pasteDataDialog,"onUpdate:modelValue":n[10]||(n[10]=e=>u(b).pasteDataDialog=e),onClose:u(b).closePasteDataDialog,onImport:V},null,8,["modelValue","onClose"])])),_:1}),n[29]||(n[29]=d()),s(za,{disclaimerAcknowledged:u(D).disclaimerAcknowledged,acknowledgmentTime:u(D).acknowledgmentTime,onReopenDisclaimer:u(b).openDisclaimerModal},null,8,["disclaimerAcknowledged","acknowledgmentTime","onReopenDisclaimer"]),n[30]||(n[30]=d()),u(b).showLogViewer?(o(),r(tr,{key:1})):f("",!0)])),_:1},8,["theme"]))}},[["__scopeId","data-v-6bfb7f63"]]);!async function(){try{await Be();const e=Ie({components:Ee,directives:Fe,theme:{themes:{light:{dark:!1,colors:{...He.themeColors}},dark:{dark:!0,colors:{...He.darkThemeColors}}}}}),t=function(){const e=k(!0),t=e.run((()=>h({})));let n=[],a=[];const r=_({install(e){ba(r),r._a=e,e.provide(va,r),e.config.globalProperties.$pinia=r,a.forEach((e=>n.push(e))),a=[]},use(e){return this._a?n.push(e):a.push(e),this},_p:n,_a:null,_e:e,_s:new Map,state:t});return r}(),n=R(rs);n.use(e),n.use(t),n.use(Zl),n.mount("#app"),Me.info("Application mounted.")}catch(e){Me.error("Failed during application startup:",e),document.getElementById("app").innerHTML='\n      <div style="padding: 20px; text-align: center; color: red;">\n        <h2>Application Initialization Failed</h2>\n        <p>Could not load critical configuration. Please check the console or contact support.</p>\n      </div>\n    '}}();
