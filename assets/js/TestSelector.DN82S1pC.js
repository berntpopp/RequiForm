import{_ as e,t as l,l as t}from"./index.bEcAwTH9.js";import{Z as a,c as o,d as s,b as n,H as i,v as r,o as u,a8 as c,$ as d,a1 as m,R as v,j as g,N as f,u as p,a0 as h,a2 as b,m as y}from"./vendor-vue.MuR-ak5S.js";import{y as S,z as w,A as C,v as P,B as k,C as T,D as V}from"./vendor-vuetify-core.gPhD-pXQ.js";import"./vendor-pdf.CZcEIuwn.js";/* empty css                     */const _={key:0,class:"mb-4"},D=e({__name:"TestSelector",setup(e){const{t:D}=a(),A=a(),j=o((()=>A.locale.value)),F=(e,l,t)=>!l||(t&&(t.searchText||t.raw&&t.raw.searchText)||e).toLowerCase().includes(l.toLowerCase());function q(e){return e.names&&e.names[j.value]?e.names[j.value]:e.name}const K=s("patientData",{selectedPanels:n([])}),U=s("updateCategory",null),x=n([]),E=n(""),I=o((()=>(null==K?void 0:K.category)||"")),L=o((()=>(null==K?void 0:K.selectedPanels)||[])),z=n("Category Selection");i((()=>{var e,a,o,s;if(x.value=l.categories,(null==(a=null==(e=window.requiFormData)?void 0:e.directPanels)?void 0:a.length)>0){t.debug("TestSelector: Setting panels from directPanels:",window.requiFormData.directPanels);const e=window.requiFormData.directPanels[0];for(const l of x.value)if(l.tests.some((l=>l.id===e))){t.debug("TestSelector: Auto-selecting category from panel:",l.id),E.value=l.id;break}}else if((null==(s=null==(o=window.requiFormData)?void 0:o.selectedPanels)?void 0:s.length)>0){t.debug("TestSelector: Setting panels from window.requiFormData.selectedPanels:",window.requiFormData.selectedPanels);const e=window.requiFormData.selectedPanels[0];for(const l of x.value)if(l.tests.some((l=>l.id===e))){t.debug("TestSelector: Auto-selecting category from panel:",l.id),E.value=l.id;break}}else if(L.value.length>0){t.debug("TestSelector: Setting panels from unifiedPatientData:",L.value);const e=L.value[0];for(const l of x.value)if(l.tests.some((l=>l.id===e))){t.debug("TestSelector: Auto-selecting category from panel:",l.id),E.value=l.id;break}}else I.value&&(t.debug("TestSelector: Setting initial category from unified model:",I.value),E.value=I.value);r((()=>{L.value.length>0&&(t.debug("TestSelector: Forcing Category Selection tab to show selected panels"),z.value="Category Selection")}))})),u(L,(e=>{if(e&&e.includes("nephronophthise")&&(!E.value||"nephrology"!==E.value)){t.debug("TestSelector: Auto-setting category to nephrology based on nephronophthise panel");const e="nephrology";E.value=e,U&&U(e)}}),{immediate:!0}),u([L,x],(([e,l])=>{if(e&&e.length>0&&!E.value&&l.length>0){const a=e[0];let o=null;for(const e of l)if(e.tests.some((e=>e.id===a))){o=e.id;break}o&&(t.debug("TestSelector: Auto-selecting category based on selected test:",o),E.value=o)}}),{immediate:!0});const B=o((()=>{const e=x.value.find((e=>e.id===E.value));return e?e.tests:[]})),H=o((()=>{const e=[];return x.value.forEach((l=>{l.tests.forEach((l=>{const t=q(l);let a=t;l.genes&&Array.isArray(l.genes)&&(a+=" "+l.genes.join(" ")),e.push({label:t,value:l.id,searchText:a})}))})),e})),N=["primary","secondary","success","info","warning","error"],R=o((()=>l.categories.reduce(((e,l,t)=>(e[l.id]=N[t%N.length],e)),{}))),Z=o((()=>l.categories.reduce(((e,l)=>(l.tests.forEach((t=>{e[t.id]=l.id})),e)),{})));function $(e){const l=e.id||e.value,t=Z.value[l];return R.value[t]||"default"}function G(e){if(t.debug("Panel selection changed in UI:",e),e&&e.length>0&&(z.value="Category Selection",!E.value&&x.value.length>0)){const l=e[0];for(const e of x.value)if(e.tests.some((e=>e.id===l))){t.debug("TestSelector: Auto-selecting category from panel:",e.id),E.value=e.id;break}}}return(e,l)=>(d(),c("div",null,[m("h2",null,f(p(D)("testSelector.title")),1),l[8]||(l[8]=v()),g(w,{modelValue:z.value,"onUpdate:modelValue":l[0]||(l[0]=e=>z.value=e),"bg-color":"primary"},{default:h((()=>[g(S,{value:"Category Selection"},{default:h((()=>[v(f(p(D)("testSelector.tabs.categorySelection")),1)])),_:1}),l[5]||(l[5]=v()),g(S,{value:"Search"},{default:h((()=>[v(f(p(D)("testSelector.tabs.search")),1)])),_:1})])),_:1},8,["modelValue"]),l[9]||(l[9]=v()),g(V,{modelValue:z.value,"onUpdate:modelValue":l[4]||(l[4]=e=>z.value=e)},{default:h((()=>[g(C,{value:"Category Selection"},{default:h((()=>[g(P,{dense:"",outlined:"",label:p(D)("testSelector.labels.category"),items:x.value,"item-title":e=>{return(l=e).titles&&l.titles[j.value]?l.titles[j.value]:l.title;var l},"item-value":"id",modelValue:E.value,"onUpdate:modelValue":l[1]||(l[1]=e=>E.value=e),class:"mt-2"},null,8,["label","items","item-title","modelValue"]),l[6]||(l[6]=v()),E.value?(d(),c("div",_,[g(P,{dense:"",outlined:"",label:p(D)("testSelector.labels.selectPanels"),items:B.value,"item-title":e=>q(e),"item-value":"id",modelValue:p(K).selectedPanels,"onUpdate:modelValue":[l[2]||(l[2]=e=>p(K).selectedPanels=e),G],"return-object":!1,multiple:"",chips:"","closable-chips":""},{chip:h((({props:e,item:l})=>[g(k,y({variant:"flat"},{...e,color:$(l)},{onClick:e.onClick,onKeydown:e.onKeydown,close:"","onClick:close":e.onClose}),{default:h((()=>[v(f(l.title),1)])),_:2},1040,["onClick","onKeydown","onClick:close"])])),_:1},8,["label","items","item-title","modelValue"])])):b("",!0)])),_:1}),l[7]||(l[7]=v()),g(C,{value:"Search"},{default:h((()=>[g(T,{dense:"",outlined:"",label:p(D)("testSelector.labels.searchPlaceholder"),items:H.value,"item-title":"label","item-value":"value",modelValue:p(K).selectedPanels,"onUpdate:modelValue":l[3]||(l[3]=e=>p(K).selectedPanels=e),"custom-filter":F,multiple:"",chips:"","closable-chips":"","hide-selected":"",class:"mt-2"},{chip:h((({props:e,item:l})=>[g(k,y({variant:"flat"},{...e,color:$(l)},{onClick:e.onClick,onKeydown:e.onKeydown,close:"","onClick:close":e.onClose}),{default:h((()=>[v(f(l.title),1)])),_:2},1040,["onClick","onKeydown","onClick:close"])])),_:1},8,["label","items","modelValue"])])),_:1})])),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-2079cc4e"]]);export{D as default};
